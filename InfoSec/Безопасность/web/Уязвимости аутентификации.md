Концептуально уязвимости аутентификации легко понять. Однако они обычно являются критическими из‑за очевидной связи между аутентификацией и безопасностью.

Уязвимости аутентификации могут позволить злоумышленникам получить доступ к конфиденциальным данным и функционалу. Они также открывают дополнительную поверхность атаки для дальнейших эксплойтов. По этой причине важно научиться выявлять и эксплуатировать уязвимости аутентификации, а также обходить распространённые меры защиты.

В этом разделе:

- Наиболее распространённые механизмы аутентификации, используемые на веб‑сайтах.
- Потенциальные уязвимости в этих механизмах.
- Присущие уязвимости различных механизмов аутентификации.
- Типичные уязвимости, возникающие из‑за их неправильной реализации.
- Как сделать собственные механизмы аутентификации максимально надёжными.

![[password-reset-poisoning.svg]]

## Что такое аутентификация?

Аутентификация — это процесс проверки личности пользователя или клиента. Веб‑сайты потенциально доступны любому, кто подключён к интернету. Это делает надёжные механизмы аутентификации неотъемлемой частью эффективной веб‑безопасности.

Существует три основных типа аутентификации:

- **То, что вы знаете**, например пароль или ответ на секретный вопрос. Иногда это называют «факторами знания».
- **То, что у вас есть**, физический объект, такой как мобильный телефон или токен безопасности. Иногда это называют «факторами владения».
- **То, чем вы являетесь или что вы делаете.** Например, биометрические данные или поведенческие шаблоны. Иногда это называют «факторами присущности».

Механизмы аутентификации используют различные технологии для проверки одного или нескольких из этих факторов.

## В чём разница между аутентификацией и авторизацией?

Аутентификация — это процесс проверки того, что пользователь действительно является тем, за кого себя выдаёт. Авторизация — это проверка того, имеет ли пользователь право что‑то делать.

Например, аутентификация определяет, действительно ли человек, пытающийся войти на сайт под именем пользователя **Carlos123**, является тем самым человеком, который создал эту учётную запись.

После того как **Carlos123** прошёл аутентификацию, его права определяют, что он **авторизован** делать. Например, он может быть авторизован для доступа к личной информации других пользователей или для выполнения действий, таких как удаление учётной записи другого пользователя.

## Как возникают уязвимости аутентификации?

Большинство уязвимостей в механизмах аутентификации возникают двумя способами:

- Механизмы аутентификации слабы, потому что они не обеспечивают достаточной защиты от атак перебора (brute‑force).
- Логические ошибки или плохое программирование в реализации позволяют злоумышленнику полностью обойти механизмы аутентификации. Иногда это называют «сломанная аутентификация» (broken authentication).

Во многих областях веб‑разработки логические ошибки приводят к неожиданному поведению сайта, что может быть, а может и не быть проблемой безопасности. Однако, поскольку аутентификация критически важна для безопасности, очень вероятно, что ошибки в логике аутентификации подвергают сайт угрозам.

## Каков ущерб от уязвимой аутентификации?

Последствия уязвимостей аутентификации могут быть серьёзными. Если злоумышленник обходит аутентификацию или подбирает пароль к чужой учётной записи, он получает доступ ко всем данным и функциям, доступным этой скомпрометированной учётной записи.

Если ему удаётся взломать учётную запись с высокими привилегиями, например системного администратора, он может получить полный контроль над всем приложением и потенциально доступ к внутренней инфраструктуре.

Даже компрометация учётной записи с низкими привилегиями может предоставить злоумышленнику доступ к данным, к которым он не должен иметь доступ, например к коммерчески чувствительной информации. Даже если учётная запись не имеет доступа к конфиденциальным данным, она может позволить злоумышленнику попасть на дополнительные страницы, что расширяет поверхность атаки. Часто атаки высокой степени опасности невозможны с публично доступных страниц, но могут быть возможны с внутренних страниц.

## Уязвимости в механизмах аутентификации

Система аутентификации веб‑сайта обычно состоит из нескольких отдельных механизмов, в которых могут возникать уязвимости. Некоторые уязвимости применимы ко всем этим контекстам. Другие более специфичны для предоставляемой функциональности.

## Как защитить механизмы аутентификации

Аутентификация — сложная тема, и, как мы показали, к сожалению, слабости и ошибки слишком легко могут закрасться. Очертить каждую возможную меру защиты для ваших собственных веб‑сайтов явно невозможно. Однако есть несколько общих принципов, которых вам следует всегда придерживаться.

### Осторожно обращайтесь с учетными данными пользователей

Даже самые надежные механизмы аутентификации бессильны, если вы невольно раскрываете злоумышленнику действующий набор учетных данных для входа. Само собой разумеется, что никогда нельзя отправлять какие‑либо данные для входа по нешифрованным соединениям. Хотя вы могли внедрить HTTPS для ваших запросов на вход, убедитесь, что вы принудительно обеспечиваете это, перенаправляя любые попытки HTTP‑запросов на HTTPS.

Вам также следует провести аудит вашего веб‑сайта, чтобы убедиться, что ни имена пользователей, ни адреса электронной почты не раскрываются ни через общедоступные профили, ни отражаются в HTTP‑ответах, например.

### Не полагайтесь на пользователей в вопросах безопасности

Строгие меры аутентификации часто требуют от пользователей дополнительных усилий. Человеческая природа делает практически неизбежным то, что некоторые пользователи найдут способ сэкономить себе эти усилия. Поэтому вам нужно принудительно обеспечивать безопасное поведение везде, где это возможно.

Самый очевидный пример — внедрить эффективную политику паролей. Некоторые из более традиционных политик проваливаются, потому что люди «впихивают» свои предсказуемые пароли в рамки политики. Вместо этого может быть эффективнее внедрить какого‑то рода простой проверяющий пароли инструмент, который позволяет пользователям экспериментировать с паролями и дает обратную связь об их надежности в реальном времени. Популярный пример — библиотека JavaScript zxcvbn, разработанная Dropbox. Разрешая только те пароли, которые высоко оцениваются проверяющим инструментом, вы можете принудительно обеспечить использование безопасных паролей эффективнее, чем с традиционными политиками.

### Предотвращайте перечисление имен пользователей

Злоумышленнику существенно проще взломать ваши механизмы аутентификации, если вы раскрываете факт существования пользователя в системе. Есть даже ситуации, когда из‑за природы веб‑сайта знание о том, что у конкретного человека есть учетная запись, само по себе является конфиденциальной информацией.

Независимо от того, является ли попытка имени пользователя действительной, важно использовать идентичные, общие сообщения об ошибках — и убедиться, что они действительно идентичны. Вы всегда должны возвращать один и тот же код состояния HTTP для каждого запроса на вход и, наконец, сделать времена ответа в разных сценариях максимально неотличимыми.

### Реализуйте надежную защиту от brute‑force

Учитывая, насколько просто сконструировать атаку brute‑force, жизненно важно обеспечить шаги для предотвращения или, как минимум, нарушения любых попыток подбора учетных данных.

Одним из более эффективных методов является внедрение строгого, основанного на IP, ограничения скорости запросов пользователей. Это должно включать меры, предотвращающие манипуляции атакующими своим видимым IP‑адресом. В идеале вы должны требовать от пользователя прохождения теста CAPTCHA при каждой попытке входа после достижения определенного лимита.

Помните, что это не гарантирует полного устранения угрозы brute‑force. Однако делая процесс как можно более утомительным и ручным, вы повышаете вероятность того, что потенциальный злоумышленник сдастся и отправится искать более мягкую цель.

### Тройная проверка вашей логики проверки

Как показано в наших лабораторных заданиях, простые логические ошибки легко могут закрасться в код, который, в случае аутентификации, способен полностью скомпрометировать ваш веб‑сайт и пользователей. Тщательный аудит любой логики проверки или валидации для устранения ошибок — абсолютно ключевой момент для надежной аутентификации. Проверка, которую можно обойти, в конечном итоге мало чем лучше отсутствия проверки вообще.

### Не забывайте о дополнительной функциональности

Убедитесь, что вы не сосредотачиваетесь только на центральных страницах входа и не упускаете дополнительную функциональность, связанную с аутентификацией. Это особенно важно в случаях, когда злоумышленник свободно может зарегистрировать собственную учетную запись и исследовать эту функциональность. Помните, что сброс или изменение пароля являются столь же валидной поверхностью атаки, как и основной механизм входа, и, следовательно, должны быть столь же надежными.

### Реализуйте корректную многофакторную аутентификацию

Хотя многофакторная аутентификация может быть непрактичной для каждого веб‑сайта, при правильной реализации она гораздо безопаснее, чем вход только по паролю. Помните, что проверка нескольких экземпляров одного и того же фактора — это не настоящая многофакторная аутентификация. Отправка кодов проверки по электронной почте — по сути лишь более длинная форма однофакторной аутентификации.

2FA на основе SMS технически проверяет два фактора (то, что вы знаете, и то, что у вас есть). Однако возможность злоупотреблений, например через «перевыпуск SIM‑карты» (SIM swapping), означает, что эта система может быть ненадежной.

В идеале 2FA должен быть реализован с использованием специализированного устройства или приложения, которое напрямую генерирует код проверки. Поскольку они созданы специально для обеспечения безопасности, такие средства обычно более надежны.

И наконец, как и с основной логикой аутентификации, убедитесь, что логика ваших проверок 2FA корректна, чтобы ее нельзя было легко обойти.

## Уязвимости при входе на основе пароля

Для веб‑сайтов, которые используют процесс входа на основе пароля, пользователи либо самостоятельно регистрируют учётную запись, либо получают её от администратора. Эта учётная запись связана с уникальным именем пользователя и секретным паролем, который пользователь вводит в форму входа для аутентификации.

В этом сценарии факт того, что пользователь знает секретный пароль, принимается как достаточное доказательство его личности. Это означает, что безопасность веб‑сайта оказывается под угрозой, если злоумышленник сможет либо получить, либо угадать учётные данные другого пользователя.

Этого можно достичь разными способами. В следующих разделах показано, как злоумышленник может использовать атаки перебора (brute‑force), а также некоторые недостатки защиты от перебора. Вы также узнаете об уязвимостях в HTTP‑базовой аутентификации.

### Атаки перебора (Brute‑force attacks)

Атака перебора — это когда злоумышленник использует систему проб и ошибок, чтобы угадать действительные учётные данные пользователя. Эти атаки обычно автоматизируются с помощью словарей имён пользователей и паролей. Автоматизация процесса, особенно с использованием специализированных инструментов, потенциально позволяет злоумышленнику совершать огромное количество попыток входа на высокой скорости.

Перебор не всегда означает полностью случайные догадки имён пользователей и паролей. Используя базовую логику или общедоступные сведения, злоумышленники могут «настраивать» атаки перебора, чтобы делать более обоснованные догадки. Это значительно повышает эффективность таких атак. Веб‑сайты, которые полагаются исключительно на вход по паролю как на единственный метод аутентификации, могут быть крайне уязвимы, если они не внедряют достаточную защиту от перебора.

### Перебор имён пользователей

Имена пользователей особенно легко угадать, если они соответствуют узнаваемому шаблону, например адресу электронной почты. Например, очень часто бизнес‑логины имеют формат **firstname.lastname@somecompany.com**. Однако даже если очевидного шаблона нет, иногда даже учётные записи с высокими привилегиями создаются с использованием предсказуемых имён, таких как **admin** или **administrator**.

Во время аудита проверьте, не раскрывает ли веб‑сайт потенциальные имена пользователей публично. Например, можно ли получить доступ к профилям пользователей без входа? Даже если фактическое содержимое профилей скрыто, имя, используемое в профиле, иногда совпадает с именем для входа. Также следует проверить HTTP‑ответы, чтобы увидеть, не раскрываются ли там адреса электронной почты. Иногда ответы содержат адреса электронной почты пользователей с высокими привилегиями, таких как администраторы или сотрудники технической поддержки.

### Перебор паролей

Пароли также могут подбираться перебором, при этом сложность зависит от их стойкости. Многие веб‑сайты внедряют определённую политику паролей, которая заставляет пользователей создавать пароли с высокой энтропией, которые, по крайней мере теоретически, сложнее взломать с помощью одного лишь перебора. Обычно это включает требование:

- Минимального количества символов.
- Смешения строчных и прописных букв.
- Наличия хотя бы одного специального символа.

Однако, хотя пароли с высокой энтропией трудно взломать компьютеру, можно использовать базовые знания о человеческом поведении, чтобы эксплуатировать уязвимости, которые пользователи невольно вносят в систему. Вместо того чтобы создавать действительно сильный пароль из случайной комбинации символов, пользователи часто берут пароль, который они могут запомнить, и пытаются «подогнать» его под требования политики. Например, если **mypassword** не разрешён, пользователи могут попробовать **Mypassword1!** или `Myp4$$w0rd`.

В случаях, когда политика требует от пользователей регулярно менять пароли, также распространено, что пользователи просто делают небольшие, предсказуемые изменения в своём любимом пароле. Например, **Mypassword1!** становится **Mypassword1?** или **Mypassword2!**.

Это знание вероятных учётных данных и предсказуемых шаблонов означает, что атаки перебора могут быть гораздо более изощрёнными и, следовательно, эффективными, чем простое перебирание всех возможных комбинаций символов.

### Перечисление имён пользователей (Username enumeration)

Перечисление имён пользователей — это когда злоумышленник может наблюдать изменения в поведении веб‑сайта, чтобы определить, является ли данное имя пользователя действительным.

Обычно это происходит либо на странице входа (например, когда вы вводите правильное имя пользователя, но неправильный пароль), либо на формах регистрации (когда вы вводите имя пользователя, которое уже занято). Это значительно сокращает время и усилия, необходимые для перебора, потому что злоумышленник может быстро составить короткий список действительных имён пользователей.

При попытке перебора страницы входа следует уделять особое внимание любым различиям в:

- **Кодах состояния (status codes):** во время атаки перебора возвращаемый HTTP‑код состояния, скорее всего, будет одинаковым для подавляющего большинства догадок, так как большинство из них неверны. Если догадка возвращает другой код состояния, это сильный признак того, что имя пользователя было правильным. Хорошей практикой является всегда возвращать один и тот же код состояния независимо от результата, но это соблюдается не всегда.
    
- **Сообщениях об ошибках:** иногда возвращаемое сообщение об ошибке отличается в зависимости от того, неверны ли и имя пользователя, и пароль, или только пароль. Хорошей практикой является использование одинаковых, общих сообщений в обоих случаях, но иногда закрадываются мелкие ошибки. Даже один лишний символ делает два сообщения различимыми, даже если этот символ не виден на отображаемой странице.
    
- **Времени ответа:** если большинство запросов обрабатываются с похожим временем ответа, любые отклонения от этого указывают на то, что «за кулисами» происходило что‑то другое. Это ещё один признак того, что угаданное имя пользователя может быть правильным. Например, веб‑сайт может проверять правильность пароля только в том случае, если имя пользователя действительно существует. Этот дополнительный шаг может вызвать небольшое увеличение времени ответа. Оно может быть едва заметным, но злоумышленник может сделать задержку более очевидной, введя чрезмерно длинный пароль, который сайт будет обрабатывать заметно дольше.

## Как защитить ваши механизмы аутентификации

Аутентификация — это сложная тема, к сожалению, слабости и ошибки слишком легко могут закрасться. Очертить каждую возможную меру защиты для ваших собственных веб‑сайтов явно невозможно. Однако есть несколько общих принципов, которых вам следует всегда придерживаться.

### Осторожно обращайтесь с учётными данными пользователей

Даже самые надёжные механизмы аутентификации бессильны, если вы невольно раскрываете злоумышленнику действующий набор учётных данных для входа. Само собой разумеется, что никогда нельзя отправлять какие‑либо данные для входа по нешифрованным соединениям. Хотя вы могли внедрить HTTPS для ваших запросов на вход, убедитесь, что вы принудительно обеспечиваете это, перенаправляя любые попытки HTTP‑запросов на HTTPS.

Вам также следует провести аудит вашего веб‑сайта, чтобы убедиться, что ни имена пользователей, ни адреса электронной почты не раскрываются ни через общедоступные профили, ни отражаются в HTTP‑ответах, например.

### Не полагайтесь на пользователей в вопросах безопасности

Строгие меры аутентификации часто требуют от пользователей дополнительных усилий. Человеческая природа делает практически неизбежным то, что некоторые пользователи найдут способ сэкономить себе эти усилия. Поэтому вам нужно принудительно обеспечивать безопасное поведение везде, где это возможно.

Самый очевидный пример — внедрить эффективную политику паролей. Некоторые из более традиционных политик проваливаются, потому что люди «впихивают» свои предсказуемые пароли в рамки политики. Вместо этого может быть эффективнее внедрить какой‑то простой проверяющий пароли инструмент, который позволяет пользователям экспериментировать с паролями и даёт обратную связь об их надёжности в реальном времени. Популярный пример — библиотека JavaScript **zxcvbn**, разработанная Dropbox. Разрешая только те пароли, которые высоко оцениваются проверяющим инструментом, вы можете принудительно обеспечить использование безопасных паролей эффективнее, чем с традиционными политиками.

### Предотвращайте перечисление имён пользователей

Злоумышленнику существенно проще взломать ваши механизмы аутентификации, если вы раскрываете факт существования пользователя в системе. Есть даже ситуации, когда из‑за природы веб‑сайта знание о том, что у конкретного человека есть учётная запись, само по себе является конфиденциальной информацией.

Независимо от того, является ли попытка имени пользователя действительной, важно использовать идентичные, общие сообщения об ошибках — и убедиться, что они действительно идентичны. Вы всегда должны возвращать один и тот же код состояния HTTP для каждого запроса на вход и, наконец, сделать времена ответа в разных сценариях максимально неотличимыми.

### Реализуйте надёжную защиту от brute‑force

Учитывая, насколько просто сконструировать атаку brute‑force, жизненно важно обеспечить шаги для предотвращения или, как минимум, нарушения любых попыток подбора учётных данных.

Одним из более эффективных методов является внедрение строгого, основанного на IP, ограничения скорости запросов пользователей. Это должно включать меры, предотвращающие манипуляции атакующими своим видимым IP‑адресом. В идеале вы должны требовать от пользователя прохождения теста CAPTCHA при каждой попытке входа после достижения определённого лимита.

Помните, что это не гарантирует полного устранения угрозы brute‑force. Однако делая процесс как можно более утомительным и ручным, вы повышаете вероятность того, что потенциальный злоумышленник сдастся и отправится искать более мягкую цель.

### Тройная проверка вашей логики проверки

Как показано в наших лабораторных заданиях, простые логические ошибки легко могут закрасться в код, который, в случае аутентификации, способен полностью скомпрометировать ваш веб‑сайт и пользователей. Тщательный аудит любой логики проверки или валидации для устранения ошибок — абсолютно ключевой момент для надёжной аутентификации. Проверка, которую можно обойти, в конечном итоге мало чем лучше отсутствия проверки вообще.

### Не забывайте о дополнительной функциональности

Убедитесь, что вы не сосредотачиваетесь только на центральных страницах входа и не упускаете дополнительную функциональность, связанную с аутентификацией. Это особенно важно в случаях, когда злоумышленник свободно может зарегистрировать собственную учётную запись и исследовать эту функциональность. Помните, что сброс или изменение пароля являются столь же валидной поверхностью атаки, как и основной механизм входа, и, следовательно, должны быть столь же надёжными.

### Реализуйте корректную многофакторную аутентификацию

Хотя многофакторная аутентификация может быть непрактичной для каждого веб‑сайта, при правильной реализации она гораздо безопаснее, чем вход только по паролю. Помните, что проверка нескольких экземпляров одного и того же фактора — это не настоящая многофакторная аутентификация. Отправка кодов проверки по электронной почте — по сути лишь более длинная форма однофакторной аутентификации.

2FA на основе SMS технически проверяет два фактора (то, что вы знаете, и то, что у вас есть). Однако возможность злоупотреблений, например через «перевыпуск SIM‑карты» (SIM swapping), означает, что эта система может быть ненадёжной.

В идеале 2FA должен быть реализован с использованием специализированного устройства или приложения, которое напрямую генерирует код проверки. Поскольку они созданы специально для обеспечения безопасности, такие средства обычно более надёжны.

И наконец, как и с основной логикой аутентификации, убедитесь, что логика ваших проверок 2FA корректна, чтобы её нельзя было легко обойти.