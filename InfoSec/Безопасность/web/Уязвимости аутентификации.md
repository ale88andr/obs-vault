Концептуально уязвимости аутентификации легко понять. Однако они обычно являются критическими из‑за очевидной связи между аутентификацией и безопасностью.

Уязвимости аутентификации могут позволить злоумышленникам получить доступ к конфиденциальным данным и функционалу. Они также открывают дополнительную поверхность атаки для дальнейших эксплойтов. По этой причине важно научиться выявлять и эксплуатировать уязвимости аутентификации, а также обходить распространённые меры защиты.

В этом разделе:

- Наиболее распространённые механизмы аутентификации, используемые на веб‑сайтах.
- Потенциальные уязвимости в этих механизмах.
- Присущие уязвимости различных механизмов аутентификации.
- Типичные уязвимости, возникающие из‑за их неправильной реализации.
- Как сделать собственные механизмы аутентификации максимально надёжными.

![[password-reset-poisoning.svg]]

## Что такое аутентификация?

Аутентификация — это процесс проверки личности пользователя или клиента. Веб‑сайты потенциально доступны любому, кто подключён к интернету. Это делает надёжные механизмы аутентификации неотъемлемой частью эффективной веб‑безопасности.

Существует три основных типа аутентификации:

- **То, что вы знаете**, например пароль или ответ на секретный вопрос. Иногда это называют «факторами знания».
- **То, что у вас есть**, физический объект, такой как мобильный телефон или токен безопасности. Иногда это называют «факторами владения».
- **То, чем вы являетесь или что вы делаете.** Например, биометрические данные или поведенческие шаблоны. Иногда это называют «факторами присущности».

Механизмы аутентификации используют различные технологии для проверки одного или нескольких из этих факторов.

## В чём разница между аутентификацией и авторизацией?

Аутентификация — это процесс проверки того, что пользователь действительно является тем, за кого себя выдаёт. Авторизация — это проверка того, имеет ли пользователь право что‑то делать.

Например, аутентификация определяет, действительно ли человек, пытающийся войти на сайт под именем пользователя **Carlos123**, является тем самым человеком, который создал эту учётную запись.

После того как **Carlos123** прошёл аутентификацию, его права определяют, что он **авторизован** делать. Например, он может быть авторизован для доступа к личной информации других пользователей или для выполнения действий, таких как удаление учётной записи другого пользователя.

## Как возникают уязвимости аутентификации?

Большинство уязвимостей в механизмах аутентификации возникают двумя способами:

- Механизмы аутентификации слабы, потому что они не обеспечивают достаточной защиты от атак перебора (brute‑force).
- Логические ошибки или плохое программирование в реализации позволяют злоумышленнику полностью обойти механизмы аутентификации. Иногда это называют «сломанная аутентификация» (broken authentication).

Во многих областях веб‑разработки логические ошибки приводят к неожиданному поведению сайта, что может быть, а может и не быть проблемой безопасности. Однако, поскольку аутентификация критически важна для безопасности, очень вероятно, что ошибки в логике аутентификации подвергают сайт угрозам.

## Каков ущерб от уязвимой аутентификации?

Последствия уязвимостей аутентификации могут быть серьёзными. Если злоумышленник обходит аутентификацию или подбирает пароль к чужой учётной записи, он получает доступ ко всем данным и функциям, доступным этой скомпрометированной учётной записи.

Если ему удаётся взломать учётную запись с высокими привилегиями, например системного администратора, он может получить полный контроль над всем приложением и потенциально доступ к внутренней инфраструктуре.

Даже компрометация учётной записи с низкими привилегиями может предоставить злоумышленнику доступ к данным, к которым он не должен иметь доступ, например к коммерчески чувствительной информации. Даже если учётная запись не имеет доступа к конфиденциальным данным, она может позволить злоумышленнику попасть на дополнительные страницы, что расширяет поверхность атаки. Часто атаки высокой степени опасности невозможны с публично доступных страниц, но могут быть возможны с внутренних страниц.

## Уязвимости в механизмах аутентификации

Система аутентификации веб‑сайта обычно состоит из нескольких отдельных механизмов, в которых могут возникать уязвимости. Некоторые уязвимости применимы ко всем этим контекстам. Другие более специфичны для предоставляемой функциональности.

## Как защитить механизмы аутентификации

Аутентификация — сложная тема, и, как мы показали, к сожалению, слабости и ошибки слишком легко могут закрасться. Очертить каждую возможную меру защиты для ваших собственных веб‑сайтов явно невозможно. Однако есть несколько общих принципов, которых вам следует всегда придерживаться.

### Осторожно обращайтесь с учетными данными пользователей

Даже самые надежные механизмы аутентификации бессильны, если вы невольно раскрываете злоумышленнику действующий набор учетных данных для входа. Само собой разумеется, что никогда нельзя отправлять какие‑либо данные для входа по нешифрованным соединениям. Хотя вы могли внедрить HTTPS для ваших запросов на вход, убедитесь, что вы принудительно обеспечиваете это, перенаправляя любые попытки HTTP‑запросов на HTTPS.

Вам также следует провести аудит вашего веб‑сайта, чтобы убедиться, что ни имена пользователей, ни адреса электронной почты не раскрываются ни через общедоступные профили, ни отражаются в HTTP‑ответах, например.

### Не полагайтесь на пользователей в вопросах безопасности

Строгие меры аутентификации часто требуют от пользователей дополнительных усилий. Человеческая природа делает практически неизбежным то, что некоторые пользователи найдут способ сэкономить себе эти усилия. Поэтому вам нужно принудительно обеспечивать безопасное поведение везде, где это возможно.

Самый очевидный пример — внедрить эффективную политику паролей. Некоторые из более традиционных политик проваливаются, потому что люди «впихивают» свои предсказуемые пароли в рамки политики. Вместо этого может быть эффективнее внедрить какого‑то рода простой проверяющий пароли инструмент, который позволяет пользователям экспериментировать с паролями и дает обратную связь об их надежности в реальном времени. Популярный пример — библиотека JavaScript zxcvbn, разработанная Dropbox. Разрешая только те пароли, которые высоко оцениваются проверяющим инструментом, вы можете принудительно обеспечить использование безопасных паролей эффективнее, чем с традиционными политиками.

### Предотвращайте перечисление имен пользователей

Злоумышленнику существенно проще взломать ваши механизмы аутентификации, если вы раскрываете факт существования пользователя в системе. Есть даже ситуации, когда из‑за природы веб‑сайта знание о том, что у конкретного человека есть учетная запись, само по себе является конфиденциальной информацией.

Независимо от того, является ли попытка имени пользователя действительной, важно использовать идентичные, общие сообщения об ошибках — и убедиться, что они действительно идентичны. Вы всегда должны возвращать один и тот же код состояния HTTP для каждого запроса на вход и, наконец, сделать времена ответа в разных сценариях максимально неотличимыми.

### Реализуйте надежную защиту от brute‑force

Учитывая, насколько просто сконструировать атаку brute‑force, жизненно важно обеспечить шаги для предотвращения или, как минимум, нарушения любых попыток подбора учетных данных.

Одним из более эффективных методов является внедрение строгого, основанного на IP, ограничения скорости запросов пользователей. Это должно включать меры, предотвращающие манипуляции атакующими своим видимым IP‑адресом. В идеале вы должны требовать от пользователя прохождения теста CAPTCHA при каждой попытке входа после достижения определенного лимита.

Помните, что это не гарантирует полного устранения угрозы brute‑force. Однако делая процесс как можно более утомительным и ручным, вы повышаете вероятность того, что потенциальный злоумышленник сдастся и отправится искать более мягкую цель.

### Тройная проверка вашей логики проверки

Как показано в наших лабораторных заданиях, простые логические ошибки легко могут закрасться в код, который, в случае аутентификации, способен полностью скомпрометировать ваш веб‑сайт и пользователей. Тщательный аудит любой логики проверки или валидации для устранения ошибок — абсолютно ключевой момент для надежной аутентификации. Проверка, которую можно обойти, в конечном итоге мало чем лучше отсутствия проверки вообще.

### Не забывайте о дополнительной функциональности

Убедитесь, что вы не сосредотачиваетесь только на центральных страницах входа и не упускаете дополнительную функциональность, связанную с аутентификацией. Это особенно важно в случаях, когда злоумышленник свободно может зарегистрировать собственную учетную запись и исследовать эту функциональность. Помните, что сброс или изменение пароля являются столь же валидной поверхностью атаки, как и основной механизм входа, и, следовательно, должны быть столь же надежными.

### Реализуйте корректную многофакторную аутентификацию

Хотя многофакторная аутентификация может быть непрактичной для каждого веб‑сайта, при правильной реализации она гораздо безопаснее, чем вход только по паролю. Помните, что проверка нескольких экземпляров одного и того же фактора — это не настоящая многофакторная аутентификация. Отправка кодов проверки по электронной почте — по сути лишь более длинная форма однофакторной аутентификации.

2FA на основе SMS технически проверяет два фактора (то, что вы знаете, и то, что у вас есть). Однако возможность злоупотреблений, например через «перевыпуск SIM‑карты» (SIM swapping), означает, что эта система может быть ненадежной.

В идеале 2FA должен быть реализован с использованием специализированного устройства или приложения, которое напрямую генерирует код проверки. Поскольку они созданы специально для обеспечения безопасности, такие средства обычно более надежны.

И наконец, как и с основной логикой аутентификации, убедитесь, что логика ваших проверок 2FA корректна, чтобы ее нельзя было легко обойти.