В этом разделе мы представим концепцию уязвимостей бизнес‑логики и объясним, как они могут возникать из‑за ошибочных предположений о поведении пользователей. Мы обсудим потенциальное влияние логических ошибок и покажем, как они могут эксплуатироваться. Вы также сможете попрактиковаться в том, что узнали, используя наши интерактивные лабораторные задания, основанные на реальных ошибках, с которыми мы сталкивались на практике. Наконец, мы предоставим несколько общих рекомендаций, которые помогут вам предотвратить появление подобных логических ошибок в ваших собственных приложениях.

![[logic-flaws.jpg]]

## Что такое уязвимости бизнес‑логики?

Уязвимости бизнес‑логики — это изъяны в проектировании и реализации приложения, которые позволяют злоумышленнику вызвать непредусмотренное поведение. Это потенциально даёт возможность злоумышленникам манипулировать легитимной функциональностью для достижения вредоносной цели. Эти изъяны, как правило, являются результатом неспособности предвидеть необычные состояния приложения, которые могут возникнуть, и, как следствие, неспособности безопасно их обработать.

**Примечание** В этом контексте термин «бизнес‑логика» просто относится к набору правил, которые определяют, как работает приложение. Так как эти правила не всегда напрямую связаны с бизнесом, соответствующие уязвимости также известны как «уязвимости логики приложения» или просто «логические изъяны».

Логические изъяны часто невидимы для людей, которые специально их не ищут, так как они обычно не проявляются при нормальном использовании приложения. Однако злоумышленник может эксплуатировать поведенческие особенности, взаимодействуя с приложением способами, которые разработчики никогда не предусматривали.

Одной из основных целей бизнес‑логики является обеспечение выполнения правил и ограничений, определённых при проектировании приложения или функциональности. В целом бизнес‑правила диктуют, как приложение должно реагировать, когда происходит определённый сценарий. Это включает предотвращение действий пользователей, которые могут негативно повлиять на бизнес или просто не имеют смысла.

Изъяны в логике могут позволить злоумышленникам обойти эти правила. Например, они могут завершить транзакцию, не проходя через предусмотренный процесс покупки. В других случаях сломанная или отсутствующая проверка данных, предоставленных пользователем, может позволить пользователям вносить произвольные изменения в критически важные для транзакции значения или отправлять бессмысленный ввод. Передавая неожиданные значения в серверную логику, злоумышленник потенциально может заставить приложение делать то, что оно не должно делать.

Уязвимости, основанные на логике, могут быть чрезвычайно разнообразными и часто уникальны для конкретного приложения и его функциональности. Их выявление часто требует определённых человеческих знаний, таких как понимание бизнес‑доменов или того, какие цели может преследовать злоумышленник в данном контексте. Это делает их трудными для обнаружения с помощью автоматизированных сканеров уязвимостей. В результате логические изъяны являются отличной целью для охотников за багами и ручных тестировщиков в целом.

## Как возникают уязвимости бизнес‑логики?

Уязвимости бизнес‑логики часто возникают потому, что команды проектирования и разработки делают ошибочные предположения о том, как пользователи будут взаимодействовать с приложением. Эти неверные предположения могут привести к недостаточной проверке пользовательского ввода. Например, если разработчики предполагают, что пользователи будут передавать данные исключительно через веб‑браузер, приложение может полностью полагаться на слабые клиентские средства проверки ввода. Эти средства легко обходятся злоумышленником с помощью перехватывающего прокси.

В конечном счёте это означает, что когда злоумышленник отклоняется от ожидаемого поведения пользователя, приложение не предпринимает соответствующих шагов для предотвращения этого и, как следствие, не справляется с ситуацией безопасно.

Логические изъяны особенно распространены в чрезмерно сложных системах, которые даже сама команда разработчиков не полностью понимает. Чтобы избежать логических изъянов, разработчики должны понимать приложение в целом. Это включает осведомлённость о том, как разные функции могут комбинироваться неожиданными способами. Разработчики, работающие с большими кодовыми базами, могут не иметь глубокого понимания того, как работают все области приложения. Кто‑то, работающий над одним компонентом, может сделать ошибочные предположения о том, как работает другой компонент, и в результате непреднамеренно ввести серьёзные логические изъяны. Если разработчики явно не документируют предположения, которые они делают, такие уязвимости легко могут проникнуть в приложение.

## Каково влияние уязвимостей бизнес‑логики?

Влияние уязвимостей бизнес‑логики иногда может быть довольно тривиальным. Это широкая категория, и последствия сильно варьируются. Однако любое непредусмотренное поведение потенциально может привести к атакам высокой степени серьёзности, если злоумышленник сможет правильно манипулировать приложением. По этой причине странности логики желательно исправлять, даже если вы сами не можете понять, как их эксплуатировать. Всегда существует риск, что кто‑то другой сможет.

По сути, влияние любого логического изъяна зависит от того, с какой функциональностью он связан. Если изъян находится в механизме аутентификации, например, это может серьёзно повлиять на общую безопасность. Злоумышленники могут потенциально использовать это для повышения привилегий или полного обхода аутентификации, получая доступ к конфиденциальным данным и функциональности. Это также открывает увеличенную поверхность атаки для других эксплойтов.

Ошибки логики в финансовых транзакциях могут, очевидно, привести к огромным потерям для бизнеса через кражу средств, мошенничество и так далее.

Также следует отметить, что даже если логические изъяны не позволяют злоумышленнику напрямую извлечь выгоду, они всё равно могут позволить злонамеренной стороне каким‑то образом нанести ущерб бизнесу.

## Каковы примеры уязвимостей бизнес‑логики?

Лучший способ понять уязвимости бизнес‑логики — это рассмотреть реальные случаи и извлечь уроки из допущенных ошибок. Мы предоставили конкретные примеры различных распространённых логических изъянов, а также некоторые преднамеренно уязвимые веб‑сайты, чтобы вы могли попрактиковаться в эксплуатации этих уязвимостей самостоятельно.

## Как предотвратить уязвимости бизнес‑логики

Вкратце, ключи к предотвращению уязвимостей бизнес‑логики заключаются в следующем:

- Убедитесь, что разработчики и тестировщики понимают домен, которому служит приложение.
- Избегайте неявных предположений о поведении пользователей или о поведении других частей приложения.

Вы должны определить, какие предположения вы сделали о состоянии на стороне сервера, и реализовать необходимую логику для проверки того, что эти предположения выполняются. Это включает в себя обеспечение того, что значение любого ввода является разумным, прежде чем продолжить.

Также важно убедиться, что как разработчики, так и тестировщики могут полностью понять эти предположения и то, как приложение должно реагировать в различных сценариях. Это может помочь команде выявить логические изъяны как можно раньше. Чтобы облегчить это, команда разработки должна по возможности придерживаться следующих передовых практик:

- Поддерживать чёткие проектные документы и потоки данных для всех транзакций и рабочих процессов, отмечая любые предположения, сделанные на каждом этапе.
- Писать код как можно более ясно. Если трудно понять, что должно происходить, будет трудно выявить какие‑либо логические изъяны. В идеале хорошо написанный код не должен нуждаться в документации для понимания. В случаях неизбежной сложности создание чёткой документации имеет решающее значение, чтобы другие разработчики и тестировщики знали, какие предположения делаются и каково именно ожидаемое поведение.
- Отмечать любые ссылки на другой код, который использует каждый компонент. Подумайте о любых побочных эффектах этих зависимостей, если злонамеренная сторона попытается манипулировать ими необычным образом.

Из‑за относительно уникальной природы многих логических изъянов легко отмахнуться от них как от разовой ошибки, вызванной человеческим фактором, и двигаться дальше. Однако, как мы показали, эти изъяны часто являются результатом плохих практик на начальных этапах создания приложения. Анализ того, почему логический изъян существовал изначально и как команда его упустила, может помочь выявить слабые места в ваших процессах. Внося небольшие корректировки, вы можете повысить вероятность того, что подобные изъяны будут устранены в зародыше или выявлены раньше в процессе разработки.