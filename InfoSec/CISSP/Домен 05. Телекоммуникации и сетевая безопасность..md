
Телекоммуникации и сети используют различные механизмы, устройства, программное обеспечение и протоколы, которые являются взаимосвязанными и интегрированными. Организация сетей является одним из наиболее сложных вопросов в компьютерной области, что связано в основном с большим количеством применяемых концепций и технологий.

Специалист по безопасности должен не только понимать как настраивать сетевое программное обеспечение, протоколы, сервисы, устройства, но и быть способным проанализировать их на несколько уровней глубже, чтобы понять, где в сети могут возникнуть уязвимости.

*Телекоммуникации* – это электрическая передача данных между системами с использованием аналоговых, цифровых или беспроводных видов передачи. Данные могут проходить по медным проводам, коаксиальным кабелям, радиоволнам, телефонным сетям общего пользования оптоволоконным кабелям провайдеров, коммутаторам и маршрутизаторам. Существуют четкие линии, разделяющие среду передачи, технологии, протоколы и оборудование, которое они используют. Однако эти линии смазываются, когда мы рассматриваем, как созданные на пользовательской рабочей станции данные проходят через сложную систему сетевых проводов к маршрутизатору, который отделяет внутреннюю сеть компании от остального мира

## 1. Эталонная модель взаимодействия открытых систем

Модель **OSI** применяется в качестве *абстрактной платформы*, которую используют большинство операционных систем и протоколов. Набор протоколов **TCP/IP** (Transmission Control Protocol / Internet Protocol) в 
действительности имеет свою собственную модель, которая в наше время часто используется для проверки знаний и понимания сетевых вопросов.

![[Pasted image 20241105101115.png]]

### 1.1. Протокол

Сетевой протокол – это стандартный набор правил, определяющих порядок сетевого взаимодействия систем. Две различные системы, использующие одинаковый протокол, могут взаимодействовать и понимать друг друга, несмотря на их различия, так же как два человека могут разговаривать и понимать друг друга, используя одинаковый язык.

Модель **OSI**, описанная в стандарте `ISO 7498` (часть 1, 3, 4), предоставляет важнейшее руководство, которое используется производителями, инженерами, разработчиками и т.д. Модель разделяет задачи организации сетей, протоколы и службы по различным уровням. Каждый уровень отвечает за свою часть взаимодействия компьютеров в сети. Каждый уровень имеет определенную функциональность, которую реализуют работающие на нем службы и протоколы.

Цель модели OSI – помочь всем производителям разрабатывать продукты, которые будут работать в рамках открытой сетевой архитектуры. Открытой сетевой архитектурой не владеют производители, она не является чьей-то собственностью, поэтому она может легко интегрироваться в различные технологии и реализовываться производителями в своих технологиях. Производители используют модель OSI как отправную точку для разработки своих собственных сетевых платформ. Они используют модель OSI как основу и разрабатывают свои собственные протоколы и интерфейсы, имеющие функциональность, отличающуюся или перекрывающую функциональность других производителей. Однако поскольку такие производители в основе своих разработок используют модель OSI, интеграция их продуктов с продуктами других производителей не является сложной задачей – обеспечить функциональную совместимость при этом значительно проще, чем если бы производители не основывались на единой модели.

Хотя компьютеры взаимодействуют на физическом уровне (электрические сигналы, проходящие по проводам от одного компьютера до другого), они взаимодействуют и на более высоком уровне – через логические каналы. Каждый протокол на определенном уровне модели OSI на одном компьютере, взаимодействует с соответствующим протоколом, работающим на том же уровне модели OSI на другом компьютере. Это осуществляется посредством **инкапсуляции**.

**Инкапсуляция** работает следующим образом. Сообщение создается программой на одном компьютере и затем проходит по стеку протоколов сверху вниз. Протокол на каждом уровне добавляет собственную информацию к сообщению; поэтому размер сообщения увеличивается по мере его перемещения по стеку протоколов. Затем сообщение отправляется компьютеру-получателю, который проводит обратное преобразование, выполняя в обратном порядке те же шаги, что и компьютер-отправитель, выполнивший инкапсуляцию

![[Pasted image 20241105101605.png]]

Протокол на каждом уровне выполняет определенные задачи и контрольные функции, используя известный синтаксис данных. Каждый уровень имеет специальный интерфейс (точку соединения), который позволяет ему взаимодействовать с тремя другими уровнями: 1) взаимодействие с интерфейсом вышестоящего уровня, 2) взаимодействие с интерфейсом нижестоящего уровня, и 3) взаимодействие с интерфейсом того же уровня на компьютере-получателе, адрес которого указан в пакете. Контрольные функции, добавляемые протоколами на каждом уровне, реализуются в форме *заголовка (header)* и *окончания (trailer)*
пакета.

Преимущество разделения на уровни и обеспечения раздельной функциональности для каждого уровня состоит в том, что различные протоколы, технологии и функции могут взаимодействовать друг с другом и обеспечивать необходимый интерфейс, позволяющий осуществлять такое взаимодействие. Это означает, что приложение может использовать для создания и передачи сообщений по сети, например, прикладные протоколы Novell, транспортные протоколы Apple и сеансовые протоколы IBM. Протоколы, технологии и компьютеры, работающие в рамках модели OSI, считаются открытыми системами.

**Прикладной уровень** (application layer, уровень 7) работает в непосредственной близости от пользователя и обеспечивает передачу файлов, обмен сообщениями, терминальные сеансы и многое другое. Этот уровень не содержит реальных приложений, но содержит протоколы, поддерживающие работу приложений. Когда приложению нужно отправить данные по сети, оно передает команды и данные протоколам прикладного уровня. Этот уровень обрабатывает и надлежащим образом форматирует данные, а затем передает их вниз, на следующий уровень модели OSI.

Протоколами, работающими на этом уровне, являются, например, `SMTP` (Simple Mail Transfer Protocol - Простой протокол передачи почты), `HTTP` (Hypertext Transfer Protocol - Протокол передачи гипертекста) `FTP` (File Transfer Protocol - Протокол передачи файлов), `Telnet`, `TFTP` (Trivial File
Transfer Protocol - Простой протокол передачи файлов).

![[Pasted image 20241105102037.png]]

> Прикладной уровень в модели TCP/IP эквивалентен комбинации прикладного, представительского и сеансового уровней в модели OSI

**Представительский уровень** (presentation layer, уровень 6) получает информацию от протоколов прикладного уровня и преобразует ее в формат, понятный всем компьютерам, использующим модель OSI. Этот уровень обеспечивает преобразование данных в структуру, которая может быть правильно обработана системой получателя. Это означает, что если пользователь создал документ Word и отправил его нескольким людям, им не обязательно иметь именно Word для работы с текстами; каждый из их компьютеров может принять этот файл, определить его формат и представить его пользователю в виде документа. Именно процесс преобразования данных, выполняемый на уровне представления, позволяет осуществлять это.

Представительский уровень не затрагивает сами данные – он работает с синтаксисом и форматом этих данных. Это похоже на работу транслятора, который переводит используемый приложением формат в стандартный формат, используемый для передачи сообщений по сети. Этот уровень также может выполнять сжатие и шифрование передаваемой информации.

**Сеансовый уровень** (session layer, уровень 5) отвечает за создание соединений между двумя приложениями и поддержку этих соединений в процессе передачи данных, а также контролирует закрытие этих соединений. Работа сеансового уровня делится на три этапа установление соединения, передача данных, завершение соединения. 

Вот некоторые протоколы, работающие на этом уровне: `NFS` (Network File System - Сетевая файловая система), `SQL` (Structured Query Language - Язык структурированных запросов), `NetBIOS`, `RPC` (Remote Procedure Call - Удаленный вызов процедур).

![[Pasted image 20241105103035.png]]

**Транспортный уровень**. Когда два компьютера собираются начать взаимодействие посредством протокола с предварительным установлением соединения (connection-oriented protocol), они сначала договариваются, как много информации каждый компьютер будет отправлять в единицу времени, как будет проверяться целостность данных при получении, и как будут выявляться потери пакетов в пути. Два компьютера договариваются об этих параметрах на транспортном уровне (transport layer, уровень 4) посредством процесса, называемого «рукопожатием» ( handshaking). Предварительное соглашение по этим вопросам помогает обеспечить более надежную передачу данных, выявление и исправление ошибок, восстановление, управление потоком, оптимизирует работу сетевых служб, необходимых для выполнения данной задачи. Транспортный уровень обеспечивает сервисы сквозной (end-to-end) передачи данных и устанавливает логическое соединение между двумя взаимодействующими компьютерами

Функциональность сеансового и транспортного уровней похожа (в том смысле, что они оба устанавливают некий тип сеанса или виртуального соединения для осуществления взаимодействия). Различие протоколов на этих уровнях состоит в том, что на сеансовом уровне устанавливается соединение между приложениями, тогда как на транспортном – между компьютерами.

Транспортный уровень получает данные от множества различных приложений и собирает данные в **потоки** для их корректной передачи по сети. Основными протоколами, работающими на данном уровне, являются `TCP` (Transmission Control Protocol - Протокол управления передачей), `UDP` (User Datagram Protocol - Протокол пользовательских датаграмм) и `SPX` (Sequenced Packet Exchange - Последовательный обмен пакетами).

![[Pasted image 20241105104236.png]]

> `TCP` форматирует данные от приложений в поток, подготавливая их к передаче

**Сетевой уровень**. Основной задачей сетевого уровня (network layer, уровень 3) является вставка в заголовок пакета информации, необходимой для правильной адресации и маршрутизации этого пакета с целью доставки правильному получателю. В сети множество маршрутов могут вести к одному и тому же получателю. Протоколы сетевого уровня должны выбрать наилучший маршрут для пакета. На этом уровне протоколы маршрутизации создают и поддерживают свои таблицы маршрутизации. Эти таблицы являются картой сети. Когда требуется отправить пакет от компьютера А компьютеру М, протокол проверяет таблицу маршрутизации, добавляет необходимую информацию в заголовок пакета и отправляет его по выбранному маршруту.

Работающие на данном уровне протоколы не контролируют доставку пакетов. Они зависят от протоколов транспортного уровня, которые выявляют любые проблемы и повторно отправляют пакеты при необходимости. Наиболее известный протокол, работающий на данном уровне – `IP` (Internet Protocol - Межсетевой протокол), хотя на этом уровне работает и масса других протоколов маршрутизации и маршрутизируемых протоколов, например, `ICMP` (Internet Control Message Protocol - Межсетевой протокол управляющих сообщений), `RIP` (Routing Information Protocol - Протокол информации маршрутизации), `OSPF` (Open Shortest Path First - Первоочередной выбор кратчайшего пути), `BGP` (Border Gateway Protocol - Протокол граничного шлюза), `IGMP` (Internet Group Management Protocol - Протокол управления межсетевыми группами)

![[Pasted image 20241105104759.png]]


**Канальный уровень**. Внешний формат пакетов данных незначительно меняется на каждом уровне, но, в конце концов, они приходят к точке, где нужно передавать двоичные данные по технологии LAN (Local Area Network - Локальная вычислительная сеть) или WAN (Wide Area Network - Глобальная вычислительная сеть). Это происходит на канальном уровне (data link layer, уровень 2).

Канальный уровень – это уровень, на котором сетевой стек знает, какой должен применяться формат кадра (frame) данных для правильной передачи через Token Ring, Ethernet, ATM (Asynchronous Transfer Mode - Асинхронный режим передачи) или FDDI (Fiber Distributed Data Interface - Распределенный волоконнооптический интерфейс данных) сети. Если сеть является сетью Ethernet, например, все компьютеры ожидают заголовок определенной длины, размещение флагов в определенных местах в пакете, информацию о содержимом пакета в определенных полях, на определенных местах.

Канальный уровень отвечает за обеспечение правильного взаимодействия в рамках используемой технологии, преобразование данных в необходимый формат для передачи на физический уровень. Также канальный уровень управляет переупорядочиванием кадров, которые принимаются не последовательно, и уведомляет вышестоящие протоколы о возникающих условиях для ошибок при передаче (transmission error conditions).

Канальный уровень делится на два функциональных подуровня – **Управление логической связью** (LLC – Logical Link Control) и **Управление доступом к среде** (MAC – Media Access Control). LLC определен в спецификации IEEE 802.2, он взаимодействует с протоколом, находящимся непосредственно над ним, на сетевом уровне. МАС использует соответствующие загруженные протоколы для взаимодействия с протоколом физического уровня.

Вот некоторые протоколы, которые работают на канальном уровне: `SLIP` (Serial Line Internet Protocol - Межсетевой протокол последовательной передачи), `PPP` (Point-to-Point Protocol - Протокол точка-точка), `RARP` (Reverse Address Resolution Protocol - Обратный протокол преобразования адресов), `L2F` (Layer 2 Forwarding - Туннельная схема пересылки на уровне 2), `L2TP` (Layer 2 Tunneling Protocol - Протокол туннелирования на уровне 2), `FDDI` (Fiber Distributed Data Interface - Распределенный волоконнооптический интерфейс данных), `ISDN` (Integrated Services Digital Network - Цифровая сеть с интегрированным обслуживанием).

![[Pasted image 20241105105439.png]]

> Канальный уровень преобразует данные в биты для их передачи на физический уровень

> Каждая сетевая технология (Ethernet, Token Ring и т.д.) определяет допустимые типы кабелей (коаксиальный, витая пара, оптоволоконный), которые требуются для работы сети. Также каждая сетевая технология определяет электрические сигналы и битовые маски (bit pattern). Это означает, например, что сигнал в 0,5 вольта может представлять 0 в одной технологии и 1 в другой. Протокол канального уровня определяет правильную битовую маску, а протокол физического уровня преобразует эту информацию в электрическую кодировку и электрические переходы состояний. Сетевые карты – это мост между канальным и физическим уровнями. Драйвер сетевой карты кодирует биты на канальном уровне в зависимости от используемой сетевой технологии (Ethernet, Token Ring, FDDI и т.д.). Затем эти биты преобразуются в электрические состояния на физическом уровне и помещаются в сетевой кабель для передачи.

**Физический уровень** (physical layer, уровень 1) преобразует биты в напряжения для передачи. Схемы сигналов и напряжений имеют различное значение в различных технологиях LAN и WAN. Если пользователь отправляет данные по телефонной сети через модем, формат данных, электрических сигналов и управление функционированием будут сильно отличаться от случая, когда пользователь отправляет данные через сетевую карту по витой паре в локальной сети. Механизмы, управляющие передачей данных по телефонной сети или по витой паре, работают на физическом уровне. Этот уровень контролирует синхронизацию, скорость передачи, шумы в линии, доступ к среде. Спецификации для физического уровня включают время изменения напряжения, уровни напряжения, физические коннекторы для электрической, оптической или механической передачи.

## 1.2. Функции и Протоколы модели OSI

**Прикладной уровень**

- Протоколы прикладного уровня осуществляют передачу файлов, обеспечивают работу виртуальных терминалов, реализуют управление сетью, выполняют сетевые запросы приложений.

**Представительский уровень**

- Сервисы представительского уровня обеспечивают перевод в стандартные форматы, компрессию/декомпрессию данных, шифрование/расшифрование данных. На этом уровне нет протоколов, на нем работают только сервисы.

**Сеансовый уровень**

- Протоколы сеансового уровня устанавливают соединения между приложениями, поддерживают управление диалогом, создают, поддерживают, разрывают коммуникационные каналы.

**Транспортный уровень**

- Протоколы транспортного уровня управляют сквозной передачей и сегментацией в потоках данных.

**Сетевой уровень**

- Протоколы сетевого уровня отвечают за сервисы межсетевого взаимодействия, адресацию и маршрутизацию.

**Канальный уровень**

- Протоколы канального уровня преобразуют данные в кадры LAN или WAN для передачи, преобразуют сообщения в биты, определяют, как компьютер взаимодействует с сетью. Этот уровень делится на подуровни LLC и MAC.

**Физический уровень**

- Сетевые карты и драйверы преобразуют биты в электрические сигналы и контролируют физические аспекты передачи данных, включая оптические, электрические и механические требования.

### 1.3. Совместная работа уровней

Модель OSI используется в качестве основы для множества продуктов множеством производителей. Различные типы устройств и протоколов работают на разных уровнях этой семиуровневой модели. В то время как компьютеры могут интерпретировать и обрабатывать данные на каждом из семи уровней, маршрутизаторы понимают информацию только на сетевом уровне, поскольку их основная функция заключается в маршрутизации пакетов, что не требует знаний другой информации пакета. Маршрутизаторы отделяют информацию заголовка при загрузке данных сетевого уровня, на котором размещается информация о маршрутизации и IP-адресах. Маршрутизатор анализирует эту информацию, чтобы принять решение – куда следует отправлять пакет. Мосты понимают только информацию канального уровня, а повторители – физического.

![[Pasted image 20241105110520.png]]


## 2. TCP/IP

**TCP/IP** (Transmission Control Protocol/Internet Protocol) – это набор протоколов, которые управляют перемещением данных от одного устройства к другому. Помимо двух основных одноименных протоколов, TCP/IP также содержит и другие протоколы. IP – это протокол сетевого уровня, который предоставляет сервисы маршрутизации датаграмм. Основной задачей IP является поддержка межсетевой адресации и маршрутизации пакетов. Это протокол, работающий без установления соединения, который оборачивает пришедшие с транспортного уровня данные. Протокол IP адресует датаграммы, используя IP-адреса отправителя и получателя. Протоколы в рамках набора TCP/IP соместно работают для того, чтобы разбить приходящие с прикладного уровня данные на части, которые могут быть переданы по сети. Они работают с другими протоколами для передачи данных компьютеру получателя, а затем, чтобы пересобрать данные в обратном порядке в форму, которая понятна прикладному уровню и которую он может обработать.

Двумя основными протоколами, работающими на транспортном уровне, являются TCP и UDP. TCP – это надежный протокол с предварительным установлением соединения (connection-oriented protocol). Это означает, что он убеждается в доставке сообщения компьютеру получателя. Если пакет был потерян в процессе передачи, TCP способен выявить это и повторно отправить потерянный или поврежденный пакет. TCP также поддерживает упорядочивание пакетов (гарантируя получение всех и каждого пакета), контроль потока и перегрузок канала связи, выявление и исправление ошибок. UDP, с другой стороны, обеспечивает лучшую скорость и не использует предварительное установление соединений (connectionless protocol). Он не поддерживает упорядочивание пакетов, не выявляет перегрузки канала связи, не требует подтверждения получения каждого пакета получателем.

### 2.1. TCP

TCP называют протоколом с предварительным установлением соединения, поскольку он перед реальной отправкой данных выполняет процедуру «рукопожатия» между двумя системами, собирающимися взаимодействовать. После успешного завершения «рукопожатия» устанавливается виртуальное соединение между двумя системами. UDP – это протокол, не испоьзующий предварительное установление соединения, поскольку он не выполняет этих шагов. Вместо этого UDP отправляет сообщения компьютеру получателя без предаварительного контакта с ним, не проверяя, были ли они получены или потеряны.

![[Pasted image 20241105111732.png]]

`UDP` и `TCP` являются транспортными протоколами, которые используются приложениями для обмена данными по сети. Оба они используют порты для взаимодействия с вышестоящими уровнями OSI и разделения различных взаимодействий, происходящих одновременно. Порты также являются механизмом, позволяющим определить к какой службе обращается другой компьютер. При формировании сообщения `TCP` или `UDP`, порты отправителя и получателя указываются в заголовке пакета вместе с адресами отправителя и получателя; адрес и номер порта создают сокет. Таким образом, пакеты знают, куда им нужно идти (по адресу) и с какой службой или протоколом взаимодействовать (по номеру порта). IP-адрес работает как дверь к компьютеру, а порт работает как дверь к определенному протоколу или службе. Для правильного взаимодействия пакет должен знать нужные ему двери.

![[Pasted image 20241105112032.png]]

Различие между `TCP` и `UDP` можно увидеть также в формате их сообщений. Поскольку `TCP` предоставляет больше сервисов, чем `UDP`, он должен включать больше информации в заголовки своих пакетов

![[Pasted image 20241105112402.png]]

**«Рукопожатие» TCP**

TCP должен установить виртуальное соединение между двумя хостами перед отправкой данных. Это означает, что два хоста должны договориться об определенных параметрах, потоке данных, кадрировании, выявлению ошибок и других опциях. Эти параметры настраиваются на этапе «рукопожатия» (handshaking)

![[Pasted image 20241105112454.png]]

Инициирующий взаимодействие хост отправляет получателю пакет синхронизации (`SYN` – synchronous packet). Получатель отвечает на него, отправляя пакет `SYN/ACK`. Этот означает что-то типа «я получил твой запрос и готов к взаимодействию с тобой». Хост отправителя отвечает на это пакетом подтверждения (`ACK` – acknowledgment packet), что означает «я получил твое подтверждение, давай начнем передачу данных». На этом процедура «рукопожатия» завершается, виртуальное соединение считается установленным и начинается реальная передача данных. Установленное соединение работает в дуплексном режиме, т.е. возможна одновременная передача данных в обоих направлениях.

**Структуры данных**

Когда приложение форматирует данные для отправки по сети, эти данные называют **потоком** (stream), либо **сообщением** (message). Они отправляются на транспортный уровень, где `TCP` колдует над данными. Там этот набор данных превращается в **сегмент** (segment). Сегмент отправляется на сетевой уровень. Сетевой уровень добавляет информацию для маршрутизации и адресации, после чего набор данных называется **датаграммой** (datagram). Сетевой уровень передает датаграмму на канальный уровень, который «обрамляет» ее заголовком (header) и окончанием (trailer). При этом датаграмма превращается в **кадр** (frame)

![[Pasted image 20241105120536.png]]

### 2.2. Адресация IP

Каждый узел в сети должен иметь уникальный IP-адрес. В настоящее время в большинстве случаев используется IP версии 4. 

IPv4 использует 32-битную адресацию, а IPv6 – 128-битную. Поэтому IPv6 предоставляет гораздо больше адресов. Каждый IP-адрес состоит из части, относящейся непосредственно к хосту, и части, относящейся к сети. Адреса группируются в классы, а затем в подсети. Маски подсетей делят адреса на группы, которые определяют подсети в сети. Классы адресов IPv4 приведены ниже:

![[Pasted image 20241105120715.png]]

Все подключенные к сети компании узлы могут иметь различные адреса хоста, но у них должен быть общий адрес сети. Адрес хоста идентифицирует каждый узел в отдельности, тогда как адрес сети идентифицирует сеть, к которой они подключены – поэтому адрес сети должен быть одинаковым для каждого из них. Любой трафик, предназначенный для узлов в этой сети, будет отправлен на адрес этой сети.

## 3. Типы передачи

Передача данных может осуществляться различными способами (аналоговыми или цифровыми), использовать различные схемы управления (синхронные или асинхронные), использовать для каждого канала отдельный провод (baseband – однополосная передача), либо размещать в каждом проводе по нескольку каналов (broadband – широкополосная передача).

### 3.1. Аналоговая и цифровая

**Аналоговая передача сигналов** – это постоянно изменяющаяся электромагнитная волна, которая может распространяться по воздуху, воде, витой паре, коаксиальному или оптоволоконому кабелю. С помощью процесса модуляции, данные объединяются с сигналом несущей, имеющим определенную частоту. Модуляция сигнала различается по амплитуде (высота сигнала) и частоте (число волн в определенный период времени)

Это означает, что данные размещаются на «спине» сигнала несущей частоты. Сигналы несущей частоты предоставляют многие радиостанции, частотные диапазоны и коммуникационные каналы. Каждая радиостанция имеет определенный сигнал несущей и частоту, используемую ей для передачи.

![[Pasted image 20241105123452.png]]

> Аналоговые сигналы измеряются по амплитуде и частоте, тогда как цифровые сигналы представляют собой двоичные цифры в виде электрических импульсов

**Цифровые сигналы** представляют собой двоичные цифры в виде электрических импульсов. Каждый отдельный импульс – это элемент сигнала, представляющий собой `1` или `0`. **Полоса пропускания** (bandwidth) при цифровой передаче – это число электрических импульсов, которые могут быть переданы через соединение в секунду, а эти электрические импульсы передают отдельные биты информации.

Цифровые сигналы более надежны, чем аналоговые, при передаче на большое расстояние и обеспечивают более четкий и эффективный метод передачи сигнала, т.к. гораздо проще сравнить наличие напряжения (1) с его отсутствием (0), чем сравнивать волны для интерпретации аналогового сигнала. Цифровой сигнал проще очистить от шумов и отраженных сигналов. Аналоговый сигнал гораздо сложнее отделить от фонового шума, поскольку амплитуда и частота волн постепенно теряют форму. Это связано с тем, что аналоговый сигнал может иметь бесконечное число значений и состояний, тогда как цифровой сигнал находится в дискретных состояниях. Цифровой сигнал – это волны прямоугольной формы, которые не имеют множества возможных значений, различной амплитуды и частоты как в аналоговом сигнале. Цифровые системы более совершенны, чем аналоговые, они могут передавать больше телефонных звонков и данных по одной и той же линии, обеспечивая при этом лучшее качество при передаче на большие расстояния.

### 3.2. Асинхронная и синхронная

Два устройства могут взаимодействовать синхронным или асинхронным образом в зависимости от типа связи и наличия какой-либо синхронизации двух этих устройств. **Асинхронная** связь применяется тогда, когда два устройства никак не синхронизированы. Отправитель может отправлять данные в любое время, а принимающая сторона должна быть все время готова к приему. **Синхронная** связь происходит между двумя синхронизированными (обычно с помощью часового механизма) устройствами

### 3.3. Однополосная и широкополосная

При **однополосной** (baseband) передаче весь коммуникационный канал используется для одной этой передачи, тогда как при **широкополосной** (broadband) передаче коммуникационный канал делится на отдельные независимые каналы, которые могут передавать одновременно различные типы данных. Однополосная передача позволяет передавать только один сигнал в единицу времени, тогда как широкополосная – много сигналов по различным каналам.

## 4. Организация локальных вычислительных сетей

Ниже представлены четыре основные причины для организации сети:
- Чтобы обеспечить взаимодействие между компьютерами
- Чтобы совместно использовать информацию
- Чтобы совместно использовать ресурсы
- Чтобы обеспечить централизованное администрирование

### 4.1. Топология сети

Физическое размещение компьютеров и устройств называется **сетевой топологией**. Топология указывает на способ, которым физически соединена сеть, показывает размещение ресурсов и систем. 

- **Топология «кольцо»** (ring topology) – это последовательное соединение устройств однонаправленными линиями связи
- **Топологии «шина»** (bus topology), единственный кабель проходит по всей длине сети. Узлы подключаются к сети «в разрыв» кабеля. Данные передаются по всей длине кабеля, и каждый узел может просмотреть любой передаваемых пакетов. Каждый узел решает, принять ему пакет или проигнорировать его, ориентируясь на указанный в пакете адрес компьютера-получателя.
- **Топология «звезда»** (star topology) все узлы подключаются к центральному устройству, такому как коммутатор (switch). Каждый узел имеет выделенное подключение к центральному устройству. Центральное устройство должно обеспечивать достаточную пропускную способность, чтобы не стать «бутылочным горлышком» для всей сети. Использование центрального устройства потенциально является единой точкой отказа, поэтому должна быть обеспечена некоторая избыточность. Коммутаторы могут быть настроены в плоской или иерархической реализации, которую могут использовать крупные компании.
- **Полносвязной топологии** (mesh topology) представляет собой сеть связанных друг с другом маршрутизаторов и коммутаторамов, обеспечивающих множественные маршруты передачи данных между всеми узлами в сети.

![[Pasted image 20241105125156.png]]

Независимо от используемой топологии, большинство сетей LAN имеет магистраль (backbone), являющуюся комбинацией кабелей и протоколов, которая связывает отдельные сетевые сегменты. Магистраль работает на более высокой скорости, чем отдельные сетевые сегменты, что позволяет быстро передавать данные из одной сети в другую. В то время как для сетевых сегментов лучше использовать UTP и Ethernet, для магистрали лучше подходит FDDI или Fast Ethernet.

### 4.2. Технологии доступа к среде LAN

LAN – это сеть, которая предоставляет общие коммуникации и ресурсы на относительно небольшой площади. Различия между LAN и WAN определяются физической средой, протоколами инкапсуляции и функциональностью.

**Ethernet** – это сетевая технология (LAN-sharing), позволяющая нескольким устройствам взаимодействовать в рамках одной сети. Ethernet обычно использует топологию «звезда» или «шина». Если используется топология линейной шины, все устройства подключаются к одному кабелю. Если используется топология «звезда», каждое устройство кабелем соединяется с центральным устройством (например, с коммутатором).

**Ethernet** определяется следующими характеристиками:
	- Общая среда (все устройства используют среду поочередно, возможно возникновение коллизий)
	- Использует широковещательные (broadcast) и коллизионные (collision) домены
	- Использует метод множественного доступа с контролем несущей и обнаружением коллизий (CSMA/CD – Carrier sense multiple access with collision detection)
	- Поддерживает полный дуплекс при реализации на витой паре
	- Может использовать среду с коаксиальным кабелем или витой парой
	- Определен стандартом IEEE 802.3

Ethernet определяет, каким образом компьютеры совместно используют общую сеть и как они обрабатывают коллизии, а также вопросы целостности данных, механизмы коммуникаций, управление передачей.

![[Pasted image 20241105125807.png]]

**Token Ring**

Как и Ethernet, Token Ring – это технология LAN, позволяющая передавать информацию и совместно использовать сетевые ресурсы. Технология Token Ring была разработана IBM и определена в стандарте IEEE 802.5. Она использует технологию передачи маркеров (токенов) в топологии, организованной в виде «звезды». Часть «ring» в имени технологии связана с потоком прохождения сигналов, образующим логическое кольцо. Каждый компьютер подключен к центральному концентратору, называющемуся модулем множественного доступа (MAU – Multistation Access Unit). Физически топология может быть организована в виде «звезды», однако сигналы проходят по логическому кольцу.

Технология передачи маркеров – это единственная технология, в которой данные не помещаются в сетевой провод, не имея специального маркера (token), являющегося управляющим кадром, путешествующим по логическому кольцу и захватывающимся, когда какой-либо системе нужно взаимодействовать с другой системой. Это отличается от Ethernet, в котором все устройства пытаются взаимодействоввать одновременно, из-за чего Ethernet зовут «болтливым протоколом», такой подход приводит к коллизиям. В Token Ring не бывает коллизий, так как только одна система может передавать информацию в каждый момент времени, однако из-за этого скорость передачи данных снижается по сравнению с Ethernet.

**FDDI**

Технология FDDI (Fiber Distributed Data Interface), применяется в качестве магистральной сети с использованием волоконно-оптических
кабелей. FDDI обеспечивает отказоустойчивость путем создания второго кольца, вращающегося в обратную сторону. В основном кольце данные «крутятся» по часовой стрелке, именно это кольцо обычно используется для передачи данных. Во втором кольце данные «крутятся» против часовой стрелки, оно используется только тогда, когда основное
кольцо не работает. Датчики следят за функционированием основного кольца и, если оно перестает работать, они переключают передачу данных на второе кольцо, задействуя для этого механизм восстановления целостности кольцевой сети (ring wrap). Каждый узел в сети FDDI имеет ретранслятор (relay), подключенный к обоим кольцам, поэтому в случае разрыва в кольце, оба кольца могут быть соединены.

### 4.3. Кабели

Прокладка сетевых кабелей играет важную роль при создании новой сети или расширении уже существующей. Типы используемых кабелей должны соответствовать используемым технологиям канального уровня. Кабели различаются по скорости передачи данных, максимальной длине, а также способам подключения к сетевым картам.

На поток электрических сигналов, проходящих через сетевые кабели, может негативно влиять множество факторов внешнего окружения, таких как, двигатели, флюоресцентное освещение, магнитные поля и различные электрические приборы. Эти факторы могут повредить проходящие через кабель данные. Именно поэтому применяются различные стандарты кабелей, определяющие тип кабеля, защитную оболочку, скорость передачи данных и возможную длину кабеля.

Кабели имеют различную ширину полосы пропускания и связанную с ней скорость передачи данных.

**Полоса пропускания** (bandwidth) кабеля указывает максимальный диапазон частот, которые он использует

**Скоростью передачи данных** (data throughput rate) является фактический объем данных, который в единицу времени проходит через кабель после сжатия и кодирования.

**Витая пара**

Витая пара состоит из изолированных медных проводов, заключенных во внешнюю защитную оплетку. **Экранированная витая пара** (STP – shielded twisted pair) имеет внешнюю защитную оплетку из фольги, которая улучшает защиту от радиочастотных и электромагнитных помех. Если витая пара не имеет дополнительного внешнего экранирования, она называется **неэкранированной витой парой** (UTP – unshielded twisted pair).

Кабель состоит из медных проводов, скрученных друг с другом. Это переплетение проводов защищает передаваемые сигналы от радиочастотных и электромагнитных помех, а также от перекрестных помех. Каждый провод образует уравновешенную схему, так как напряжение в каждой паре использует ту же амплитуду, но с противоположной фазой. Тугое переплетение проводов обеспечивает большую устойчивость кабеля от помех и затухания сигнала. В UTP входит несколько категорий кабелей, каждый из которых имеет свои уникальные характеристики. Разница в категориях кабеля основана на том, насколько туго сплетен кабель.

![[Pasted image 20241105144822.png]]

![[Pasted image 20241105144943.png]]

Медный кабель используется повсеместно в течение многих лет. Он недорог и прост в использовании. Витая пара предпочтительна при создании сетей, но у нее есть свои недостатки. Медь обладает электрическим сопротивлением, что приводит к деградации сигнала после прохождения им определенного расстояния. Именно поэтому даются рекомендации по максимальной длине медного кабеля. Если эти рекомендации не будут соблюдены, в сети могут происходить потери сигнала и повреждения данных. Кроме того, медь излучает энергию, что дает возможность злоумышленникам перехватывать передаваемую информацию. По сравнению с коаксиальным и оптоволоконным кабелем, UTP наименее безопасна. Если компании требуется более высокая скорость, более высокий уровень безопасности, а также большая длина кабелей, чем это позволяют медные кабели, наилучшим выбором для нее может быть оптоволоконный кабель.

**Оптоволоконный кабель**

Витая пара и коаксиальный кабель используют медные провода в качестве среды передачи данных, а оптоволоконный кабель использует разновидность стекла, через которое передаются световые волны. Эти световые волны переносят данные. Стеклянное ядро окружено защитной оболочкой, которая, в свою очередь, помещена в наружную оплетку.

Оптоволоконные кабели обеспечивают передачу сигналов на большие расстояния и с более высокой скоростью, поскольку для передачи данных используются световые волны. Оптоволоконные кабели не подвержены затуханию сигнала и электомагнитным помехам (EMI) в отличие от кабелей, в которых используются медные провода. Оптоволоконные кабели не излучают сигналы, в отличие от кабелей UTP, информацию с них трудно перехватить, поэтому оптоволоконные кабели гораздо более безопасны по сравнению с UTP, STP или коаксиальными кабелями.

Преимущества оптоволоконного кабеля звучат прекрасно, даже удивительно, зачем при этом продолжают использовать UTP, STP или коаксиальный кабель. К сожалению, оптоволоконный кабель чрезвычайно дорог и с ним трудно работать. Оптоволоконные кабели обычно используются в магистральных сетях и средах, которые требуют высокой скорости передачи данных. Большинство сетей используют UTP и подключены к магистралям, работающим на оптоволоконном кабеле.

**Проблемы, связанные с кабелями**

Кабели имеют чрезвычайно важное значение для сетей. Когда с сетевыми кабелями происходят проблемы, эти проблемы могут затронуть всю сеть. В этом разделе рассматриваются некоторые из наиболее распространенных проблем, связанных с кабелями, с которыми сталкивается большинство сетей.

**Помехи**

Помехи в кабелях обычно вызываются окружающим их оборудованием или характеристиками внешней среды. Помехи могут быть вызваны работой моторов, компьютеров, копировальных устройств, флюоресцентных ламп, микроволновых печей и т.п. Чем больше помех вокруг кабеля, тем более вероятно, что данные не дойдут до получателя или дойдут в искаженном виде.

![[Pasted image 20241105150140.png]]

**Затухание**

Затухание (attenuation) сигнала – это потеря мощности сигнала в процессе передачи. Чем длинее кабель, тем больше затухание, что может привести к повреждению данных. Поэтому в стандарты включены рекомендации по максимальной длине кабеля; когда данные прошли определенное расстояние, сопротивление потоку электронов накапливается и сигнал теряет целостность.

### 4.4. Методы передачи

Может потребоваться отправить пакет только одной рабочей станции, группе рабочих станций или одновременно всем рабочим станциям в подсети. Если пакет нужно отправить только одному получателю, используется метод **одноадресной** (unicast) передачи. Если пакет нужно отправить определенной группе получателей, отправляющая система использует метод **многоадресной** (multicast) рассылки. Если необходимо, чтобы сообщение получили все компьютеры в подсети, нужно использовать **широковещательный** (broadcast) метод.

### 4.5. Технологии доступа к среде
Физическая топология сети – это нижний уровень, фундамент сети. Она определяет тип
используемой среды и порядок соединения средой передачи данных различных систем.
Технологии доступа к среде определяют порядок взаимодействия систем через среду,обычно они представляют собой протоколы, драйверы сетевых карт и интерфейсы.

**CSMA**

Протоколы Ethernet определяют порядок взаимодействия узлов, исправления ошибок, использования общего сетевого кабеля. Ethernet использует `CSMA` для доступа к сетевому кабелю. Существует два различных типа `CSMA`: `CSMA/CD` и `CSMA/CA`. Передача данных называется несущей (carrier), поэтому, если компьютер передает кадры, он выполняет функции несущей. Если компьютеры используют протокол множественного доступа с контролем несущей и с выявлением коллизий (CSMA/CD – Carrier Sense Multiple Access with Collision Detection), они отслеживают передачу данных (или несущую) в проводе, чтобы определить наилучшее время для передачи данных. Каждый узел постоянно контролирует провод и ждет, пока он освободится, чтобы этот узел мог передать свои данные. В качестве аналогии представьте себе беседу нескольких людей. Если один человек хочет что-то сказать, он обычно сначала слушает уже говорящего и ждет паузы, чтобы начать говорить самому. Если он не будет дожидаться, пока договорит первый и будет говорить одновременно с ним, люди вокруг не смогут понять ни одного из говорящих.

При использовании метода доступа `CSMA/CD`, компьютеры прослушивают кабель и ждут момента, когда в нем не будет сигнала несущей, что означает, что никто не передает данные. Если два компьютера зафиксируют отсутствие несущей и одновременно начнут передачу своих данных, может произойти конфликт и коллизия. При возникновении конфликта (contention) все узлы должны прекратить совместное использование среды передачи данных. Коллизия (collision) происходит при столкновении двух или более кадров, что приводит к повреждению обоих кадров.

Множественный доступ с контролем несущей и предотвращением коллизий (CSMA/CA – Carrier Sense Multiple Access with Collision Avoidance) – это метод доступа, при использовании которого каждый компьютер сигнализирует о своем намерении передавать данные до начала реальной передачи. При получении такого сигнала все остальные компьютеры в сети понимают, что им пока нельзя передавать данные, т.к. это может привести к коллизии. Система прослушивает общую среду, чтобы определить, свободна ли она. Как только система определяет, что линия свободна и готова к передаче данных, эта система отправляет широковещательное сообщение всем остальным системам, говоря им, что она собирается передавать данные. После получения такого сообщения, каждая из остальных систем ждет определенный промежуток времени перед попыткой самой начать передачу данных, чтобы избежать коллизий. Технологии беспроводных сетей 802.11 используют технологию CSMA/CA для доступа к среде.

**Коллизионные домены**

Коллизии происходят в сетях Ethernet, когда два компьютера пытаются передавать данные одновременно. Другие компьютеры в сети выявляют эту коллизию, т.к. при этом наложившиеся друг на друга сигналы увеличивают напряжение сигнала выше определенного уровня. Чем больше устройств в конкурентной (contention-based) сети, тем выше вероятность коллизий, что увеличивает латентность такой сети (задержки при передаче данных). **Коллизионный домен** (collision domain) – это группа компьютеров, которые конкурируют (или соперничают) за доступ к среде передачи данных.

Неприемлемое количество коллизий может быть вызвано перенаселенностью сети, повреждением сетевого кабеля или коннектора, слишком большим количеством повторителей, либо кабелем, длина которого превышает рекомендуемый максимум. Если кабель длинее, чем это рекомендуется спецификацией Ethernet, два компьютерам на противоположных концах кабеля могут начать передавать данные одновременно. При этом они могут не узнать о том, что произошли коллизии, поскольку они находятся слишком далеко друг от друга. Если кабель слишком длинный, компьютеры не могут прослушивать сеть достаточно хорошо, чтобы выявлять коллизии. При получении компьютером-получателем разрушенного кадра, он отправляет запрос отправителю на повторную передачу сообщения, что становится причиной увеличения трафика.

Проблемы такого типа в основном связаны с реализацией коллизионных доменов. Сеть Ethernet может иметь широковещательные и коллизионные домены. Одна подсеть будет находиться в одном коллизионном и широковещательном домене, если она не разделена маршрутизаторами или мостами. Если подсеть разделена мостами, мосты могут позволить широковещательному трафику проходить между различными частями подсети, но не коллизиям.

![[Pasted image 20241105152439.png]]

Другое преимущество ограничения и управления широковещательными и коллизионными доменами состоит в том, что это затрудняет перехват злоумышленником критичной информации, передающейся по сети (сниффинг). Атакующие часто используют тактику установки на скомпрометированный компьютер троянской программы, выполняющей функции сетевого сниффера. Этот сниффер обычно настраивается на перехват определенной информации, такой как имена пользователей и пароли. Если широковещательный и коллизионный домен находятся под таким воздействием, скомпрометированная система может получить доступ к широковещательному и коллизионному трафику только в рамках отдельной подсети или широковещательного домена. Скомпрометированная система не сможет прослушивать трафик в другом широковещательном и коллизионном домене, что значительно снизит объем трафика и информации, доступной атакующему

## 4.6. Протоколы LAN

Некоторые протоколы, такие как `UDP`, `TCP` и `IP`, обсуждались в предыдущих разделах. Сети используют эти и многие другие протоколы, для реализации определенного объема функциональности. Наиболее широко используются такие протоколы `TCP/IP`, как `ARP`, `DHCP` и `ICMP`. Они будут обсуждаться в следующих разделах.

**ARP**

В сети `TCP/IP` каждому компьютеру и сетевому устройству требуется уникальный IP-адрес и уникальный физический аппаратный адрес. Каждая сетевая карта имеет уникальный физический аппаратный адрес, который прошивается производителем в микросхеме ее ПЗУ. Этот физический адрес также называют МАС-адресом (Media Access Control). Сетевой уровень работает с IP-адресами и понимает только их, а канальный уровень - МАС-адреса.

Когда данные приходят с прикладного уровня, они поступают на транспортный уровень для присвоения порядкового номера, создания сеанса и включения в поток. Затем данные переходят на сетевой уровень, где к каждому пакету добавляется информация маршрутизации и IP-адреса отправителя и получателя. Затем данные направляются на канальный уровень, который должен найти МАС-адрес и добавить его в заголовок кадра. Когда кадр физически попадает в провод, он направляется по МАС-адресу, указанному в заголовке кадра. Работающие на этом уровне модели OSI механизмы не понимают IP-адреса.

Чтобы сетевое взаимодействие было возможно, MAC- и IP-адреса должны быть корректно сопоставлены. Это производится с помощью протокола ARP (Address Resolution Protocol - Протокол определения адреса). Когда канальный уровень получает кадр, сетевой уровень уже прикрепил к нему IP-адрес получателя, но канальный уровень не понимает IP-адресов, поэтому он призывает на помощь ARP. ARP делает широковещательный запрос МАС-адреса, соответствующего указанному IP-адресу получателя. Каждый компьютер в подсети получает этот запрос и игнорирует его, если его IP-адрес не соответствует запрашиваемому. Только компьютер с соответсвующим запрашиваемому IP-адресом отвечает на запрос, указывая в ответе свой МАС-адрес. Теперь ARP знает, какой аппаратный адрес соответствует этому IP-адресу. Канальный уровень добавляет к кадру МАС-адрес и передает его на физический уровень, который помещает его в провод для отправки компьютеру-получателю. ARP таким образом связывает аппаратный адрес с соответствующим ему IP-адресом и сохраняет информацию об этой связи в специальной таблице, чтобы в дальнейшем использовать ее повторно и сэкономить время. В случае, если новый кадр будет адресован тому же IP-адресу, такое кэширование позволяет ARP не выполнять повторный широковещательный запрос – он просто берет информацию из своей таблицы.

Иногда атакующие изменяют ARP-таблицу системы, внося в нее некорректную информацию. Это называется «**отравлением ARP**» (ARP table poisoning). Целью атакующего в этом случае является получение пакетов, предназначенных для другого компьютера. Это разновидность атаки маскарадинга (masquerading attack). Например, компьютер `А` имеет IP-адрес `10.19.34.3` и МАС-адрес `X`, и эта информация сохранена в ARP-таблице компьютера `В`. Атакующий может изменить эту ARP-таблицу и указать, что IP-адрес `10.19.34.3` соответствует МАС-адресу `Y` (МАС-адресу компьютера атакующего). Тогда все пакеты компьютера `В`, которые он будет пытаться отправить на компьютер `А`, в действительности будут отправляться на компьютер атакующего.

**DHCP**

Компьютер при первоначальной загрузке может получить IP-адреса несколькими
различными способами. Если он имеет статический адрес, ему не нужно присваивать
никаких других адресов. Если компьютеру требуется DHCP-сервер (Dynamic Host
Configuration Protocol - Протокол динамической конфигурации узла) для получения
корректного IP-адреса, при загрузке он направляет запрос DHCP-серверу, который
присваивает ему IP-адрес.

`DHCP` – это протокол, основанный на `UDP`, который позволяет серверам присваивать сетевым клиентам IP-адреса в режиме реального времени. В стандартной сети, использующей `DHCP`, для получения IP-адреса клиентский компьютер отправляет по сети широковещательное сообщение `DHCPDISCOVER` (обнаружение `DHCP`), чтобы найти `DHCP`-сервер. Когда соответствующий `DHCP`-сервер получает запрос `DHCPDISCOVER`, он отвечает на него пакетом `DHCPOFFER` (предложение `DHCP`), предлагая клиенту IP-адрес. Сервер присваивает клиенту свободный IP-адрес в соответствии с административными политиками сети. Отправляемый сервером пакет `DHCPOFFER` содержит информацию о присвоенном IP-адресе и конфигурационных параметрах для настройки служб на стороне клиента. После получения клиентом направленных сервером в пакете `DHCPOFFER` настроек, он отвечает серверу пакетом `DHCPREQUEST`, подтверждая принятие этих настроек. Сервер в ответ отправляет подтверждение пакетом `DHCPACK`, указывая в нем период действия (аренды) предоставленных параметров

![[Pasted image 20241106130542.png]]

К сожалению, при этом обе стороны (и клиент, и сервер) уязвимы к фальсификации. На стороне клиента атакующий может сделать собственную систему похожей на легитимного клиента сети. Это позволит его системе стать частью сети компании и попытаться проникнуть на другие системы этой сети. Также, атакующий может создать поддельный DHCP-сервер в сети, который будет взаимодействовать с настоящими клиентами, ищущими IP-адреса. Управляемый атакующим DHCP-сервер может скомпрометировать настройки клиентской системы, выполнить атаку «человек посередине» (`man-in-the-middle`), несанкционированно пересылать трафик в другую сеть и т.п., и в конечном итоге подвергнуть опасности всю сеть.

Эффективным методом защиты сетей от неуполномоченных клиентов DHCP является использование перехвата DHCP ( DHCP snooping) на сетевых коммутаторах. Перехват DHCP обеспечивает, что DHCP серверы могут присваивать IP-адреса только выбранным системам, идентифицированным по их MAC-адресам. Также, современные коммутаторы имеют возможность направления клиентов непосредственно легитимным серверам DHCP для получения IP-адресов, исключая возможность для злоумышленника сделать свою систему DHCP-сервером сети.

**ICMP**

Протокол ICMP (Internet Control Message Protocol - Межсетевой протокол управляющих сообщений) передает статусные сообщения, отчеты об ошибках, ответы на некоторые запросы, отчеты по информации маршрутизации. Он используется для проверки соединений и выявления проблем в IP-сетях. Проще всего понять протокол ICMP с помощью утилиты ping. Эта утилита нужна для проверки соединения с другой системой. Она отправляет проверяемой системе кадр `ICMP ECHO REQUES`T, а та отвечает на него кадром `ICMP ECHO REPLY`, получение которого утилита `ping` отображает на экране. Если ответ не был получен в течение определенного периода времени, утилита `ping` повторно отправляет кадры `ECHO REQUEST`. Если ответа снова нет, утилита `ping` сообщает, что проверяемая система недоступна.

## 5. Протоколы маршрутизации

Отдельные сети в Интернет называются **автономными системами** (AS – autonomous system). Эти AS независимо управляются различными корпорациями и организациями. AS создаются с помощью маршрутизаторов, самостоятельно администрируемых каждой компанией, которой принадлежит соответствующая AS. Границы AS определяются граничными маршрутизаторами, на границах используюется протокол `IGP` (Interior Gateway Protocol - Внутренний шлюзовой протокол). Граничные маршрутизаторы одной AS соединяются с граничными маршрутизаторами других AS, при этом применяются внутренние и внешние протоколы маршрутизации. Внутренние маршрутитизаторы соединяются с другими маршрутизаторам в рамках одной AS, при этом применяются внутренние протоколы маршрутизации. Таким образом, Интернет – это в действительности просто сеть, созданная из автономных систем и протоколов маршрутизации.

Протоколы маршрутизации используются маршрутизаторами для определения маршрута между системами отправителя и получателя.

![[Pasted image 20241106131423.png]]

Протоколы маршрутизации могут быть динамическими или статическими. **Динамический протокол маршрутизации** (dynamic routing protocol) может находить маршруты и строить таблицу маршрутизации. Маршрутизаторы используют таблицы маршрутизации для принятия решения о наилучшем маршруте для поступивших пакетов. Динамический протокол маршрутизации может изменять записи в таблице маршрутизации на основе изменений различных маршрутов. Когда маршрутизатор, использующий динамический протокол маршрутизации, обнаруживает, что какой-либо маршрут не работает или перегружен, он отправляет соответствующее уведомление об этом другим маршрутизаторам вокруг него. Получившие это уведомление маршрутизаторы обновляют на основе него свои таблицы маршрутизации, что необходимо для реализации эффективной маршрутизации. **Статический протокол маршрутизации** (static routing protocol) требует ручной настройки таблицы маршрутизации администратором.

Такие изменения маршрутов, вызванные постоянным изменением доступности маршрутизаторов, называются **колебанием маршрутов** (route flapping). Если маршрутизатор не получил уведомление о неработоспособности какого-либо маршрута, он продолжит пересылать пакеты по этому маршруту, который в этом случае будет называться черной дырой (black hole).

Двумя основными типами используемых протоколов маршрутизации являются протокол **дистанционно-векторной маршрутизации** (distance-vector routing protocol) и **протокол маршрутизации по состоянию канала** (link-state routing protocol). 

Протоколы **дистанционно-векторной маршрутизации** принимают решения о маршрутах на основе расстояния (или количества «прыжков» (hop)) и вектора (направления). Протокол использует эти переменные в алгоритме определения лучшего маршрута для пакета. 

Протоколы маршрутизации по **состоянию канала** строят более точную таблицу маршрутизации, поскольку они строят топологическую базу данных сети. Эти протоколы анализируют большее количество переменных, чем просто количество «прыжков» между двумя системами – в своих алгоритмах определения наилучшего маршрута для пакета они используют такие параметры, как размер пакета, скорость соединения, задержки, загруженность и надежность.

`RIP` – это пример протокола дистанционно-векторной маршрутизации, а `OSPF` – пример протокола маршрутизации по состоянию канала. `OSPF` более предпочтителен и чаще используется в больших сетях. `RIP` также применяется, но его используют в основном в маленьких сетях.

- **RIP** (Routing Information Protocol - Протокол информации маршрутизации) – это стандарт, который описывает, как маршрутизаторы обмениваются данными таблиц маршрутизации. Он основан на протоколе дистанционно-векторной маршрутизации, т.е. он рассчитывает самое короткое расстояние между отправителем и получателем. Он считается унаследованным протоколом, поскольку имеет низкую производительность и небольшую функциональность. Его следует использовать только в небольших сетях. Следует также учитывать, что RIP версии 1 не имеет аутентификации, RIP версии 2 отправляет пароли открытым текстом, либо хэширует с помощью MD5.
- **OSPF** (Open Shortest Path First - Протокол маршрутизации по принципу выбора кратчайшего пути) использует для отправки данных таблиц маршрутизации алгоритмы, учитывающие состояние канала. Применение этих алгоритмов позволяет выполнять небольшие, но более частые обновления таблиц маршрутизации, что обеспечивает большую стабильность сети (по сравнению с RIP), но требует больше памяти и ресурсов процессора для поддержания этих процессов. OSPF позволяет использовать иерархическую маршрутизацию сети, которая имеет магистраль, соединяющую вместе все подсети. На сегодняшний день OSPF заменил RIP во множестве сетей. В OSPF аутентификация может осуществляться с помощью пароля, передаваемого открытым текстом, либо хэш-функции пароля, но также существует возможность отключить аутентификацию на маршрутизаторах с ис ользованием этого протокола.
- **IGRP** (Interior Gateway Routing Protocol - Протокол внутренней маршрутизации между шлюзами) – это протокол дистанционно-векторной маршрутизации, который был разработан Cisco и является ее собственностью. В то время как RIP использует только один критерий для поиска наилучшего маршрута между отправителем и получателем, IGRP использует 5 критериев для принятия решения о наилучшем маршруте. Сетевой администратор может настроить вес этих различных критериев, чтобы обеспечить максимально эффективную работу этого протокола в конкретной сети.

Внешние протоколы маршрутизации, используемые для соединения маршрутизаторами различных AS, обычно называются **внешними шлюзовыми протоколами** ( `EGP` – Exterior Gateway Protocol). `BGP` (Border Gateway Protocol – Граничный шлюзовой протокол) позволяет маршрутизаторам различных AS совместно использовать информацию маршрутизации для обеспечения оптимальной и эффективной маршрутизации между различными сетями. `BGP` обычно применяется интернет-провайдерами для маршрутизации данных в Интернете из одного места в другое.

`BGP` использует комбинацию алгоритмов дистанционно-векторной маршрутизации и маршрутизации по состоянию канала. Он строит базу данных сетевой топологии, используя для этого свою функциональность контроля состояния канала, и передает обновления таблицы маршрутизации на периодической основе, аналогично протоколам дистанционно-векторной маршрутизации, а не непрерывно. Сетевой администратор может указать вес для различных переменных, используемых этим протоколом для контроля состояния канала при выборе наилучшего маршрута. Эти настройки в общем виде называются политикой маршрутизации (routing policy).

Существует несколько типов атак на маршрутизаторы, которые проводятся посредством используемых ими протоколов маршрутизации. Целью большинства таких атак является нарушение маршрутов трафика путем использования ложных ICMP-сообщений. Атакующий может выдавать свой компьютер за другой маршрутизатор и изменить с помощью него таблицу маршрутизации на маршрутизаторе-жертве. После применения маршрутизатором этой ложной информации, он может начать отправлять трафик неправильным подсетям или компьютерам, либо вообще несуществующим адресам (черная дыра). Эти атаки чаще всего оказываются успешными, если на маршрутизаторе не включена аутентификация для протокола маршрутизации. Если аутентификация не выполняется, маршрутизатор принимает и применяет обновления таблиц маршрутизации, не зная, является ли отправитель этих обновлений легитимным маршрутизатором. Атакующий может изменить маршруты трафика компании для получения конфиденциальной информации или просто нарушения потока трафика, что будет аналогично DoS-атаке. Существуют и другие типы DoS-атак, такие как флудинг порта маршрутизатора, переполнение буфера, SYN-флуд. Существует множество различных типов атак, а также множество соответствующих им конрмер, о которых следует знать для эффективного противодействия этим атакам. Большинство этих контрмер используют аутентификацию и шифрование передаваемых данных маршрутизации с использованием общих ключей или IPSec.

## 6. Сетевые устройства

В средах LAN, MAN, WAN используется большое количество различных типов устройств, обеспечивающих взаимодействие между компьютерами и сетями. Применение тех или иных устройств зависит от их функциональности, возможностей, интеллектуальности и положения в сети:
	- Повторители
	- Мосты
	- Маршрутизаторы
	- Коммутаторы

![[Pasted image 20241108103322.png]]

### 6.1. Повторители

**Повторитель** (repeater) обеспечивает простейший тип связи, поскольку он только повторяет и усиливает электрические сигналы между сегментами кабеля, позволяя расширить сеть. Повторители работают на физическом уровне и являются дополнительными устройствами, позволяющими расширить сеть, увеличив расстояние, на которое могут передаваться данные. Это устройство усиливает сигналы, затухающие при прохождении по сети.

Повторители могут также работать в качестве стабилизаторов, очищая сигнал от помех. При усилении цифрового сигнала это работает намного лучше, чем при усилении аналогового сигнала, т.к. цифровой сигнал является дискретным, что упрощает извлечение из него фонового шума. При усилении аналогового сигнала, вместе с ним также прекрасно усиливаются все сопутствующие шумы, что может привести к разрушению сигнала.

**Концентратор** (hub, хаб) – это многопортовый повторитель. Концентратор является физическим коммуникационным устройством, позволяющим нескольким компьютерам и другим устройствам взаимодействовать друг с другом. Концентратор не понимает и не работает с IP- или МАС-адресами. Когда одна система отправляет сигнал другой системе, подключенной к концентратору, сигнал рассылается широковещательно на все порты и, соответственно, на все системы, подключенные к этому концентратору.

### 6.2. Мосты

**Мост** (bridge) – это устройство, используемое для соединения сегментов LAN. Мост работает на канальном уровне и поэтому использует МАС-адреса. Повторитель не использует адреса – он просто пересылает все получаемые им сигналы. Когда кадр поступает на мост, мост определяет, принадлежит ли его МАС-адрес локальному сетевому сегменту. Если МАС-адрес не принадлежит локальному сетевому сегменту, он пересылает кадр в нужный ему сетевой сегмент.

Мост используется для разделения перегруженной сети на небольшие сегменты, для обеспечения наилучшего использования полосы пропускания и управления трафиком. Мост усиливает электрические сигналы, также как это делает повторитель, но он интеллектуальнее повторителя. Мост применяется для расширения LAN, а также позволяет администратору фильтровать кадры, определяя какой кадр куда отправить.

### 6.3. Маршрутизаторы

Мы передвигаемся вверх по уровням модели OSI в процессе обсуждения различных сетевых устройств. **Повторители** работают на **физическом уровне**, **мосты** – на **канальном**, а **маршрутизаторы** – на **сетевом уровне**. Устройства на каждом вышестоящем уровне более интеллектуальны и функциональны и глубже заглядывают в кадры. Повторитель смотрит только на электрический сигнал. Мост смотрит на МАС-адрес в заголовке. Маршрутизатор снимает с кадра первый (внешний) заголовок и заглядывает в кадр глубже в поисках IP-адреса и другой информации маршрутизации. Чем выше уровень устройства в модели OSI, тем глубже устройство может изучить кадр и принять больше решений на основе содержащейся в нем информации..

**Маршрутизаторы** (router) работают на третьем (сетевом) уровне. Они используются для соединения похожих или различных сетей (например, с помощью них можно соединить две сети Ethernet или сеть Ethernet с сетью Token Ring). Маршрутизатор – это устройство, которое имеет два или более интерфейсов и таблицу маршрутизации, с помощью которой он принимает решения о том, как отправлять пакеты по назначению. Маршрутизатор может фильтровать трафик на основе списков контроля доступа (ACL), фрагментировать пакеты при необходимости. Поскольку маршрутизаторы больше знают о сети, они могут выполнять более высокоуровневые функции, такие как расчет самого короткого и экономичного пути между узлами отправителя и получателя.

**Маршрутизатор** получает информацию о маршрутах и изменениях в сети с помощью протоколов маршрутизации (`RIP`, `BGP`, `OSPF` и т.п.). Эти протоколы сообщают маршрутизатору об отключениях каналов, перегрузках маршрутов, а также уведомляют о других, более экономичных, маршрутах. Также, с помощью этих протоколов обновляются таблицы маршрутизации и передаются сообщения о возникновении у маршрутизатора проблем или его отключении.

Мост использует одни и те же сетевые адреса для всех своих портов, а у маршрутизатора используются отдельные адреса для каждого порта, что позволяет ему соединять различные сети.

Что в действительности происходит внутри маршрутизатора, когда он получает пакет?
1. Кадр принят одним из интерфейсов маршрутизатора. Маршрутизатор анализирует данные маршрутизации.
2. Маршрутизатор отыскивает в датаграмме IP-адрес (подсеть) получателя.
3. Маршрутизатор просматривает свою таблицу маршрутизации в поисках своего порта, соответствующего IP-адресу (подсети) получателя.
4. Если маршрутизатор не находит в своей таблице информации об адресе получателя, он отправляет компьютеру-отправителю ICMP-сообщение об ошибке, говоря ему, что не может найти получателя.
5. Если маршрутизатор находит нужный маршрут в своей таблице маршрутизации, он уменьшает значение TTL и смотрит, не отличается ли значение MTU в сети получателя. Если в сети получателя требуется MTU меньшего размера, маршрутизатор производит фрагментацию датаграммы.
6. Маршрутизатор изменяет информацию в заголовке кадра, чтобы он смог пройти к следующему маршрутизатору или компьютеру-получателя (если маршрутизатор непосредственно подключен к сети, в которой находится компьютер-получатель).
7. Маршрутизатор направляет кадр в очередь на отправку соответствующего своего интерфейса.

### 6.4. Коммутаторы

**Коммутаторы** (switch) сочетают в себе функциональность повторителей и мостов. Коммутатор усиливает электрический сигнал, как повторитель, и имеет встроеннные компоненты и интеллектуальность моста. Это многопортовое устройство, позволяющее соединить отдельные компьютеры или другие коммутаторы и концентраторы. Любое устройство, подключенное к одному из портов коммутатора, может взаимодействовать с другими устройствами, подключенными к другим его портам, используя при этом собственные виртуальные частные соединения. В чем заключается отличие коммутаторов от концентраторов или мостов? Когда концентратор получает кадр, он отправляет его по всем своим портам. Когда кадр получает мост, он отравляет его в порт, к которому подключен сетевой сегмент получателя. Когда кадр получает коммутатор, он отправляет его напрямую компьютеру-получателю (или сети получателя), что позвляет уменьшить трафик.

![[Pasted image 20241108101802.png]]

В сетях Ethernet компьютеры используют общую сетевую среду. Каждый компьютер должен прослушивать сетевую активность и передавать данные, когда он думает, что сетевая среда свободна. Конфликты и коллизии вызывают задержки трафика и повышают загрузку полосы пропускания. Если используются коммутаторы, конфликты и коллизии перестают быть проблемой, что повышает эффективность использования полосы пропускания и снижает латентность сети. Коммутаторы снижают или полностью устраняют совместное использование сетевой среды, исключая связанные с этим проблемы.

**Коммутатор** – это многопортовое устройство сопряжения, каждый порт которого предоставляет выделенную полосу пропускания для подключенного к нему устройства. Порт соединяется с другим портом, что позволяет двум устройствам создать частное соединение точка-точка. Коммутатор применяет полнодуплексную связь, одна пара проводов в нем используется для отправки, а другая – для приема. Это позволяет двум подключенным устройствам не соревноваться за использование общей полосы пропускания.

Обычные коммутаторы работают на канальном уровне и пересылают трафик на основе МАС-адресов. Однако на сегодняшний день существуют коммутаторы, работающие на 3, 4 и других уровнях, и обеспечивающие более широкую функциональность, чем коммутаторы 2 уровня. Такие высокоуровневые коммутаторы зачастую обладают функциями маршрутизации, анализа пакетов, приоритезации трафика, функциональностью QoS. Эти коммутаторы называют многоуровневыми (multilayered switch), поскольку они сочетают в себе функциональность канального, сетевого и других уровней.

**Коммутаторы уровней 3 и 4**

Интеллектуальности коммутаторов втоорого уровня достаточно только для пересылки кадров на основе МАС-адресов, но они не имеют представления о сети в целом. Коммутаторы третьего уровня обладают интеллектуальностью маршрутизатора. Они не только могут маршрутизировать пакеты на основе их IP-адресов, они также могут выбирать маршруты на основе их доступности и производительности. Коммутаторы третьего уровня – это «продвинутые» маршрутизаторы, т.к. они переводят функции анализа маршрутов на более эффективный аппаратный уровень.

Основным различием между коммутаторами 2, 3 и 4 уровней является информация заголовка, которую они анализируют для принятия решения о пересылке или маршрутизации. Коммутаторы 3 и 4 уровней могут использовать теги, которые связаны с каждой целевой сетью или подсетью. Когда пакет приходит на коммутатор, он сравнивает адрес получателя со своей Базой информации о тегах (Tag Information Base), которая является списком всех подсетей и соответствующих им номеров тегов. Коммутатор добавляет тег к пакету и отправляет его следующему коммутатору. Все коммутаторы между первым (ближайшим к отправителю) коммутатором и узлом получателя просто просматривают информацию о теге для выбора маршрута, а не анализируют весь заголовок. Когда пакет приходит на последний (ближайший к получателю) коммутатор или маршрутизатор, этот тег удаляется и пакет отправляется получателю. Использование тегов увеличивает скорость маршрутизации пакетов от одного места к другому. Использование такого типа тегов, называемое MPLS (Multiprotocol Label Switching - Мультипротокольная коммутация по меткам), позволяет не только увеличить скорость маршрутизации, но и учесть требования по уровню сервиса для различных типов пакетов. Некоторый чувствительный ко времени трафик (такой как видео-конференции) требует определенного уровня сервиса (QoS), гарантирующего минимальную скорость доставки, которая соответствует требованиям приложения или пользователя. При использовании MPLS, информация о приоритетах указывается в тегах, помогая обеспечить чувствительному ко времени трафику более высокий приоритет, чем всему остальному

![[Pasted image 20241108102400.png]]

Поскольку безопасность требует контроля доступа к определенным ресурсам, более интеллектуальные устройства обеспечивают более высокий уровень защиты, т.к. они могут принять больше ориентированных на детали решений о доступе к ресурсам. Если устройство может заглянуть глубже в пакеты, оно может узнать больше информации для принятия решения о возможности предоставления доступа, что обеспечивает более детальный контроль.

Использование коммутируемых сетей создает злоумышленникам больше сложностей в части возможного перехвата и мониторинга сетевого трафика, т.к. в таких сетях широковещательная и коллизионная информация не передается постоянно через всю сеть. Коммутаторы, в отличие от других устройств предоставляют также сервисы безопасности. **Виртуальные сети** (VLAN – Virtual LAN) также являются важной частью коммутируемой сети, поскольку они позволяют администраторам получить больше возможностей для управления сетевой средой. С помощью VLAN’ов можно изолировать пользователей и группы в логичные и управляемые единицы.

**Виртуальные сети (VLAN)**

Технологии в лице коммутаторов позволили реализовать функциональность **виртуальных сетей (VLAN)**. VLAN’ы позволяют администраторам разделить и сгруппировать компьютеры логически, на основе необходимых им ресурсов, безопасности или потребностей бизнеса, вместо стандартной группировки систем на основе их физического размещения, которая применяется при использовании повторителей, мостов и маршрутизаторов.

![[Pasted image 20241108102804.png]]

Администратору может понадобиться, например, разместить компьютеры всех пользователей Департамента маркетинга в одном VLAN. При этом все эти пользователи будут получать одни и те же широковещательные сообщения и смогут использовать одни и те же типы ресурсов. Такое распределение позволяет администратору включить в тот же VLAN несколько пользователей, размещенных в другом здании или на другом этаже. VLAN’ы также позволяют администратору применять различные политики безопасности для различных логических групп. Например, если требуется максимальная безопасность для бухгалтерии, администратор может разработать политику, добавить все бухгалтерские системы в отдельный VLAN и применить к нему эту политику безопасности.

> VLAN расположен над физической сетью

![[Pasted image 20241108102948.png]]

### 6.5. Шлюзы

Термин «**шлюз**» (gateway) обычно относится к программному обеспечению, запущенному на устройстве, которое объединяет две различных среды, часто работая в качестве транслятора для них, либо некоего ограничителя их взаимодействия. Обычно шлюз требуется в случае, когда объединяемые среды «говорят на разных языках», т.е. одна среда использует протокол, который другая среда не понимает.

Шлюзы выполняют гораздо более сложные задачи, чем сетевые устройства типа маршрутизаторов и мостов. Однако некоторые называют маршрутизаторы шлюзами, если они соединяют две различных сети (например, Token Ring и Ethernet), поскольку маршрутизаторы также могут транслировать технологии канального уровня.

Если сеть подключена к магистрали, шлюз может транслировать различные технологии и форматы кадров между магистральной сетью и LAN. Если бы между магистралью FDDI и сетью Ethernet был установлен мост, компьютеры в LAN вероятно не смогли бы понять кадры протоколов FDDI. Для такой трансляции протоколов может понадобиться шлюз.

### 6.6. Межсетевые экраны

**Межсетевые экраны** (firewall – фаерволлы) используются для ограничения доступа в одну сеть из другой. Большинство компаний используют межсетевые экраны для ограничения доступа из Интернет в свою сеть. Также межсетевые экраны можно использовать для ограничения доступа из одного внутреннего сетевого сегмента в другой. Например, если сетевому администратору нужно быть уверенным, что обычные сотрудники не имеют доступа в сеть Исследований и Разработки, он может установить межсетевой экран между этой сетью и всеми остальными сетями, настроив его на разрешение только одного типа трафика, который он считает приемлемым.

Межсетевой экран поддерживает и реализует политику сетевой безопасности компании. Организационная политика безопасности дает высокоуровневые инструкции по приемлемым и неприемлемым действиям, относящимся к безопасности. Межсетевой экран реализует более детальную и конкретную политику безопасности, которая определяет, каким службам и по каким портам разрешен доступ, а какие IP-адреса и диапазоны должны быть заблокированы. Межсетевой экран называют «бутылочным горлышком» сети, поскольку через него должны проходить все коммуникации для проверки и ограничения трафика.

Межсетевой экран может быть встроен в маршрутизатор или являться специализированным аппаратным устройством. Он выполняет мониторинг пакетов, которые приходят и исходят из защищаемой им сети. Он отфильтровывает пакеты, которые не соответствуют требованиям политики безопасности. В зависимости от настроек и политики безопасности межсетевой экран может уничтожать такие пакеты, переупаковывать их или перенаправлять. Фильтрация пакетов осуществляется на основе адресов их отправителя и получателя, номеров портов (сервисов), типов пакетов, типов протоколов, информации в заголовках, битов последовательности и т.д. Сетевые администраторы могут использовать специальные функции и параметры для идентификации и ограничения доступа.

Часто компании устанавливают межсетевой экран для создания **демилитаризованной зоны** (DMZ – Demilitarized Zone), которая является сетевым сегментом, размещенным между защищенными и незащищенными сетями. С помощью DMZ реализуется буферная зона между опасным Интернетом и ценными активами внутренней сети, которые компания пытается защитить.

Для создания DMZ обычно устанавливаются два межсетевых экрана. В DMZ обычно размещаются веб, почтовые и DNS-серверы, которые должны быть надлежащим образом защищены, поскольку они являются первой линией обороны от атак. Часто в DMZ размещают сенсоры IDS, которые выявляют нежелательное и подозрительное поведение.

![[Pasted image 20241108103854.png]]

Существует множество различных типов межсетевых экранов, поскольку каждая сеть может иметь уникальные требования и цели безопасности. Межсетеве экраны развиваются и эволюционируют, повышается их эффективность и функциональность. Далее мы поговорим о следующих типах межсетевых экранов:
- С фильтрацией пакетов (packet filtering)
- С контролем состояния (stateful)
- Прокси (proxy)
- С динамической фильтрацией пакетов (dynamic packet filtering)
- Прокси ядра (kernel proxy)

Затем мы разберем три основные архитектуры межсетевых экранов:
- Экранированный узел (screened host)
- Двойная привязка (dual-home)
- Экранированная подсеть (screened subnet)

**Межсетевые экраны с фильтрацией пакетов**

Фильтрация пакетов (packet filtering) – это метод обеспечения безопасности, позволяющий контролировать, какие данные могут войти в сеть и/или выйти из нее. Пакетная фильтрация использует списки контроля доступа (ACL), настроенные на устройстве. ACL – это строки текста, называемые правилами, которые устройство применяет к каждому полученному им пакету. Эти правила четко определяют, какие пакеты могут быть разрешены, а какие должны быть отклонены.

Такая фильтрация основана на информации сетевого уровня, что означает, что это устройство не может очень глубоко анализировать сам пакет. Оно может принимать решения только на основе ограниченной информации заголовка. Большинство маршрутизаторов используют ACL, работая в качестве межсетевого экрана, и используют таблицу маршрутизации для принятия решений о маршрутизации пакетов, но они не могут предоставить того уровня защиты, который обеспечивают другие межсетевые экраны, глубже анализирующие пакеты. Поскольку при фильтрации пакетов анализируется только информация заголовка, такие устройства не зависят от конкретного приложения, также как и многие прокси. Межсетевые экраны с фильтрацией пакетов не отслеживают состояние соединения, в отличие от межсетевых экранов с контролем состояния

> Фильтрация пакетов – это метод, используемый первым поколением межсетевых экранов

Ниже приведены некоторые слабости межсетевых экранов с фильтрацией пакетов:
- Они не могут предотвратить атаки, которые используют функции и уязвимости, относящиеся к конкретным приложениям (на прикладном уровне).
- Функциональность журналирования в межсетевых экранах с фильтрацией пакетов ограничена.
- Большинство межсетевых экранов с фильтрацией пакетов не поддерживают современные схемы аутентификации пользователей.
- Многие межсетевые экраны с фильтрацией пакетов не могут выявить сетевые пакеты, в которых информация 3-го уровня модели OSI была изменена (является ложной) (spoofed).
- Используя небольшое количество переменных при принятии решения о доступе, межсетевые экраны с фильтрацией пакетов подвержены проблемам безопасности, вызванным неправильными настройками.

**Межсетевые экраны с контролем состояния**

При использовании фильтрации пакетов, каждый пришедший пакет маршрутизатор проверяет по своему ACL, чтобы решить, должен ли пакет быть принят или отклонен. Если пакет разрешен, он передается на узел получателя или другой маршрутизатор, после чего маршрутизатор забывает про этот пакет. В этом заключается отличие от фильтрации с контролем состояния, при которой маршрутизатор «помнит» и отслеживает проходящие пакеты до тех пор, пока не будет закрыто соединение, в рамках которого они передавались

Межсетевой экран, реализующий фильтрацию пакетов с контролем состояния (statefulinspection firewall), похож на соседа с длинным носом, который все слышит, следит – кто и что делает, постоянно встревает в разговоры. Он знает кто, что и кому сказал. Это может сильно раздражать, но если дом вдруг ограбят, помощь этого соседа будет просто неоценима. Он все знает и сможет рассказать полиции, что произошло. Аналогичным образом работает межсетевой экран с контролем состояния. Он также отслеживает, что компьютеры говорят друг другу, и хранит всю эту информацию в таблице состояний (state table), которая похожа на лист с записями чужих разговоров.

Межсетевые экраны с контролем состояния также принимают решения о разрешении или отвержении пакетов, но их функциональность находится на шаг дальше. Например, обычное устройство с фильтрацией пакетов может блокировать любые UDP-пакеты, запрашивающие сервис на 25-м порту, а устройство с фильтрацией пакетов и контролем состояния можно настроить таким образом, чтобы оно разрешало UDP-пакеты только в том случае, если они являются ответами на направленные ранее исходящие запросы.

> Например, Вася отправляет запрос на компьютер в другой сети. Этот запрос записывается в таблицу состояний межсетевого экрана, который «запоминает», что компьютер Васи сделал запрос и что ему должен прийти ответный пакет, который нужно переслать Васе. Когда запрошенный Васей компьютер в Интернете отвечает на его запрос, эти пакеты сравниваются с записями в таблице состояний межсетевого экрана. Поскольку в таблице состояний есть информация о предыдущем запросе Васи, межсетевой экран принимает эти пакеты и пропускает их дальше – Васе. С другой стороны, если Васи не делал никаких запросов, а пакеты все же пришли из Интернет, межсетевой экран не найдет в своей таблице состояний информации о предыдущем запросе, и тогда он будет проверять эти пакеты по своей ACL, чтобы решить, следует ли пропускать эти пакеты в сеть.

Обычная фильтрация пакетов сравнивает входящие пакеты с правилами, указанными в ACL межсетевого экрана. Когда пакеты принимает межсетевой экран с контролем состояния, он сначала анализирует свою таблицу состояний, чтобы проверить, было ли уже установлено соответствующее соединение и были ли запрошены эти данные. Если он не находит уже установленного соединения или запроса, пакет проверяется по ACL межсетевого экрана. Если в соответствии с ACL такой тип трафика разрешен, пакету разрешается доступ в сеть. В противном случае пакет уничтожается.

Большинство межсетевых экранов с контролем состояния работают на сетевом и транспортном уровнях. Это зависит от конкретного продукта, но часто при установлении соединения, межсетевой экран исследует все уровни пакета (все заголовки, информацию и окончания). Если инициирующие соединение пакеты прошли такое глубокое исследование, межсетевой экран в дальнейшем просто анализирует сетевой и транспортный заголовки, чтобы сохранить информацию о сеансе. Такое уменьшение глубины проверки увеличивает производительность.

Хотя контроль состояния является большим шагом вперед в безопасности, он добавляет дополнительные сложности, т.к. устройство должно теперь хранить динамическую таблицу состояний и «помнить» соединения. К сожалению, межсетевые экраны с контролем состояния подвержены многим типам DoS-атак. Многие типы атак против таких межсетевых экранов направлены на переполнение (flooding) таблицы состояний ложной информацией. Таблица состояний – это такой же конечный ресурс, как простанство жесткого диска системы, объем свободной памяти и процессорное время. Если таблица состояний полностью заполняется ложной информацией, устройство может зависнуть или перезагрузиться. Кроме того, если такой межсетевой экран перезагрузится по какой-либо причине, это приведет к потере им информации об установленных соединениях, из-за чего он будет отклонять легитимные пакеты.

Характеристики межсетевого экрана с контролем состояния. Ниже представлены некоторые важные характеристики межсетевого экрана с контролем состояния:
- Отслеживает каждый коммуникационный канал, записывая информацию в таблицу состояний
- Обеспечивает высокий уровень безопасности и не наносит большого ущерба производительности (по сравнению с прокси прикладного уровня)
- Является масштабируемым и прозрачным для пользователя
- Предоставляет данные для отслеживания протоколов без установления соединений, таких как UDP и ICMP
- "Запоминает" и актуализирует состояние и контекст данных в пакетах
- Считается межсетевым экраном третьего поколения

**Прокси**

**Прокси** (proxy) – это посредник. Он перехватывает и исследует сообщения перед тем, как они будут доставлены их получателям. 

Прокси принимает входящее в сеть или исходящее из сети сообщение, проверяет его на наличие вредоносной информации и, если он решает, что с пакетом все в порядке, пропускает пакет на компьютер-получатель. Прокси – это второе поколение межсетевых экранов.

Прокси стоят между доверенной и недоверенной сетями, они устанавливают соединения от лица источника. Если пользователь в сети Интернет посылает запрос на отправку данных компьютеру во внутренней защищенной сети, прокси первым получает этот запрос и анализирует его на наличие подозрительной информации. При этом запрос не отправляется автоматически компьютеру-получателю, вместо этого прокси сам принимает запрос от лица компьютера, который он защищает. Если прокси решает, что пакет безопасен, он отправляет его компьютеру-получателю. Когда компьютер-получатель отвечает, его ответ идет обратно к прокси, который переупаковывает пакет, чтобы включить в него в качестве адреса отправителя собственный адрес, а не адрес компьютера во внутренней сети. **Очень важно, что прокси разрывает коммуникационный канал – прямое соединение между внешними и внутренними компьютерами отсутствует.**

Межсетевой экран такого типа создает копию каждого принятого пакета и передает дальше именно копию. Создавая копию, он переупаковывает пакет, чтобы скрыть его настоящего отправителя. Если атакующий просканирует сеть компании, он получит только информацию, которая была перехвачена и переупакована прокси. Возвращаемые пакеты будут иметь только IP-адрес прокси и очень мало информации, нужной атакующему. Таким образом, с помощью такого межсетевого экрана внутренняя сеть защищается и скрывается.

Прокси – это единственная машина, которая взаимодействует с внешним миром, обеспечивая отсутствие прямого доступа к внутренним компьютерам. Соответственно, прокси является единственным узлом, котрому нужен внешний IP-адрес. Остальные компьютеры во внутренней сети могут использовать внутренние адреса (немаршрутизируемые в сеть Интернет), поскольку все равно нет внешних компьютеров, которые могут увидеть их адреса.

### Различия между сетевыми межсетевыми экранами

![[Pasted image 20241108111559.png]]


Ниже приведены некоторые лучшие практики, применимые к любому типу межсетевых
экранов:
	• Блокируйте перенаправление ICMP-трафика
	• ACL следует делать проще и прямолинейнее
	• Запрещайте маршрутизацию от источника
	• Закрывайте ненужные порты с потенциально опасными службами
	• Блокируйте неиспользуемые интерфейсы
	• Блокируйте направленные широковещательные IP-рассылки
	• Блокируйте входящие пакеты с внутренними адресами (это может быть признаком их подделки (спуфинга))
	• Блокируйте трафик многоадресных рассылок, если они не требуются
	• Включите журналирование

### Архитектура межсетевых экранов

Межсетевые экраны могут быть размещены во множестве различных мест в сети для
реализации различных потребностей. Они могут защищать внутреннюю сеть от воздействий из внешней сети, являясь узким местом для всего трафика. Межсетевой экран может использоваться для сегментирования сети, реализации управления доступом между двумя и более подсетями. Межсетевой экран может также использоваться для создания DMZ между внутренней сетью и внешней сетью. Межсетевой экран следует устанавливать на узлах-бастионах, на которых заблокированы все сервисы, кроме необходимых для выполнения ими своих функций.

**Узел-бастион**. Узел-бастион (bastion host) – это просто другое название укрепленных (hardened) систем. Узел-бастион обычно открыт для внешних атак, поскольку он устанавливается на передовой линии сетевой безопасности, именно он является системой, которая видна из Интернета. Соответственно, это узел-бастион должен быть максимально защищен – на нем не должны быть запущены ненужные сервисы, неиспользуемые подсистемы должны быть заблокированы, для уязвимостей должны быть установлены соответствующие патчи, ненужные учетные записи должны быть заблокированы, а все ненужные для выполнения его функций порты должны быть закрыты. Узел-бастион не связан с программным обеспечением межсетевого экрана и его работой. Это просто система, которая надежно защищена. Любая размещенная в DMZ система должна быть установлена на узле-бастионе, поскольку она находится в непосредственной близости от Интернета и злоумышленников, которые могут нанести ей вред. Если программное обеспечение межсетевого экрана установлено не на защищенную операционную систему или узел-бастион, сам такой межсетевой экран является уязвимым.

**Межсетевой экран с двойной привязкой**. Двойная привязка ( dual-homed) означает, что устройство имеет два интерфейса: один смотрит во внешнюю сеть, а другой – во внутреннюю. Если программное обеспечение межсетевого экрана установлено на устройство с двойной привязкой (обычно так и бывает), в его операционной системе должна быть отключена пересылка и маршрутизация сетевых пакетов, исходя из соображений безопасности. Если эти функции не отключены, к компьютеру не будут применены необходимые правила ACL и другие ограничения, применение которых требуется от межсетевого экрана. Когда пакет из недоверенной сети приходит на подключенную к ней (внешнюю) сетевую карту межсетевого экрана с двойной привязкой, в настройках операционной системы которого не отключена пересылка трафика, его операционная система просто перешлет пакет на сетевую карту, подключенную к внутренней доверенной сети, без проведения анализа пакета программным обеспечением межсетевого экрана.

**Экранированный узел**. Экранированный узел (screened host) – это межсетевой экран, который взаимодействует напрямую с маршрутизатором периметра и внутренней сетью. Полученный из Интернет трафик сначала проходит фильтрацию пакетов на внешнем
маршрутизаторе. Прошедший через маршрутизатор трафик отправляется на экранированный узел – межсетевой экран, который применяет дополнительные правила к трафику и уничтожает запрещенные пакеты. Затем трафик передается на узел получателя во внутренней сети. Экранированный узел (межсетевой экран) – это устройство, которое принимает трафик напрямую от маршрутизатора. Никакой внешний трафик не может пройти напрямую от маршрутизатора во внутреннюю сеть, минуя межсетевой экран.

**«Обязанности» межсетевых экранов**

«По умолчанию» любой межсетевой экран должен блокировать любые пакеты, кроме разрешенных явно. Соответственно, если в правилах межсетевого экрана не указано, какие пакеты являются разрешнными, он должен блокировать все принимаемые пакеты. Любой входящий в сеть пакет, в котором в качестве адреса отправителя указан адрес узла внутренней сети, должен блокироваться. Маскарадинг (masquerading), или спуфинг (spoofing), является популярной атакой, при которой атакующий изменяет заголовок пакета, указывая в нем в качестве адреса отправителя адрес внутреннего узла, который он хочет атаковать. Такой пакет в любом случае следует считать поддельным и нелегитимным, поскольку нет причин, по которым пришедший из сети Интернет пакет имел бы в качестве адреса отправителя адрес, принадлежащий внутренней сети. Поэтому межсетевой экран должен блокировать такой пакет. То же самое относится и к исходящему трафику. Не следует разрешать исходящий из сети трафик, в пакетах которого в адресе отправителя указан адрес, не принадлежащий внутренней сети. Если межсетевой экран выявляет такие пакеты, это означает, что кто-то или что-то во внутренней сети занимается подделкой сетевых пакетов (спуфингом). C большой вероятностью, это может быть следствием работы зомби-агентов, использующихся для проведения DoS- (DDoS-) атак.

### 6.7. Хост-приманка

Хост-приманка (honeypot) – это компьютер, который размещается обычно в экранированной подсети или DMZ и пытается привлечь внимание атакующих к себе и, соответственно, отвлечь их от реально использующихся в работе компьютеров.

Чтобы сделать хост-приманку привлекательным для атакующих, администраторы могут разрешить на них наиболее часто атакуемые службы и порты. Однако администратор должен позаботиться, чтобы эта система была полностью изолированной, чтобы атакующий, скомпрометировав ее, не мог получить доступ к другим компьютерам в сети. На некоторых хостах-приманках администраторы создают эмуляцию отдельных служб, т.е. реальная служба на них не запущена, но работа программного обеспечения организована так, что для атакующего это выглядит как работающая и доступная служба.

### 6.8. Разделение и изоляция сетей

Очень важно отделять сети и подсети друг от друга. Обычно это означает необходимость установки маршрутизаторов, которые не пропускают информацию широковещательных и коллизионных доменов, используют различные диапазоны адресов для различных сегментов. Большинство сетей в наше время используют технологию Ethernet, постоянно выполняющую широковещательную рассылку информации, которая может быть полезна внешним и внутренним атакующим. Поскольку данные свободно распространяются в такой среде, вам следует убедиться, что части сети, в которых хранится критичная информация, надлежащим образом отделены в отдельные сегменты от других частей сети.

Архитектура сети должна быть хорошо продумана от начала до конца, полностью
документирована и тщательно протестирована. К примеру, сетевой администратор может решить ограничить прямой доступ к мейнфрейму, на котором хранится критичная
информация. Соответствующий трафик следует направить через один канал и фильтровать его маршрутизатором или межсетевым экраном. Также, администратор может решить, что не все пользователи сети должны иметь доступ к административной подсети, в которой размещены консоли управления для всех маршрутизаторов, систем IDS, серверов, на которых хранятся журналы регистрации событий. Компьютеры из административной подсети должны иметь возможность взаимодействия с остальными частями сети, но нет никаких оснований, чтобы обычные пользователи имели возможность свободного доступа в административную подсеть. Доступ в эту подсеть следует изолировать с помощью списков контроля доступа, реализуемых с помощью окружающих маршрутизаторов (или межсетевых экранов) и правильной сегментации.

Документирование архитектуры сети является хорошей идеей, но то, что она отражена на бумаге, не делает ее правильной. Если на схеме сети указано, что с помощью межсетевого экрана исключено взаимодействие подсети А с подсетью В, это должно быть тщательно протестировано, должна быть проведена попытка атаки ( тест на проникновение), чтобы понять, так ли это на самом деле.

## 7. Сетевые сервисы и Протоколы

### 7.1. Трансляция сетевых адресов

**NAT** (Network Address Translation - Трянсляция сетевых адресов), которая позволяет сетям не следовать схеме адресации Интернета, но при этом иметь возможность взаимодействия через Интернет.

Для использования во внутренних сетях LAN были зарезервированы частные IP-адреса, описанные в RFC 1918. Эти адреса могут использоваться внутри компании, но они не могут использоваться в Интернет, поскольку они не могут маршрутизироваться. NAT позволяет компании использовать эти частные адреса, имея при этом возможность для прозрачного взаимодействия с компьютерами в Интернете.

NAT скрывает внутренние адреса, объединяя их на одном устройстве, в результате чего любые исходящие из сети кадры имеют в качестве адреса источника только адрес этого устройства, а не фактический адрес компьютера, отправившего сообщение. Например, если сообщение отправлено внутренним компьютером с адресом 10.10.10.2, это сообщение останавливается на устройстве, на котором запущено программное обеспечение NAT. Это устройство имеет IP-адрес 1.2.3.4. NAT изменяет заголовок кадра, устанавливая вместо внутреннего адреса 10.10.10.2 адрес устройства NAT 1.2.3.4. Когда компьютер в Интернете отвечает на это сообщение, он отправляет ответ на адрес 1.2.3.4. Устройство NAT меняет адрес получателя в заголовке ответного сообщения на 10.10.10.2 и отправляет его по внутренней сети соответствующему пользователю.

Может применяеться три основных типа реализации NAT:
- **Статическая трансляция** (static mapping). Программное обеспечение NAT имеет настроенный пул внешних IP-адресов. Каждый частный адрес статически связывается с определенным внешним адресом. При этом компьютер А всегда получает внешний адрес X, компьютер В всегда получает внешний адрес Y и т.д. Обычно такая реализация NAT используется для серверов, которым нужно постоянно иметь один и тот же внешний адрес.
- **Динамическая трансляция** (dynamic mapping). Программное обеспечение NAT также имеет пул внешних IP-адресов, но вместо статической привязки внешних адресов определенным внутренним адресам, динамическая трансляция работает по принципу «первый пришел, первым обслужен». Так, если Бобу нужно взаимодействовать через Интернет, его система делает запрос к серверу NAT. Сервер NAT привязывает первый внешний IP в своем списке к частному адресу Боба. При этом следует оценить, как много компьютеров обычно будет взаимодействовать с внешними сетями одновременно. Эта оценка позволит определить необходимое количество внешних адресов, которые нужно купить компании (вместо покупки по одному внешнему адресу на каждый внутренний компьютер). 
- **Трансляция адресов портов** (PAT – Port address translation). Компания имеет и использует только один внешний IP-адрес для всех систем, которым нужно взаимодействовать с внешними сетями. Но как во внешней сети все компьютеры могут использовать один и тот же IP-адрес? Хороший вопрос. Например, устройство NAT имеет внешний IP-адрес 127.50.41.3. Когда компьютеру А требуется взаимодействовать с системой в Интернете, устройство NAT фиксирует частный адрес этого компьютера и исходящий номер порта (10.10.44.3, порт 44887). Устройство NAT меняет IP-адрес в заголовке пакета с адреса этого компьютера на 127.50.41.3 с исходящим портом 40000. Когда компьютеру В также требуется взаимодействовать с системой в Интернете, устройство NAT фиксирует его частный адрес и исходящий номер порта (10.10.44.14, порт 23398) и изменяет информацию в заголовке на адрес 127.50.41.3 с исходящим портом 40001. Когда внешняя система отвечает компьютеру А, пакет сначала идет на устройство NAT, которое видит номер порта 40000 и делает вывод, что пакет предназначен для компьютера А. Поэтому устройство NAT меняет информацию в заголовке на адрес 10.10.44.3 и порт 43887 и отправляет его компьютеру А для обработки. Компания может существенно сэкономить, используя РАТ, поскольку нужно купить только несколько внешних IP-адресов, которые будут использоваться всеми системами внутренней сети.

Большинство реализаций NAT контролируют состояние (stateful), т.е. они отслеживают
взаимодействие между внутренними и внешними узлами до окончания сеанса. Устройство NAT должно помнить внутренний IP-адрес и порт для обратной отправки сообщений. Эти характеристики контроля состояния похожи на межсетевые экраны с контролем состояния, но NAT не выполняют анализ входящих пакетов с целью выявления в них вредоносных компонентов. NAT является службой, обычно выполняющейся на маршрутизаторах или межсетевых экранах в рамках экранированной подсети компании.

**Коммутация**

Выделенные каналы имеют единственный маршрут передачи, поэтому не возникает
сложностей при определении способа отправки пакетов различным получателям. Между
двумя сетями существует лишь две точки. Однако это становится намного сложнее, когда речь идет о тысячах связанных друг с другом сетей, возникает необходимость в коммутации (switching).

Могут использоваться два основных типа коммутации: коммутация каналов (circuit switching) и коммутация пакетов ( packet switching). При коммутации каналов устанавливается виртуальное соединение, которое работает как выделенная линия между двумя системами. ISDN и телефонная связь являются примерами коммутации каналов

![[Pasted image 20241108115250.png]]

**Коммутация пакетов** не создает выделенного виртуального соединения, пакеты одного
соединения могут пройти через целый ряд различных отдельных устройстввместо того, чтобы следовать друг за другом через одно и то же устройство.

В сети с коммутацией пакетов данные разбиваются на пакеты, содержащие номер в последовательности для проверки кадра. Эти пакеты проходят через различные устройства, их пути могут быть динамически изменены маршрутизатором или коммутатором, определяющими наилучший маршрут для каждого конкретного пакета. После получения пакетов компьютером получателя, все пакеты пересобираются в соответствии с номерами последовательности, указанными в кадрах, и затем интерпретируются

**Коммутация каналов** vs. **Коммутация пакетов**. Ниже представлено краткое резюме по различиям между технологиями коммутации каналов и пакетов.

**Коммутация каналов**:
	• Виртуальные каналы с предварительным установлением соединения
	• Трафик передается предсказуемым и постоянным образом
	• Фиксированные задержки
	• Обычно применяется для передачи голосовых данных
**Коммутация пакетов**:
	• Пакеты до одного и того же получателя могут передаваться по различным маршрутам, выбираемым динамически
	• Трафик обычно хаотичен по своему характеру
	• Переменная величина задержек
	• Обычно применяется для передачи данных (не голосовых)

## 11. Удаленный доступ

### 11.1. VPN

**Виртуальная частная сеть** (VPN – Virtual Private Network) – это безопасное частное соединение через общедоступные сети или иные небезопасные среды. Это частное соединение, поскольку в нем используются протоколы шифрования и туннелирования для обеспечения конфиденциальности и целостности передаваемых данных. Важно помнить, что технология VPN для работы требует создания туннеля, обеспечивающего шифрование трафика. Для VPN могут быть использованы такие протоколы, как `PPTP` (Point-to-Point Tunneling Protocol), `IPSec` и `L2TP`.

![[Pasted image 20241108120002.png]]

> VPN обеспечтивает виртуальную выделенную линию связи между двумя субъектами через публичную сеть

На отправляющей и принимающей стороне должно использоваться оборудование и программное обеспечение, необходимое для создания шифрованного туннеля, который обеспечивает защиту (приватность) соединения. Протокол туннелирования шифрования используется для шифрования данных и защиты информации при ее передаче через недоверенные публичные сети, такие как Интернет.

Удаленные пользователи или мобильные сотрудники могут использовать VPN для подключения к сети компании и доступа к своей электронной почте, сетевым ресурсам и корпоративным активам. На компьютере удаленного пользователя должно быть установлено необходимое программное обеспечение, позволяющее ему использовать VPN. Пользователь сначала создает PPP-подключение к провайдеру, а провайдер соединяет его с нужной сетью. PPP инкапсулирует датаграммы для их передачи по телекоммуникационным каналам. После установления соединения PPP программа пользователя инициирует создание VPN-соединения с сетью компании. Поскольку данные, которыми будут обмениваться две стороны, должны шифроваться, обе стороны проходят через этап «рукопожатия», согласовывая тип шифрования и ключ, который будет использоваться для шифрования передаваемых данных. Провайдер участвует в этом только на этапе создания PPP-соединения, которое является фундаментом для VPN-соединения. Как только PPP-соединение установлено, участие провайдера заканчивается, и начинается этап заключения соглашения о параметрах VPN, которые будут использоваться в дальнейшем для обеспечения защищенного взаимодействия пользователя и сети компании. После завершения этого этапа, пользователь может безопасно взаимодействовать с сетью компании через новое виртуальное соединение.

Соединения VPN могут использоваться не только удаленными пользователями для доступа к сети, но и для обеспечения связи между двумя маршрутизаторами (часто это называют подключениями шлюз-шлюз). Это гибкое соединение, оно требует только наличия у каждой из соединяющихся сторон программного обеспечения VPN, необходимых протоколов и одинаковых механизмов шифрования. После того, как VPN-соединение будет установлено, пользователь сможет получить доступ к сетевым ресурсам.

**Протоколы туннелирования**

Туннель (tunnel) – это виртуальный маршрут через сеть, по которому передаются инкапсулированные и, возможно, зашифрованные пакеты.

Туннелирование является основным компонентом для VPN, т.к. именно таким образом создаются соединения VPN. В основном используются три основных протокола туннелирования для соединений VPN: PPTP, L2TP и IPSec

> Перед углублением в подробности протоколов туннелирования, давайте еще раз взглянем на протокол инкапсуляции. Протоколы туннелирования и инкапсуляции связаны между собой, поскольку протоколы туннелирования используют инкапсуляцию. Инкапсуляция означает, что в кадр добавляется дополнительный заголовок, и, возможно, еще одно окончание. Протокол туннелирования добавляет эти заголовки и окончания для того, чтобы пакеты могли быть переданы по сети определенного типа. Таким образом, если вам необходимо передавать пакеты сетевого и транспортного протоколов IPX/SPX через сеть Интернет, шлюз будет добавлять необходимые заголовки и окончания TCP/IP, необходимые для маршрутизации в Интернете. После того, как эти пакеты будут доставлены до места назначения, дополнительные заголовки и окончания удаляются, и пакеты направляются на компьютер получателя.

**PPP** (Point-to-Point Protocol - Протокол "точка-точка") в действительности является не протоколом туннелирования, а протоколом инкапсуляции. Он не нуждается в добавлении специальных заголовков и окончаний, которые будут удалены в пункте назначения. PPP позволяет передавать трафик TCP/IP через среду, созданную для передачи голосовых данных.

**PPP** используется для инкапсуляции сообщений и их передачи через последовательную линию. Он позволяет передавать протоколы TCP/IP (и другие) через телекоммуникационные каналы.

**PPTP**

Зачем нужны протоколы туннелирования? Это связано с тем, что некоторые протоколы не могут маршрутизироваться через определенные сети.

Самостоятельно некоторые кадры не могут найти правильный маршрут через Интертет к получателю, для этого им нужна поддержка. Именно для этого и нужны протоколы туннелирования. Представьте себе паром, который перевозит автомобили на другой берег реки. Автомобиль не может сам переправиться на другую сторону, т.к. он не предназначен для перемещения по воде, а паром может перемещаться по воде, и может перевезти автомобиль. Аналогично протокол туннелирования может перемещаться по сети Интернет, основанной на IP.

**PPTP** (Point-to-Point tunneling protocol - Туннельный протокол "точка-точка") – это протокол Microsoft, позволяющий удаленным пользователям устанавливать PPP-соединения с локальным провайдером, а затем создавать безопасные соединения VPN до пункта назначения. В течение многих лет PPTP был де-факто стандартом протокола туннелирования, однако в настоящее время новым стандартом де-факто для VPN стал **IPSec**.

Хотя по умолчанию туннелирование не обеспечивает шифрование пользовательских данных, в большинстве реализаций туннелирование и шифрование используются совместно. При использовании PPTP, содержимое PPP шифруется с помощью MPPE (Microsoft Point-to-Point Encryption), используя MS-CHAP или EAP-TLS. Используемые для этого ключи шифрования генерируются в процессе аутентификации между пользователем и сервером аутентификации.

Помимо шифрования, кадры должны быть инкапсулированы. В этой технологии применяется последовательность инкапсуляций. Пользовательские данные инкапсулируются в `PPP`, затем этот кадр инкапсулируется `PPTP` с заголовками `GRE` (Generic Routing Encapsulation) и `IP`. Такая инкапсуляция позволяет полученному в результате кадру маршрутизироваться через публичные сети, такие как Интернет.

![[Pasted image 20241108122432.png]]

Единственным ограничением PPTP является то, что он может работать только через сети IP, поэтому для передачи данных через соединения Frame Relay, X.25 и АТМ должны применяться другие протоколы

**L2TP**

`L2TP` реализует функциональность `PPTP`, однако он в сочетании с `IPSec` обеспечивает более высокий уровень безопасности и, кроме того, может работать не только через сети IP. В `L2TP` не предусмотрены функции шифрования и аутентификации, поэтому при их необходимости он должен быть объединен с `IPSec`.

Процессы, которые `L2TP` использует для инкапсуляции, похожи на аналогичные процессы, используемые `PPTP`. Кадры `PPP` инкапсулируются в `L2TP`.

Когда система получателя получает кадр `L2TP`, она приступает к обработке заголовков.
Когда она доходит до окончания `IPSec`, она выполняет проверку целостности и аутентификацию кадра. Затем она использует информацию из заголовка `ESP` (Encapsulating Security Payload), чтобы расшифровать остальные заголовки и сами данные.

### 11.2. Протоколы аутентификации

**PAP** (Password Authentication Protocol - Протокол аутентификации пароля) используется удаленными пользователями для аутентификации через соединения PPP. Он обеспечивает идентификацию и аутентификацию пользователя, пытающегося с удаленной системы получить доступ к сети. Этот протокол требует, чтобы пользователь ввел пароль для аутентификации. Пароль и имя пользователя передаются по сети на сервер аутентификации через соединение, которое было установлено с помощью PPP. Сервер аутентификации имеет базу данных реквизитов доступа пользователей для сравнения с представленными пользователем учетными данными в процессе аутентификации.

**CHAP** (Challenge Handshake Authentication Protocol - Протокол аутентификации по методу "вызов-приветствие") учитывает некоторые уязвимости, присущие PAP. Для выполнения аутентификации пользователя он использует механизм запрос/ответ, вместо отправки пароля. Если пользователю нужно установить соединение PPP и обе стороны договорились об использовании для аутентификации протокола CHAP, компьютер пользователя посылает серверу аутентификации запрос на вход. В ответ сервер отправляет пользователю запрос, представляющий собой случайное значение. Этот запрос шифруется компьютером пользователя с использованием пароля пользователя в качестве ключа шифрования, зашифрованный ответ возвращается серверу. Сервер аутентификации использует хранящийся на своей стороне пароль этого пользователя в качестве ключа и расшифровывает значение ответа, сравнивая его с первоначально отправленным значением. Если два значения совпадают, сервер аутентификации делает вывод, что пользователь ввел правильный пароль, и аутентификация считается успешной

### 11.3. Рекомендации по удаленному доступу

Удаленные пользователи должны быть идентифицированы и аутентифицированы, а их деятельность должна контролироваться на предмет отсутствия опасных действий и нарушений прав доступа. Всем удаленным пользователям должны быть предоставлены только действительно необходимые им права доступа к сети, кроме того, их права доступа должны пересматриваться на ежегодной основе.

Допустимые действия и поведение, связанные с удаленным доступом, должны быть отражены в политике безопасности компании, либо в политиках, непосредствено относящихся к удаленному доступу. В политике следует указать, кто, что и когда должен делать. С этой политикой должны быть ознакомлены все пользователи, и она должна быть им постоянно доступна, что поможет устранить путаницу и позволит компании принимать меры к нарушителям требований политики.

Все системы удаленного доступа должны быть, по возможности, сгруппированы вместе: все серверы удаленного доступа желательно разместить в одной серверной комнате, они должны администрироваться одним лицом (группой лиц). Это поможет обеспечить согласованность деятельности по поддержке и мониторингу отдельных точек удаленного доступа, а также сохранять уверенность, что вносимые изменения отражаются одновременно на всех точках доступа. Кроме того, это облегчает проведение централизованного аудита и журналирования событий, снижается вероятность, что администраторы забудут про отдельную точку доступа, позволяющую пользователям получить доступ к внутренней среде компании.

Должна применяться строгая двухфакторная аутентификация пользователей с использованием серверов RADIUS или TACACS +, которые были описаны в Домене 02. Если передаваемые пользователями данные являются конфиденциальными или критичными для компании, пользователи должны подключаться к сети компании через VPN. Должны обеспечиваться различные уровни безопасности для различных типов подключающихся к сети пользователей, каждый пользователь должен обладать только теми правами доступа и разрешениями, которые ему необходимы.

Компании могут ограничивать доступ на основе адреса внешнего компьютера, который пытается получить доступ. Если адрес неизвестен или не внесен в ACL, запрос на подключение должен отклоняться. Должен быть внедрен межсетевой экран, позволяющий удаленным пользователям получить доступ только к разрешенным администратором сервисам и портам.

## 12. Беспроводные технологии

Беспроводные коммуникации используются гораздо чаще, чем мы думаем, в различных частотных диапазонах работает множество широкополосных беспроводных технологий передачи данных. Широкополосная беспроводная передача сигналов может использовать те же полосы частот, что и, например, микроволновые печи, спутники, радары и радиолюбительские передатчики. Мы используем беспроводные технологии для эфирного и спутникового телевидения, сотовых телефонов, шпионажа, наблюдения, а также для механизмов открывания гаражных дверей и многого другого.

### 12.1. Беспроводные коммуникации
Когда два человека разговаривают друг с другом, они используют беспроводные коммуникации, поскольку их голосовые связки изменяют звуковые волны, которые без проводов переносят сигналы другому человеку. Беспроводные коммуникации используют передачу сигналов с помощью радиоволн через воздух или безвоздушное пространство.

Сигнал характеризуется частотой (frequency) и амплитудой (amplitude). Частота сигнала определяет, какое количество данных может быть передано и насколько далеко. Чем выше частота, тем больше данных может переносить сигнал, однако с повышением частоты растет его подверженность атмосферным помехам. Т.е. более высокая частота может позволить передать больше данных (за единицу времени), но на более короткое расстояние.

В проводных сетях, каждый компьютер и устройство подключены к сети собственным
кабелем определенного типа. В беспроводных технологиях, каждое устройство должно
работать совместно с другими беспроводными устройствами в рамках общего отведенного радиочастотного спектра. Этот спектр частот ограничен, он не может расти по мере увеличения числа устройств, которым нужно его использовать. То же самое происходит в Ethernet – все компьютеры в сегменте используют общую среду, и только один компьютер может передавать данные в каждый момент времени, иначе возможны коллизии. Проводные сети Ethernet используют технологию CSMA/CD (выявление коллизий). Беспроводные технологии на самом деле очень похожи на Ethernet, но они используют CSMA/CA

Беспроводное устройство посылает широковещательное сообщение о том, что оно собирается передавать данные. Получение такого сообщения другими устройствами, подключенными к той же общей среде, заставляет их отложить свои потребности в передаче информации. Это делается для устранения (или уменьшения вероятности) коллизий

**Расширение спектра**

Для беспроводных технологий, как и для других технологий и отраслей, выделяются
конкретные спектры (spectrum), или диапазоны частот, которые используются ими для
передачи сигналов.

**Расширение спектра** (spread spectrum) означает, что кто-то некоторым способом распространяет отдельные сигналы через выделенные частоты. При использовании технологии расширения спектра отправитель передает свои данные на частотах, для работы на которых он имеет разрешение. Это позволяет более эффективно использовать имеющуюся полосу пропускания, поскольку передающие системы могут одновременно использовать более одной частоты. Это можно сравнить с последовательной и параллельной передачей данных. При последовательной передаче все биты помещаются в один канал и следуют один за другим. При параллельной передаче биты могут помещаться в несколько каналов и передаваться одновременно. Параллельная передача обеспечивает более высокую скорость, т.к. одновременно используются несколько каналов передачи данных.

**Метод расширения спектра с помощью псевдослучайного изменения рабочей частоты**(FHSS – Frequency Hopping Spread Spectrum). FHSS берет общий объем полосы пропускания (спектр) и разбивает его на более мелкие подканалы. Отправитель и получатель работают на одном из этих подканалов определенное время, а затем переходят на другой подканал. Отправитель отправляет первую часть данных на одной частоте, вторую – на другой частоте и т.д. Алгоритм FHSS определяет, какие конкретно частоты будут использоваться и в каком порядке. Это называется последовательностью изменений частоты отправителем и получателем.

>Большой проблемой при использовании беспроводных технологий являются помехи, поскольку они могут разрушить сигналы в процессе их передачи. Помехи могут быть вызваны другими устройствами, работающими на той же частоте.

Как работает FHSS? Отправитель и получатель перескакивают от одной частоты на другую, основываясь на заранее определенной последовательности. Несколько пар отправителей и получателей могут одновременно обмениваться данными через тот же набор частот, т.к. все они используют различные последовательности.

Предположим, что мы с вами используем последовательность изменений частоты `1`, `5`, `3`, `2`, `4`, а Николь и Эд – `4`, `2`, `5`, `1`, `3`. Я отправляю свое первое сообщение на частоте `1`, а Николь в то же время отправляет свое первое сообщение на частоте `4`. Следующую часть своих данных я передаю на частоте `5`, затем на частоте `3` и так до тех пор, пока все части данных не будут доставлены получателю, т.е. вашему беспроводному устройству. Ваше устройство сначала прослушивает полсекунды частоту `1`, затем частоту `5` и так далее до тех пор, пока оно не получит все части данных, которые передаются в это время на этих частотах. Устройство Эда прослушивает те же частоты, но в другое время и в другом порядке, поэтому его устройство игнорирует мои сообщения – он не синхронизирован заранее с моей последовательностью. Не зная правильного кода (последовательности), Эд считает мои сообщения фоновым шумом и не обрабатывает их.

**Метод расширения спектра с помощью прямой последовательности** (DSSS – Direct Sequence Spread Spectrum) использует иной подход, применяя суб-биты к сообщениям. Суб-биты используются отправляющей системой, чтобы сгенерировать различные форматы данных перед их передачей. Принимающая сторона использует эти суб-биты для того, чтобы пересобрать сигнал в исходный формат данных. Суб-биты называют чипами (chips), применяемая последовательность которых называется чиппинг-кодом (chipping code).

После того, как данные отправителя объединены с чипами, для всех, кто не знает чиппинг-код, эти сигналы будут выглядеть как случайный шум. Поэтому такие последовательности иногда называют шумоподобными последовательностями. После объединения данных отправителя с последовательностью чипов, полученная информация в новой форме модулируется с несущим радиосигналом, приводится к необходимой частоте и передается.

> При беспроводной передаче данных, информация передается с помощью радиосигналов, которые работают на определенных частотах. Любые данные, передаваемые в этом режиме, должны иметь несущий сигнал, который работает в своем собственном конкретном диапазоне, который и является частотой.

**FHSS** и **DSSS**. 

FHSS использует только часть от общей полосы пропускнания в каждый момент времени, тогда как технология DSSS постоянно использует всю доступную полосу пропускания. DSSS распространяет сигналы в более широком диапазоне частот, тогда как FHSS использует узкополосную передачу.

Поскольку DSSS отправляет данные на всех частотах одновременно, эта технология обладает более высокой пропускной способностью, чем FHSS. Первый стандарт WLAN (802.11) использовал FHSS, но после того, как возникли требования по повышению пропускной способности, была реализована технология DSSS. При использовании FHSS, стандарт 802.11 может обеспечить передачу данных со скоростью от 1 до 2 Мбит/с. Стандарт 802.11b, использующий DSSS, обеспечивает передачу данных со скоростью до 11 Мбит/с.

>Типы распространения спектра. Эта технология передает данные путем их «распространения» через широкий диапазон частот.
	• **FHSS** (Frequency hopping spread spectrum) передает данные, изменяя частоты.
	• **DSSS** (Direct sequence spread spectrum) использует иной подход, применяя к суб-биты к 	сообщениям и используя все доступные частоты одновременно.
	• **OFDM** (Orthogonal frequency-division multiplexing - Ортогональное частотное разделение 	каналов с мультиплексированием) является цифровой схемой модуляции с несколькими 	несущими, которая уплотняет несколько модулированных несущих, уменьшает требуемую полосу пропускания. Модулированные сигналы ортогональны (перпендикулярны) и не мешают друг другу. OFDM использует набор частот узких 	каналов для повышения ее производительности на высоких частотах.


### 12.2. Компоненты WLAN

**WLAN** (Wireless LAN – беспроводная локальная вычислительная сеть) использует **трансивер**, называемый **точкой доступа** (AP – Access Point), который подключается к проводной сети с помощью кабеля Ethernet. Точка доступа является связующим звеном, позволяющим беспроводным устройствам получить доступ к ресурсам проводной сети
Точки доступа находятся в фиксированных местах по всей сети и работают как коммуникационные маяки (beacon).

Предположим, у пользователя есть беспроводное устройство с беспроводной сетевой картой, модулирующей его данные в радиочастотные сигналы, которые принимаются и обрабатываются точкой доступа. Передаваемые точкой доступа сигналы принимаются беспроводной сетевой картой, и преобразуется в цифровой формат, который может понять устройство.

Если для соединения беспроводной и проводной сетей используются точки доступа, это называют инфраструктурой WLAN (infrastructure WLAN), которая используется для расширения существующей проводной сети. Если используется только одна точка доступа, которая не подключена к проводной сети, это называется работой в автономном режиме (standalone mode).

Для взаимодействия беспроводных устройств с точкой доступа, они должны быть настроены на работу по одному и тому же **каналу**. **Канал** (channel) – это определенная частота в рамках выделенного диапазона частот. Точка доступа настроена на работу по определенному каналу, а беспроводное устройство подстраивается на ту же частоту для возможности взаимодействия.

Любой узел, который хочет использовать WLAN, должен быть настроен на нужный **SSID** (Service Set ID). Различные узлы могут быть сегментированы по различным WLAN посредством использования различных `SSID`. Причины сегментирования WLAN аналогичны причинам сегментирования для проводных сетей: пользователям требуется доступ к различным ресурсам, они имеют различные бизнес-функции, либо имеют различные уровни доверия.

`SSID` обычно используется для аутентификации мобильного устройства на точке доступа. Чтобы устройство могло доказать, что ему разрешено взаимодействовать с проводной сетью, оно должно сначала предоставить действительное значение `SSID`. `SSID` не следует рассматривать в качестве надежного механизма обеспечения безопасности, поскольку многие точки доступа транслируют свои `SSID` в сеть, что позволяет легко перехватить и использовать их нападающими.

Беспроводное устройство может проверить подлинность точки доступа двумя основными способами: OSA (Open System Authentication - Открытая аутентификация) и SКА (Shared Key Authentication - Аутентификация посредством общего ключа).

Беспроводное устройство может проверить подлинность точки доступа двумя основными способами: **OSA** (Open System Authentication - Открытая аутентификация) и **SКА** (Shared Key Authentication - Аутентификация посредством общего ключа).

- **OSA** не требует, чтобы беспроводное устройство предоставляло точке доступа определенный криптографический ключ для аутентификации. Во многих случаях, мобильное устройство должно предоставить только правильное значение SSID. В реализациях OSA, вся передача ведется открытым текстом без применения шифрования.
- Если точка доступа настроена на использование **SKA**, она направляет случайное значение беспроводному устройству. Устройство шифрует это значение своим криптографическим ключом и возвращает результат. Точка доступа расшифровывает его и сравнивает с первоначальным значением, если значения совпадают – устройство аутентифицировано. При этом подходе, беспроводное устройство аутентифицируется в сети, доказав, что оно обладает необходимым ключом шифрования. Этот метод основан на протоколе **WEP** (Wired Equivalent Privacy), который помимо этого обеспечивает зашифрованную передачу данных.

**Специальный WLAN** (**Ad hoc WLAN**) не имеет точек доступа. В таком WLAN беспроводные устройства взаимодействуют только друг с другом через беспроводные сетевые карты, и не используют централизованные устройства. Для организации специальной сети WLAN, на взаимодействующие узлы устанавливается программное обеспечение беспроводного клиента, которое настроевается на одноранговый режим работы. Затем пользователь открывает «Сетевое окружение» (на компьютере с Windows), операционная система находит другие компьютеры, работающие в аналогичном режиме, и отображает их пользователю.

### 12.3. Беспроводные стандарты

Стандарты были разработаны для того, чтобы различные производители могли создавать различные продукты, которые могли бы без проблем работать совместно.

Первый стандарт `WLAN – 802.11`, был разработан в 1997 году, он обеспечивал скорость передачи данных 1-2-Мбит/с. Он работал в частотном диапазоне 2,4 ГГц. Этот диапазон не лицензирован FCC, т.е. компаниям и пользователям не нужно платить, чтобы работать в нем. Стандарт `802.11` описывает взаимодействие беспроводных клиентов и точек доступа, спецификации их интерфейсов, определяет порядок передачи сигналов, описывает, как должна быть реализована аутентификация, связь и безопасность.

В основной стандарт `802.11` в настоящее время входит большой список стандартов (`802.11a`, `802.11b`, `802.11i`, `802.11g`, `802.11h` и т.д.).

**802.11b**

Стандарт `802.11b` был первым расширением стандарта `WLAN 802.11`, в настоящее время он все еще является наиболее распространенным стандартом (хотя стандарт `802.11a` был разработан и утвержден раньше, он не был реализован первым из-за возникших технических сложностей). `802.11b` обеспечивает скорость передачи данных до 11 Мбит/с и работает в частотном диапазоне 2,4 ГГц. Он использует **DSSS** и обратно совместим с реализациями `802.11`.

**802.11a**

Стандарт `802.11a` стандарт использует другой метод модуляции данных на несущем радиосигнале. Тогда как `802.11b` использует **DSSS**, `802.11a` использует **OFDM** и работает в частотном диапазоне 5 ГГц. Из-за этих различий, 802.11a не имеет обратной совместимости с `802.11b` и `802.11`. Некоторые производители разработали продукты, которые могут работать с обоими реализациями (`802.11a` и `802.11b`). При этом такие устройства должны быть правильно настроены или иметь возможность автоматически настраиваться на используемую технологию.

**802.11e**

Стандарт `802.11e` обеспечивает реализацию `QoS` и надлежащую поддержку мультимедийного трафика. Мультимедиа и другие виды критичных ко времени приложений, более чувствительны к задержкам в процессе передачи данных. QoS позволяет приоритезировать трафик и обеспечивает гарантированную доставку. Эта спецификация и ее возможности позволяют передавать различные типы данных по беспроводным сетям.

**802.11f**

Когда пользователь перемещается в пределах WLAN, беспроводному устройству часто приходиться переключаться между различными точками доступа. Точка доступа покрывает небольшую площадь, и при перемещении пользователя из зоны одной точки доступа в зону другой точки доступа необходимо найти и поддержать сигнал, обеспечив непрерывное подключение к сети. Это называется роуминг. Чтобы роуминг работал плавно, без разрывов, точки доступа должны взаимодействовать друг с другом. Если вторая точка доступа должна принять на себя коммуникации пользователя, она должна быть уверена, что этот пользователь был надлежащим образом аутентифицирован. Кроме того, она должна знать необходимые настройки соединения этого пользователя. Это означает, что первая точка доступа должна иметь возможность передавть эту информацию второй точке доступа. Передача информации между различными точками доступа при роуминге – это именно то, чем занимается стандарт `802.11f`. В нем описывается, как эти данные могут использоваться совместно.

**802.11g**

Стандарт `802.11g` обеспечивает более высокую скорость передачи данных – до 54 Мбит/с. В основном это расширение, позволяющее увеличить скорость для существующих устройств `802.11b`. Скорость работы устройств, соответствующих спецификации `802.11b` составляет до 11 Мбит/с, а если устройство основано на 802.11g, оно остается обратно совместимым со старым оборудованием, но может при этом работать на более высокой скорости. Так что же лучше, `802.11g` или `802.11a`? Они оба предоставляют высокую пропускную способность. `802.11g` имеет обратную совместимость с `802.11b`, поэтому его лучше применять, если у вас уже есть существующая инфраструктура. Но `802.11g` по-прежнему работает в диапазоне 2,4 ГГц, в котором работает гораздо больше устройств. `802.11a` работает в диапазоне 5 ГГц, в котором работает значительно меньше устройств, он не так переполнен. Но работа на более высоких частотах приводит к уменьшению зоны покрытия беспроводного устройства. Вполне вероятно, что выбор того или иного стандарта предопределит рынок, на котором победит один из них. Только время покажет, какой из стандартов выживет в этой войне стандартов.

**802.11h**

Как было отмечено ранее, `802.11a` работает в диапазоне 5 ГГц, который может быть недоступен для передачи данных в странах, отличных от США. Стандарт 802.11h основан на спецификации 802.11a, при этом обеспечено соответствие требованиям европейских норм беспроводной связи, поэтому продукт, работающий в соответствии с этим стандартом, может использоваться в европейских странах.

**Стандарт безопасности беспроводных технологий**

Первый стандарт WLAN, IEEE 802.11, имеет огромное количество недостатков безопасности. Они содержатся как в основах самого стандарта, так и в различных его реализациях. Среди недостатков оригинального стандарта 802.11 можно отметить отсутствие аутентификации пользователей, отсутствие взаимной аутентификации между беспроводным устройством и точкой доступа, недостатки протокола шифрования. Протокол шифрования позволяет изменить определенные биты в передаваемом сообщении так, чтобы получатель не смог выявить эти изменения. Отдельные компоненты механизма шифрования (ключ и векторы инициализации) не обеспечивают достаточной случайности процесса шифрования, что позволяет легко взломать зашифрованные сообщения бесплатными инструментами, доступными на различных веб-сайтах.

Тремя основными недостатками WEP являются: **использование статических ключей** шифрования, **неэффективное использование векторов инициализации**, а также **отсутствие гарантий целостности пакета**. 

Протокол WEP использует алгоритм RC4, который представляет собой поточный симметричный шифр. Слово симметричный означает, что отправитель и получатель должны использовать **один и тот же ключ для шифрования и расшифрования**. Стандарт 802.11 не предусматривает автоматизированного процесса обновления этих ключей, поэтому в большинстве сред симметричные ключи RC4 никогда изменяются. Как правило, все беспроводные устройства и точка доступа используют один и тот же ключ. Это все равно, что использовать во всей компании один и тот же пароль. Не очень хорошая идея. Таким образом, первая проблема – статический ключ шифрования WEP на всех устройствах.

Следующим недостатком является **использование векторов инициализации** (IV – initialization vector). Вектор инициализации – это числовое значение, которое используется вместе с симметричным ключом и алгоритмом RC4 для обеспечения большей случайности в процессе шифрования. Случайность – это чрезвычайно важно в шифровании, т.к. если что-то может позволить злоумышленнику понять, как работает процесс, это может дать ему возможность взломать используемый ключ шифрования. Ключ и значение IV передаются в алгоритм RC4 для генерации ключевого потока. Значения (единицы и нули) ключевого потока накладываются с помощью операции XOR на двоичные значения содержимого отдельных пакетов. В результате получается шифротекст или зашифрованные пакеты.

Теперь можно перейти к третьему упомянутому выше недостатку – **проблеме обеспечения целостности**. Продукты WLAN, которые используют только стандарт 802.11, приводят к появлению уязвимостей, которые не всегда очевидны. Злоумышленник реально может изменить данные сетевых пакетов и одновременно с этим изменить Значение контроля целостности (ICV – Integrity Check Value), чтобы эти изменения не были замечены получателем. ICV работает аналогично функции CRC: отправитель рассчитывает ICV и вставляет его в заголовок кадра. Получатель вычисляет свое собственное значение ICV и сравнивает его с ICV в заголовке кадра. Если значения ICV совпадают, получатель считает, что в кадр не был изменен в процессе передачи. Если значения ICV отличаются, это говорит получателю о том, что произошли изменения, и получатель уничтожает этот кадр. В WEP существуют некоторые особенности, из-за которых получатель не может выявить изменения в кадре, поэтому в нем не существует реальных гарантий целостности.

![[Pasted image 20241111110545.png]]

**802.11n**

Целью 802.11n WWiSE (World Wide Spectrum Efficiency) является попытка заменить имеющийся набор различных технологий Wi-Fi. 802.11n разработан для обеспечения более высокой скорости (до 100 Мбит/с), он работает в частотном диапазоне 802.11a (5 ГГц). Он обеспечивает обратную совместимость с текущими стандартами Wi-Fi, объединяя срвременные технологии. Этот стандарт позволяет использовать концепцию MIMO (multiple input, multiple output), обеспечивающаю повышение пропускной способности. Для этого требуется использовать две приемных и две передающих антенны для параллельной широковещательной рассылки с использованием канала 20 МГц.

#### Bluetooth

Беспроводная технология `Bluetooth` на самом деле является частью стандарта `802.15`. Она позволяет передавать данные со скоростью 1-3 Мбит/с и работает в радиусе около 10 метров. `Bluetooth` работает в частотном диапазоне других 802.11-устройств (`2.4 ГГц`).

Однако при передаче незащищенных данных через `Bluetooth` возникают реальные риски безопасности, особенно в общественных местах, т.к. любое устройство в определенном радиусе может перехватить передаваемые таким способом данные.

Другая атака, которой подвержен `Bluetooth`, называется `Bluejacking`. При этой атаке некто отсылает незатребованное сообщение на устройство с включенным `Bluetooth`. Атакующий находит такое устройство (телефон, КПК, ноутбук) и отсылает ему сообщение. Чаще всего атакующий пытается отправить некий текст в формате визитной карточки, которая добавится в список контактов жертвы. Контрмерой против этой атаки является перевод `Bluetooth`-устройства в невидимый режим, чтобы другие не могли найти и идентифицировать устройство.

### 12.4. WAP

`WAP` (Wireless Application Protocol - Протокол приложений для беспроводной связи) сам по себе не является стандартом. Фактически `WAP` – это некий маркетинговый и промышленный стек протоколов. Этот стандарт используется в качестве "эскиза" всеми производителями, которые хотят разработать соответствующую технологию.

`WAP` предоставляет базовую архитектуру для беспроводных устройств, позволяющую им взаимодействовать через Интернет. Он позволяет беспроводным устройствам отправлять и принимать данные (в дополнение к голосовым данным), обеспечивает возможность подключения мобильных телефонов и КПК к контент-провайдерам в Интернете

`WAP` – это набор коммуникационных протоколов, используемых для стандартизации способов взаимодействия беспроводных устройств друг с другом и с сетью Интернет. Модель `WAP` содержит протоколы, выполняющие функции, аналогичные протоколам стека `TCP/IP`. `WAP` реализует способ представления веб-страниц. Персональные компьютеры и серверы используют `HTML` или `XML` для представления веб-материалов и `JavaScript` для выполнения фоновой обработки. Для выполнения аналогичных задач, `WAP` использует XML-совместимый язык `WML` (Wireless Markup Language - Язык беспроводной разметки) и `WMLScript`. `WAP` имеет собственные сеансовый и транспортный протоколы, а также протокол безопасности транспортного уровня `WTLS` (Wireless Transport Layer Security - Беспроводной протокол защиты транспортного уровня), похожий на `TLS` и `SSL`. На беспроводных устройствах установлен WAP-микробраузер, который отображает веб-страницы пользователю.

Поскольку эти устройства используют иной набор протоколов, необходим шлюз для трансляции данных между WAP- и интернет-протоколами, а также различными типами приложений

![[Pasted image 20241111111607.png]]

Данные, поступающие с беспроводного мобильного устройства, могут быть зашифрованы с помощью `WTLS`. Эти данные должны быть транслированы шлюзом в `TLS` или `SSL`. Поскольку беспроводные устройства используют для передачи данных Интернет, а Интернет не понимает WTLS, протокол WTLS должен быть транслирован в такой протокол, который может применяться в сети Интернет. Эта трансляция выполняется на шлюзе провайдера услуг.

При этом возникает проблема безопасности, поскольку эти данные должны быть расшифрованы на оборудовании провайдера и повторно зашифрованы с помощью SSL или TLS. Это означает, что данные какое-то время (1-2 секунды) не защищены. Это называют «окном» в WAP (gap int the WAP), оно является одной из проблем, которую специалисты по безопасности должны учитывать.

### 12.6. Безопасность мобильных телефонов

Технологии, используемые в смартфонах, также имеют проблемы безопасности. Политики безопасности большинства компаний запрещают использование устройств таких видов. Все было прекрасно, пока телефоны были просто телефонами, но сегодня это маленькие компьютеры, которые могут подключаться к другим компьютерам и сетям, поэтому они являются новой точкой входа для злоумышленников. Поскольку мобильные устройства являются компьютерами со своими операционными системами, многие сотрудники хранят на них критичные данные (например, пароли, контакты, файлы компании и т.п.). Причем обычно эта информация хранится в открытом виде. Большинство смартфонов имеют встроенные камеры, и компании должны понимать, что это новый способ, с помощью которого критичные данные и действия могут быть «скопированы» и переданы во внешний мир. Каждая компания должна учесть эти новые технологии и источники угроз в своей политике и программе безопасности.

Сотовые телефоны клонируют на протяжении уже многих лет и эту деятельность нельзя искоренить за короткое время. Обычный сотовый телефон может быть украден и затем перепрограммирован злоумышленником, либо использован для получения чужих учетных данных. Это часто делают криминальные организации и те, кто не хочет, чтобы их информацию читали государственные службы. Телефоны `GSM` (*Global System Mobile*) используют чиповую `SIM-карту` (*Subscriber Identity Module* - Модуль идентификации абонента), на которой хранятся даные аутентификации, номер телефона, сохраненные сообщения и т.п. Прежде чем GSM-телефон сможет получить доступ к сотовой сети, в телефон должна быть установлена SIM-карта. Злоумышленник может клонировать SIM- карту, что позволит ему делать звонки со своего сотового телефона за счет владельца SIM-карты.

Нужно понимать, что сотовые телефоны передают данные по радиоволнам и затем эти данные попадают в проводную сеть телефоной компании или провайдера услуг. Таким образом, часть расстояния трафик передается без проводов, а оставшаяся часть расстояния может быть проводной. Поэтому, если кто-то шифрует свои данные и отправляет их на свой сотовый телефон, обычно эти данные остаются зашифрованными только на этапе передачи по беспроводной части сети. Как только данные попадают в проводную часть сети, они расшифровываются и дальше передаются в открытом виде. Таким образом, при передаче зашифрованных данных на смартфон, они не обязательно остаются зашифрованными на всем протяжении своего пути.

Ниже перечислены некоторые из проблем, с которыми сталкиваются компании при использовании сотовых телефонов:
- Могут быть созданы фальшивые базовые станции
- Могут быть похищены конфиденциальные данные
- Используется функционал камеры
- Доступ в сеть Интернет в обход межсетевых экранов компании
- SMS-спам
- Может быть загружен вредоносный код
- Шифрование может быть слабым, при этом оно может не обеспечиваться на всей протяженности маршрута передачи данных

### 12.7. Вардрайвинг

Очень распространенной атакой на беспроводную сеть является вардрайвинг (war driving), при которой один или несколько человек ходят вогруг или ездят на машине с включенным беспроводным оборудованием и специальным программным обеспечением, которое позволяет выявить точки доступа и взломать их. Обычно это делается с помощью ноутбука и перемещения на машине вокруг здания, в котором установлено оборудование WLAN, однако сегодня даже КПК может применяться для атак этого типа.

Для перехвата информации (мониторинга) точек доступа могут использоваться, например, такие программы, как `Kismet` и `NetStumbler`. Когда такая программа находит сигнал точки доступа, она заносит в журнал название сети, `SSID`, МАС-адрес точки доступа, наименование ее производителя, прослушиваемый канал, силу сигнала, соотношение сигнал/шум, факт использования `WEP`. Атакующий перемещается вокруг на своей машине с ноутбуком, на котором запущена программа `NetStumbler`, производящая активный поиск точек доступа. Обычно, она может обнаружить точки доступа в радиусе до 100 метров, но с более мощной антенной атакующий может находить точки доступа и гораздо дальше. `NetStumbler` рассылает тестовые запросы каждую секунду, ожидая ответа точки доступа. Если на точке доступа используется `WEP`, для взлома и перехвата ключей могут использоваться такие программы, как `Airsnarf`, `AirSnort` или `WEP-Crack`.

Ниже приведены некоторые лучшие практики, относящиеся к внедрению `WLAN`:
- Включайте `WPA` или `WPA2`, реализованные в стандарте `802.11i`.
- Изменяйте установленный по умолчанию `SSID`. Каждая точка доступа имеет настроенный по умолчанию `SSID`.
- Блокируйте широковещательную рассылку `SSID` на точке доступа. Большинство точек доступа позволяет отключить это.
- Используйте дополнительный уровень аутентификации ( RADIUS, Kerberos). Прежде чем получить доступ в сеть, пользователь должен пройти аутентификацию.
- Физически размещайте точку доступа в центре здания. Точка доступа имеет определенную зону покрытия. Лучше, чтобы сигнал точки доступа не выходил далеко за пределы здания.
- Логически размещайте точку доступа в `DMZ`, устанавливайте межсетевой экран между этой `DMZ` и внутренней сетью. Включите на межсетевом экране функции проверки трафика перед его допуском в проводную сеть.
- Внедрите `VPN` для использования беспроводными устройствами. Это добавит еще один уровень защиты данных в процессе их передачи.
- Настройте точку доступа для допуска в сеть только известных МАС-адресов. Разрешите выполнение аутентификации только для известных устройств. Но не забывайте, что МАС-адреса передаются открытым текстом, позволяя атакующим перехватить их и использовать для несанкционированного доступа в сеть.
- Присваивайте статические IP-адреса беспроводным устройствам, отключайте `DHCP`. Если атакующий получит доступ к сети, в которой включен `DHCP`, он легко - получит правильный рабочий адрес для работы в ней.
- Проводите тесты на проникновение в `WLAN`. Используйте описанные в этом разделе инструменты для выявления точек доступа и пытайтесь взломать применяющиеся в них схемы шифрования.
- Переходите на продукты, соответствующие стандарту `802.11i`.

### 12.8. Спутники

В настоящее время спутники используются для организации беспроводной связи между различными местами. Чтобы между двумя местами могла быть установлена связь через спутник, эти места должны находиться в зоне прямой видимости и в зоне обслуживания (footprint) спутника. Отправитель информации (наземная станция) модулирует данные в радиосигнал, который передает на спутник. Транспондер на спутнике принимает сигнал, усиливает его и пересылает получателю. Получатель должен иметь антенну, похожую на круглую тарелку, такие антенны часто можно увидеть на крышах высоких зданий. На такой антенне установлен один или несколько микроволновых приемников, в зависимости от количества спутников, с которых планируется принимать сигнал.

Спутники обеспечивают широкополосную связь, обычно используемую для телевидения и доступа компьютеров в Интернет. Для телевидения настраивается однонаправленная передача. Если требуется доступ в Интернет, необходима двухсторонняя сеть. Доступная ширина полосы пропускания зависит от антенны, типа терминала и сервисов, предоставленных провайдером услуг. Приложения, чувствительные ко времени передачи данных, при использовании спутниковой связи могут страдать от задержек, вызванных временем передачи данных до спутника и обратно. Используемые для таких целей спутники размещают на низкой орбите, что обеспечивает минимизацию расстояния от наземной станции до спутника. Кроме того, это позволяет использовать приемник меньшего размера, делая спутники на низкой орбите идеальным средством для двухстороннего пейджинга, международной сотовой связи, телевещания, предоставления доступа в Интернет.

Размер зоны обслуживания зависит от типа спутника. Она может быть большой, как страна, или охватывать только несколько сотен метров в диаметре. Зона обслуживания покрывает определенную область на земле лишь несколько часов или даже меньше, поэтому провайдер услуг обычно имеет большое количество спутников, распределеных таким образом, чтобы они постоянно покрывали нужную область.

В большинстве случаев для спутникового доступа в Интернет применяется гибридная система, в которой для отправки запросов с компьютера пользователя используется обычная телефонная линия и модем, а спутниковая связь используется только для приема отправленных пользователю данных

![[Pasted image 20241111122446.png]]

### 12.9. Беспроводные коммуникации 3G

Третьим поколением мобильных технологий являются технологии, которые часто называют **широкополосными беспроводными технологиями**. 

Первое поколение использовало аналоговую передачу только голосовых данных через сети с коммутацией каналов. 

Второе поколение позволяло передавать голос и данные в цифровом виде между беспроводным устройством, таким как сотовый телефон, и контент-провайдером. Второе поколение обеспечивало скорость передачи данных около `19,2 кбит/с`. `TDMA` (Time Division Multiple Access - Множественный доступ с разделением по времени), `CDMA` (Code Division Multiple Access - Множественный доступ с кодовым разделением), `GSM` (Global System for Mobile Communications) и `PCS` (Personal Communications Services) – все они являются мобильными технологиями `2G`. Это поколение технологий может передавать данные через сети с коммутацией каналов, поддерживает шифрование данных, передачу факсов и коротких сообщений (SMS).

`3G` – это большой шаг вперед, который обеспечил высокоскоростной мобильный доступ в Интернет на базе сервисов IP. Современные сотовые телефоны могут отображать веб-страницы, выполнять функции клиента электронной почты, проигрывать музыку и видео, позволяют играть в игры. Они имеют операционную систему, приложения, ну и, конечно, телефон. Технологии 3G обеспечивают скорость передачи данных до 384 кбит/с при движении и до 2 Мбит/с в стационарном режиме.

![[Pasted image 20241111122802.png]]


## 13. Руткиты

Часто после успешного взлома компьютера пользователя, хакер пытается повысить свои привилегии для получения прав уровня администратора или «суперпользователя» (root). Работа в контексте безопасности таких привилегированных пользователей позволяет злоумышленнику выполнять максимально опасные действия. После получения такого уровня доступа, злоумышленник может загрузить на взломанный компьютер комплект инструментальных средств, называемых **руткитом** (rootkit). Первая вещь, которую обычно устанавливает злоумышленник – это **бэкдор-программа**, которая позволяет злоумышленнику войти во взломанную систему в любое время без какой-либо аутентификации (**бэкдор** – это просто сервис, который прослушивает определенный порт). Другие инструменты, входящие в руткит, могут быть различными. Как правило, в состав руткита входят утилиты, позволяющие скрыть деятельность атакующего. Например, каждая операционная система имеет стандартные утилиты, с помощью которых администратор (или root) может выявить присутствие **руткита**, **снифера** и **бэкдора**. Хакер заменяет эти стандартные утилиты их «новыми версиями», которые имеют те же названия. Они называются «**троянскими программами**», поскольку помимо своей основной функциональности, они выполняют какую-либо дополнительную вредоносную деятельность в фоновом режиме. Например, в Unix-системе утилита `ps` (состояние процесса) выводит список всех процессов, запущенных в системе, и их состояние. Утилита `top` показывает список процессов, их состояние, а также объем памяти, используемый каждым процессом. Большинство руткитов имеют троянские программы, которые заменяют эти утилиты, иначе `root` может запустить `ps` или `top` и увидеть, что работает **бэкдор**, и выявить факт атаки. Но когда `root` запускает троянскую версию этой утилиты, она перечисляет все процессы, за исключением процесса бэкдора. Большинство руткитов имеют снифферы, позволяющие перехватывать данные, которые затем может просмотреть злоумышленник. Для работы сниффера сетевая карта должна быть переведена в режим прослушивания (promiscuous mode), что позволяет ей «слышать» весь проходящий через сетевоей кабель трафик. Стандартная утилита `ipconfig` с помощью специального параметра позволяет пользователю root проверить, работает ли сетевая карта в режиме прослушивания. Поэтому руткит содержит троянскую версию утилиты `ipconfig`, которая скрывает факт работы сетевой карты в режиме прослушивания.

Также, руткиты обычно содержат «очистители логов» (log scrubber), которые удаляют следы деятельности злоумышленника из системных журналов регистрации событий. Кроме того, руткиты могут содержать троянские версии Unix-утилит find и ls, позволяющие скрыть наличие относящихся к руткиту файлов, когда пользователь делает листинг содержимого определенной директории.

Некоторые наиболее мощные руткиты вносят изменения в ядро системы, а не просто заменяют отдельные утилиты. Ядро – это мозг операционной системы, поэтому изменение его кода дает злоумышленнику гораздо больший контроль над системой. Кроме того, изменения ядра очень трудно обнаружить, это гораздо сложнее выявления замены утилит. Дело в том, что большинство систем IDS уровня узла контролируют изменения в размерах и датах создания файлов, относящихся к утилитам и программам, но не к ядру операционной системы (за некоторыми исключениями).

Контрмерами против руткитов являются надлежащее укрепление системы, своевременная установка обновлений безопасности, установка антивирусных и антишпионских программ, поддержка их актуальности. Другим механизмом защиты является использование IDS уровня узла, которые могут выявить подозрительную активность и контролируют целостность системы.

### 13.1. Шпионское и рекламное программное обеспечение

Определение терминов «**шпионская программа**» (**spyware**) и «**рекламная программа**» (**adware**) отличается в зависимости от того, у кого вы о нем спрашиваете. Обычно считается, что это программное обеспечение, установленное на компьютере пользователя без его ведома. Такое программное обеспечение, как правило, выполняет сбор определенных данных, например, таких, которые могут быть использованы продавцами для повышения продаж продуктов пользователю, либо данных, которыми могут воспользоваться злоумышленники. Термин «рекламное программное обеспечение» относится, как правило, к программам, которые различные компании используют для отслеживания покупок пользователей, их привычек использования интернет-ресурсов. Обычно они основаны на анализе куки-файлов. Они позволяют продавцу узнать, как эффективно продавать этому пользователю свою продукцию.












