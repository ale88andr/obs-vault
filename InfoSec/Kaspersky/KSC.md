
### Компоненты KSC

- Сервер администрирования
- Агент администрирования
- Консоль администрирования на базе ММС
- Web Console

### Пути установки KSC

- `%ProgramFiles(x86)%\Kaspersky Lab\Kaspersky Security Center` —
программные файлы
- `%ProgramFiles%\Kaspersky Lab\Kaspersky Security Center Web Console 13`
— программные файлы
- `%ProgramDafa%\KasperskyLab\adminkit` — настройки
- `%ProgramDafa%\KasperskySC\SC_Backup` — папка для резервных копий
- KLSHARE — локальный путь `%ProgramDafa%lKasperskyLab\adminkit\1093\.working\Share`

### Службы KSC

- Сервер администрирования Kaspersky Security Center
- Агент администрирования Kaspersky Security Center
- Объект автоматизации Kaspersky Security Center
- Прокси-сервер Kaspersky Security Network
- Веб-сервер «Лаборатории Касперского»
- Прокси-сервер активации «Лаборатории Касперского»
- Kaspersky Security Center 13 Management Service
- Kaspersky Security Center 13 Web Console
- Kaspersky Security Center 13 Web Console Message Queue

##### В результате стандартной установки:

**Группы**:	
- `KLAdmns`
- `KLOparators`

**Учетные записи**:	
- `KL-AK-* ` — запускает службу Сервер администрирования Kaspersky Security Center
- `KIScSvc` — запускает службы Прокси-сервер активации «Лаборатории Касперского», Прокси-сервер Kaspersky Security Network и Веб-сервер «Лаборатории Касперского».

> Записи `KL-AK-<*>` и `KIScSvc` имеют права, эквивалентные правам локального администратора, хотя и не входят во встроенную группу администраторов `KIPxeUser`— служебный пользователь для РХЕ-сервера

**Порты**:
- `8060` — http-порт Веб-сервера «Лаборатории Касперского»
- `8061` — https-порт Веб-сервера «Лаборатории Касперского»
- `13000` — для SSL-подключений Агентов
- `14000` — для обычных подключений Агентов и Консолей администрирования
- `13291` — для SSL-подключений Консолей администрирования
- `13111` — порт службы Kaspersky Security Network proxy server
- `17000` — порт прокси-сервера активации
- `13299` — для SSL-подключений Kaspersky Security Center Web Console

**SQL-сервер**:
Имя базы — KAV

### Web Console

Web Console представляет собой веб-сервер на платформе `Node.js`. Серверная часть Web Console подключается к Kaspersky Security Center по новому протоколу `KSC Open API` на базе HTTPs.

### Ключи и коды активации

Чтобы активировать продукт, нужен ключ или код. Оба могут олицетворять лицензию покупателя со всеми ее ограничениями.

**Ключ** — это специальный файл с параметрами лицензии, подлинность которого продукт может установить локально. **Код** — это просто строка и для выяснения ее подлинности и параметров соответствующей лицензии продукт должен подключиться к Серверам активации Лаборатории Касперского в Интернет.

### Задачи Сервера администрирования

| Задача                                                 | Расписание                 | Параметры                                            |
| ------------------------------------------------------ | -------------------------- | ---------------------------------------------------- |
| Загрузка обновлений в хранилище                        | Каждый час                 | Источник: Сервера обновлений Лаборатории Касперского |
| Обслуживание базы данных                               | Каждую субботу в 1.00 ночи | Оптимизирует, но не сжимает базу                     |
| Резервное копирование данных Сервера администрирования | Раз в два дня в 2:00 утра  | Хранит 3 последние копии, пароль не задан            |

### Задачи для управляемых устройств

| Задача               | Расписание                          | Параметры                                                                                |
| -------------------- | ----------------------------------- | ---------------------------------------------------------------------------------------- |
| Установка обновлений | При загрузке обновлений в хранилище | Источник: Сервер администрирования<br>Устанавливает только одобренные обновления модулей |

> Обратите внимание, что групповая задача **Быстрый поиск вирусов** больше не создается по умолчанию. Вместо нее включается **Фоновая проверка**, которая сканирует системные области во время простоя компьютера. Опция находится в политике на вкладке `Параметры программы -> Локальные задачи`.
> 
> Если администратор хочет полноценно управлять проверкой по требованию, ему нужно будет самому создать **групповую задачу проверки** с необходимыми настройками.

### Сканирование сети

Cканирование сети средствами Windows. Этот тип сканирования работает через сетевое окружение в проводнике Windows, которое по умолчанию выключено в операционной системе. Этот шаг можно пропустить; сканирование будет выполняться в фоновом режиме.

### Инсталляционные пакеты

###### Как обновить базы в пакете

В общих свойствах пакета Kaspersky Endpoint Security есть еще кнопка **Обновить базы**. Она обновляет базу сигнатур внутри пакета.

![[Pasted image 20260212164045.png]]

Чтобы Kaspersky Endpoint Security мог работать сразу после установки, в состав инсталляционных файлов входят базы. Со временем они устаревают. Это не является большой проблемой, поскольку сразу после установки Kaspersky Endpoint Security запустится задача обновления и загрузит новые базы.

###### Как выбрать компоненты в пакете

![[Pasted image 20260212165055.png]]

### Kaspersky Security для Windows Server

У Лаборатории Касперского есть несколько приложений класса ЕРР для защиты физических конечных узлов:
- **Kaspersky Endpoint Security для Windows** - Спроектирован для защиты рабочих станций и серверов Windows. Является флагманским и самым передовым приложением от Лаборатории Касперского так как сочетает в себе продвинутые технологии для обнаружения вредоносного программного обеспечения, например, Поведенческий анализ и Адаптивный контроль аномалий. Позволяет использовать полнодисковое или файловое шифрование для соблюдения конфиденциальности данных на защищаемом устройстве. 
- **Kaspersky Security для Windows Server** - Создан для защиты серверов Windows и систем хранения данных. При работе на отказоустойчивом кластере умеет корректно воспринимать смену активного узла и применять те же параметры проверки к общим кластерным ресурсам, которые перемещаются при смене узла. Умеет корректно распознавать режим терминальной сессии или сеанс удалённого рабочего стола, и при обнаружении угрозы уведомлять только конкретного пользователя, который работает в сессии. Защищает системы хранения данных, речь идет о NAS-хранилищах, которые в основном используют собственную операционную систему и подключаются к серверу по специфическим протоколам. Т.е. проверка стандартными средствами в этом случае работать не будет.
- **Kaspersky Embedded Systems Security** - Приложение создано на основе кодовой базы Kaspersky Security для Windows Server и во многом функции и возможности продуктов пересекаются. Основным отличием от вышеперечисленных программ KESS является установка на Embedded устройства (банкоматы, терминалы, киоски). KESS был спроектирован таким образом, чтобы наименьшим образом влиять на работу устройств с весьма ограниченным количеством вычислительных системных ресурсов.

В свойствах инсталляционного пакета администратор может выбрать компоненты защиты, которые будут установлены в составе **Kaspersky Security для Windows Server**.

Вы всегда можете отредактировать инсталляционный пакет и добавить или удалить компоненты, которые вы не планируете устанавливать. При установке средствами Kaspersky Security Center есть только два компонента обязательных к установке: **Интеграция с Kaspersky Security Center** и **Проверка по требованию**. По умолчанию компоненты: **Проверка скриптов** и **Управление Сетевым Экраном** не устанавливаются.

> На самом деле очень сложно представить ситуацию, где пришлось бы тщательно выбирать компоненты для установки. Рекомендуется использовать полный набор компонентов для установки, а будут ли они задействованы, чтобы обеспечивать защиту или нет, можно регулировать с помощью настроек политики.

### Удаленная установка

1. **С помощью Агента администрирования** - Сервер посылает команду Агенту, Агент загружает файлы пакетов во временную папку и выполняет установку от имени локальной системы. Имя и пароль администратора указывать не нужно, доступ к общим папкам на компьютере не нужен.
2. **Средствами операционной системы** - Нужен доступ к общим папкам компьютера по сети. Сервер администрирования копирует файлы пакетов в системную общую папку `\\<имя компьютера>\admin$` Затем сервер использует протокол `Remote Procedure Call (RPC)`, чтобы удаленно запустить служебный процесс, который выполнит установку и сообщит результат на Сервер. Чтобы скопировать файлы и запустить установку, нужно указать имя и пароль администратора компьютера.

### Куда поместить компьютеры после установки

Установка Агента и средств защиты предполагает, что компьютеры после установки должны быть управляемыми: использовать настройки политик и задач с Сервера администрирования. Для этого компьютеры должны быть в списке **Управляемые устройства**, а не в списке **Нераспределенные устройства**

> Если на компьютере есть Агент администрирования, но компьютер не входит в группу администрирования, такой компьютер не пересылает свои события на Сервер администрирования, не отображается в отчетах и не использует заданные администратором централизованные настройки. Он является управляемым только номинально, но не фактически.

### Учетная запись администратора

Первоначальная установка Агента выполняется средствами Windows и нуждается в учетной записи для доступа к компьютерам. Мастер установки позволяет задать несколько учетных записей, на случай если пароли администратора на компьютерах не совпадают. Попытки доступа от имени разных учетных записей выполняются в порядке перечисления. Если одна учетная запись не подходит, используется следующая и так до конца списка.

> Перед использованием явно заданных учетных записей всегда выполняется попытка установки от имени учетной записи Сервера администрирования. Можно считать, что она незримо присутствует в самом начале списка. В результате установки с настройками по умолчанию служба Сервера запускается от имени учетной записи` KL-AK-*`, которая создается автоматически и наделяется правами локального администратора (не буквально, но эквивалентными). На удаленных компьютерах она прав не имеет.

Таким образом, в большинстве случаев учетную запись для доступа к компьютерам задавать нужно. В доменной среде для использования при удаленной установке удобно использовать учетную запись администратора домена.

### Как сервер администрирования ищет компьютеры

В ходе работы мастера удаленной установки или при создании задачи установки администратор имеет возможность выбирать компьютеры из некоторого списка. Этот список формируется Сервером администрирования путем опроса сети. Опрос осуществляется периодически несколькими разными способами:
- Опросом сети Microsoft
- Опросом Active Directory
- Опросом IP-подсетей

> Сеть опрашивает не служба Сервера администрирования, а **служба Агента администрирования**, установленная на сервере администрирования. **Агенты администрирования на обычных компьютерах сеть не опрашивают**.

**Что делает быстрый опрос**

Сервер администрирования собирает списки компьютеров сети Windows точно так же, как это делает сама операционная система. Когда пользователь открывает на компьютере сетевое окружение, он видит список соседних компьютеров, сгруппированных в домены и рабочие группы. Точно такой же список может получать и Сервер администрирования. Этот способ опроса называется **быстрым опросом сети Windows**. В ходе такого сканирования Сервер практически не создает нагрузки на сеть. За составление и предоставление списка компьютеров отвечает служба `Computer Browser`. В каждом сегменте сети есть главный компьютер, хранящий общий список и предоставляющий его по запросу. Чтобы получить список, Серверу администрирования достаточно послать один запрос.

**Что делает полный опрос**

При полном опросе Сервер администрирования пытает получить как можно больше информации о каждом компьютере из результатов быстрого опроса. 

> Для каждого имени, Сервер выполняет разрешение имени в IP-адрес, используя протоколы `NetBIOS`, `DNS` и `LLMNR`. Для полученных адресов сервер выполняет обратное разрешение в имя, и, если имя не совпадает с исходным, получает IP-адрес для нового имени. Сервер проверяет, доступны ли IP-адреса, с помощью ICMP-запросов, и в конце пытается соединиться с компьютерами по протоколам `SMB` и `RPC`, чтобы выяснить операционную систему.

Все эти многочисленные запросы нужны, чтобы учесть, что имена и адреса компьютеров могут меняться. С помощью прямых и обратных проверок имен и IP-адресов Сервер администрирования отличает новые компьютеры в сети от старых компьютеров, которые просто поменяли имя или IP-адрес. Поскольку количество запросов пропорционально количеству компьютеров, сетевая активность при полном опросе заметно выше, чем при быстром. Как следствие период такого опроса по умолчанию составляет 60 минут.

###### Опрос Active Directory

Сервер администрирования запрашивает в Active Directory структуру контейнеров (подразделений) и списки компьютеров в каждом из них, список пользователей и групп.

Явно заданного времени жизни у полученных данных нет. Каждый следующий опрос заменяет результаты предыдущего:
- добавляет недостающие подразделения и компьютеры
- удаляет компьютеры и подразделения, которых больше нет в Active Directory

В дополнительных параметрах опроса администратор может выбрать область сканирования:
- Домен, куда входит Сервер администрирования (выбрано по умолчанию)
- Весь лес доменов, куда входит Сервер администрирования
- Явно заданный список доменов

Чтобы добавить домен для опроса, нужно указать адрес контроллера домена, а также имя и пароль учетной записи для доступа к нему.

Опрос отдельных подразделений можно отключить в свойствах этих подразделений.

###### Опрос Iр-подсетей

Опрос IP-диапазонов работает почти так же; как полный опрос сети Windows. Но исходный список компьютеров — это не результаты быстрого опроса, а список IP-адресов из заданных администратором IP-диапазонов.

> Каждый адрес сервер пытается разрешить в имя, имя опять в адрес, проверяет, отвечает ли адрес на запросы `ICMP ECHO REQUEST` и т.д. Чтобы выяснить тип устройства, Сервер также отправляет `SNMP`-запросы.

Исходно IP-диапазоны для опроса Сервер администрирования берет из сетевых настроек компьютера, на котором установлен. Если адрес компьютера `192.168.0.1` и маска подсети `255.255.255.0`, Сервер администрирования автоматически включит сеть `192.168.0.0/24` в список сканируемых и проведет опрос всех адресов от `192.168.0.1` до `192.168.0.254`.

**Как добавить сеть для опроса**

Чтобы опрашивать подсети, в которые Сервер администрирования не входит, их нужно добавить в список вручную. Задать подсеть можно либо ее адресом и маской, либо начальным и конечным IP-адресом, как IP-диапазон. Кроме этого, нужно указать имя создаваемой подсети.





