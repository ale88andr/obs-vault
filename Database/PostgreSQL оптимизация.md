
В приложении узким местом оптимизации является база данных

Что делать, если приложение "тупит":

1-й вариант:
1. установить СУБД на отдельный сервер (убираем конкуренцию за CPU application server и СУБД)
2. оптимизировать запросы и настройки СУБД

2-й вариант:
1. стараться сразу писать оптимальные запросы

На что влияют запросы:
- это больший RPS — requests per second больше клиентов обслуживается на одном и том же железе
- быстрые SQL-запросы дают возможность быстрее отвечать на НТТР-запросы клиентов
- быстрые НТТР-запросы — быстрые веб-страницы 
- быстрые веб-страницы — довольные клиенты 
- довольные клиенты — больше денег

> SQL-запросы имеют тенденцию сначала работать быстро, а с ростом данных и нагрузки всё медленнее, пока веб-сервисы совсем не начинают отваливаться

Можно использовать индексы БД, но... не обязательно они помогут:
- индекс не всегда будет использоваться и это нормально
- индекс надо поддерживать, то есть перестраивать при изменении данных — индекс это не бесплатно по вычислительным ресурсам и по месту на диске

### Как PostgreSQL хранит данные?
- в файлах
- файлы разбиты на блоки по `8` килобайт, блоки называют **страницами** (pages)
- **страница** — минимальный объём, который `PostgreSQL` может считать с диска и записать на диск
- считать 1 строку нельзя, можно считать только одну страницу, на которой есть эта строка
- после считывания страницы с диска она помещается в **буферный кеш** (в оперативную память) и хранится там, пока другие данные (другие считанные страницы) её не вытеснят

Как ускорить?

- использовать связь один к одному вместо создания широких таблиц - часто нужные данные, которые используются вместе, храним в одной таблице, а остальной массив данных храним отдельно в другой или других таблицах тогда при считывании основных данных с диска не будут читаться нужные редко данные (они лежат в другой таблице в других файлах в других страницах)

### `select * from table`  - не для нас

Зачем тащить из СУБД то, что нам не нужно? 
- читать с файла 
- обрабатывать в СУБД 
- передавать по сети от СУБД к приложению
- обрабатывать в приложении

