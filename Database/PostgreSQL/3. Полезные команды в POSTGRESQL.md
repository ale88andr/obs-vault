
### Получение информации о базе данных

#### 1. Размер базы данных

Чтобы получить физический размер файлов (хранилища) базы данных, используем следующий запрос:

```sql
SELECT pg_database_size(current_database());
```

`current_database()` — функция, которая возвращает имя текущей базы данных.

Вместо функции можно ввести имя текстом.

```sql
SELECT pg_database_size('postgres');
```

Для того, чтобы получить информацию в человекочитаемом виде, можно использовать функцию `pg_size_pretty`:

```sql
SELECT pg_size_pretty(pg_database_size(current_database()));
```

#### 2. Перечень таблиц

Иногда требуется получить перечень таблиц базы данных. Для этого используем следующий запрос:

```sql
SELECT table_name FROM information_schema.tables WHERE table_schema NOT IN ('information_schema','pg_catalog');
```

`information_schema` — стандартная схема базы данных, которая содержит коллекции представлений (`views`), таких как таблицы, поля и т.д. Представления таблиц содержат информацию обо всех таблицах баз данных.

#### 3. Размер таблицы

По аналогии с получением размера базы данных размер данных таблицы можно вычислить с помощью соответствующей функции:

```sql
SELECT pg_relation_size('accounts');
```

Функция `pg_relation_size` возвращает объём, который занимает на диске указанный слой заданной таблицы или индекса.

Для того, чтобы получить информацию в человекочитаемом виде, можно использовать функцию `pg_size_pretty`:

```sql
SELECT pg_size_pretty(pg_relation_size('accounts'));
```

#### 4. Имя самой большой таблицы

Для того, чтобы вывести список таблиц текущей базы данных, отсортированный по размеру таблицы, выполним следующий запрос:

```sql
SELECT relname, relpages FROM pg_class ORDER BY relpages DESC;
```

`relname` — имя таблицы, индекса, представления и т.п.
`relpages` — размер представления этой таблицы на диске в количествах страниц (по умолчанию одна страницы равна 8 Кб).
`pg_class` — системная таблица, которая содержит информацию о связях таблиц базы данных.

#### 5. Перечень подключенных пользователей

Чтобы узнать имя, IP и используемый порт подключенных пользователей, выполним следующий запрос:

```sql
SELECT datname,usename,client_addr,client_port FROM pg_stat_activity;
```

#### 6. Активность пользователя

Чтобы узнать активность соединения конкретного пользователя, используем следующий запрос:

```sql
SELECT datname FROM pg_stat_activity WHERE usename = 'posgtres';
```

### Работа с данными и полями таблиц

#### 1. Удаление одинаковых строк

Если так получилось, что в таблице нет первичного ключа (primary key), то наверняка среди записей найдутся дубликаты. Если для такой таблицы, особенно большого размера, необходимо поставить ограничения (constraint) для проверки целостности, то можно удалить следующие элементы:
- дублирующиеся строки,
- ситуации, когда одна или более колонок дублируются (если эти колонки предполагается использовать в качестве первичного ключа).

