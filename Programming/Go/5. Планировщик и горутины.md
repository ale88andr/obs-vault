### 5.1 Планировщик операционной системы

##### Процессы

Когда приложения загружаются в оперативную память они становятся **процессами**. У каждого процесса есть в оперативной памяти своё адресное пространство в которых располагаются ресурсы процесса, которые изолированы от других процессов в памяти(т.е. процесс не может напрямую обратиться к ресурсам другого процесса).

![[Pasted image 20251119103325.png]]

Процессор выполняет инструкции находящиеся в разделе `code`(`text`) последовательно

![[Pasted image 20251119103921.png]]

`PC` - регистр следующей инструкции
`IR` - instruction registry (сюда загружаются инструкции для исполнения)
`R1`, `R2`, `R3` - регистры данных

Но в реальности при работе ОС в памяти находятся множество процессов, для того чтобы они не простаивали, процессор может с помощью **планировщика задач** переключаться на исполнение инструкций других процессов, имитируя таким образом многозадачность.

При вытесняющей многозадачности, планировщик может переключить процессор на другую задачу в любой момент времени.

![[Pasted image 20251119104945.png]]

При этом в инструкциях другого процесса могут использоваться те же регистры, что и в предыдущем процессе. Для этого планировщик, перед переключением процессов, сохраняет значения регистров в специальную структуру данных `task`, затем очищает все значения регистров и лишь затем начинает выполнять инструкции другого процесса

![[Pasted image 20251119105519.png]]

При дальнейшем переключении между процессами, данные регистров восстанавливаются из стуктуры `task` для корректного продолжения работы процесса.

##### Поток

Каждый процесс имеет, как минимум один **поток**. Потоки запущенные процессом имеют общую память(т.е. напрямую могут общаться между собой) 

Потоки, так же как и процессы имеют собственные регистры, но они, в общем легче процессов, но имеют такую же структуру и по сути **планировщик задач работает именно с потоками**.

У каждого потока свой стек

![[Pasted image 20251119111417.png]]

##### Горутины

**Горутина** - это легковесный поток

- Начальный размер стека - `2кб`, и стек может расти до `1гб` (`256мб` в `32`-битной системе) - Для сравнения, поток ОС имеет фиксированный размер `1-8 мб`, для примера `1000` горутин - `2МБ`
- Переключение горутин происходит в определенные моменты, когда горутина не выполняет CPU-intensive задачи, не нужно сохранять всё состояние процессора - В ОС конкурентность вытесняющая, в `Go` конкурентность кооперативная(горутины в определенные моменты сигнализируют, когда их можно вытеснить)