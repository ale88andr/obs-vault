## 1.1.1 Стек и куча
Память делится на 2 части: *стек* и *кучу*

![[Pasted image 20251029214404.png]]

Куча растет последовательно, стек заполняется от конца к началу, когда стэк заполняется(доходит до защищенной области) происходит переполнение (`stackoverflow`)

![[Pasted image 20251029214818.png]]

Cтек и куча - это разные способы работы с памятью:
- стек как правило быстрее, и ненужная память освобождается автоматически
	- стек лучше подходит для хранения **недолго живущих локальных переменных**
- работа с кучей как правило медленнее, и ненужная память не освобождается автоматически (нужно освобождать ее вручную или использовать `GC`)
	- в куче хранятся объекты, ссылки на которые **живут за пределами функции**

### Стек в Go

В `Go` стеков много! (каждой горутине выделяется свой стек). Стеки выделяются операционной системой.
- начальный размер стека при запуске горутины - 2 Кб. 
- если стек переполняется, Go автоматически увеличивает его размер путем копирования текущего стека в новое место с большим объемом памяти

`Go` использует *анализ выхода* (`escape analysis`), чтобы определить можно ли хранить переменную в стеке или в куче:
- Если переменная не покидает область видимости функции - **стек**
- Если переменная возвращается из функции или передается по ссылке - **куча**

стеки условно "бесконечные", растут до `1Gb` (до `256Мb` в 32 битной системе)

![[Pasted image 20251029220916.png]]

