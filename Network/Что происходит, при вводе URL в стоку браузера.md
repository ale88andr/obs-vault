
![[Pasted image 20241225160740.png]]

Что происходит при вводе в адресную строку и нажатии “Enter”

1.       Протоколы поддерживаемые браузером:

·         `http`
·         `https`
·         `file`
·         `ftp`

Как браузер определяет по какому протоколу доступен сайт

- `HSTS` (HTTP Strict Transport Security) - с 2012 г.* Механизм принудительно активирующий защищённое соединение через протокол HTTPS. (если сайт есть в списке HSTS [заголовок Strict-Transport-Security], то принудительно запрос направится через https)

Установить соединение с сервером можно только по IP, чтобы отправить пакет серверу, нужно знать его IP адрес, для этого используется DNS:
·         для начала браузер ищет сопоставление в своём КЭШ
·         далее сопоставление ищется в файле hosts
·         КЭШ ОС
·         DNS сервер провайдера
·         Корневой DNS сервер
·         DNS сервер ответственный за зону (.com, .ru)
·         NS – сервер

Отправка запроса на сервер:
·         **Прикладной уровень** (HTTP Request)
·         **Транспортный уровень** (TCP\UDP в заголовок пакета добавляем порт на который стучимся)
·         **Сетевой уровень** (к пакету добавляется IP адрес [ip_adress:port])
·         **Канальный уровень** (посредством arp запроса определяется есть ли такой адрес в сети, если есть, то ему передаётся пакет, если нет – то запрос передается на шлюз. Шлюз передает на уровень выше, смотрит свою таблицу маршрутизации и направляет пакет в нужном направлении другому маршрутизатору, тот, в свою очередь определяет знает ли он этот IP адрес и определяет его путь и отправляет снова, и т.д. пока пакет не достигнет цели, либо пока у пакета не закончатся хопы.)

Если отправка запроса происходит через защищённое соединение, то добавляется ещё один слой в прикладном уровне:

·         Браузер отправляет серверу `Client hello` (`TLS handshake`) и сообщает о версии `TLS`, которую он поддерживает.
·         Сервер отвечает клиенту Server hello (2) содержащим версию TLS, выбранным методом шифрования, выбранным методом компрессии и публичный сертификат сервера, подписанный центром сертификации. Сертификат содержит публичный ключ, который будет использоваться клиентом для шифрования.
·         Клиент подтверждает сертификат сервера с помощью своего списка центров сертификации, если сертификат подписан центром из списка, то серверу можно доверять.
·         Клиент отправляет зашифрованный пакет с помощью публичного ключа сервера
·         Сервер дешифрует пакет с помощью своего приватного ключа и генерирует симметричный мастер-ключ
·         Клиент отправляет сообщение finished, шифруя ХЭШ передачи с помощью симметричного ключа
·         Сервер сверяет полученный ХЭШ со своим ХЭШ сгенерированным самостоятельно.
·         Если ХЭШи совпадают сервер отправляет собственное сообщение finished
·         Клиент и сервер пересылают друг другу сообщения, зашифрованные с помощью этого симметричного ключа.

Чтобы получить страницу браузер формирует запрос. Например:

**> GET /document/id=255 HTTP/2**

**> Host: www.site.com**