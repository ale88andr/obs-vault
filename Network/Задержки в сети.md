
В основном, в современных корпоративных сетях можно выделить следующие типы задержки:

**Задержка обработки**: Это время, которое затрачивает маршрутизатор на получение пакета на входном интерфейсе и отправку его в исходящую очередь на исходящий инетерфейс. Задержка обработки зависит от следующих факторов:

1. **Скорость центрального процессора;**
2. **Использование центрального процессора;**
3. **Архитектура маршрутизатора;**
4. **Настроенные опции входящих и исходящих интерфейсов.**

- **Задержка очереди:** Это время, которое пакет находится в очереди на отправку. Данный вид задержки зависит от таких факторов как количество и размер пакетов, которые уже находятся в очереди, полоса пропускания интерфейса и механизм очередей;
- **Задержка сериализации:** Время, необходимое для перемещения фрейма в физическую среду передачи;
- **Задержка распространения:** Время, которое занимает путь пакета от источника к получателю по каналу связи. Эта задержка сильно зависит от среды передачи.

![[Pasted image 20240123153144.png]]
### Методы ограничения задержки

- Маршрутизатор имеет достаточно мощностей для того, чтобы быстро и оперативно принимать решения о дальнейшем перенаправлении пакетов. Задержка обработки, очереди и сериализации зависит от следующих факторов:
- Средняя длина очереди;
- Средняя длина пакетов в очереди;
- Пропускная способность канала связи.

> Указанные ниже методы удовлетворяют требования чувствительного к задержке трафика

- **Увеличение пропускной способности:** При достаточной пропускной способности, сокращается время ожидания в исходящей очереди, тем самым, сокращается задержка сериализации;
- **Приоритизация чувствительного к задержкам трафика:** Данный метод является более гибким. [Указанные ранее](https://wiki.merionet.ru/ip-telephoniya/qos-networks/) алгоритмы PG, CQ, MDRR и LLQ имеют значительное воздействие задержку, вносимую очередью;
- **Сжатие поля полезной нагрузки:** Сжатие поля полезной нагрузки уменьшает общий размер пакета, тем самым, по сути, увеличив пропускную способность канала передачи. Так как сжатые пакеты меньше обычных по размеру, их передача занимает меньше времени. Важно помнить, что алгоритмы сжатия весьма сложны, и компрессия наряду с декомпрессией могут добавить дополнительные задержки;
- **Сжатие заголовков пакетов:** Сжатие заголовков не так сильно требует ресурсов центрального процессора, как сжатие поля полезной нагрузки, поэтому, данный механизм часто используется наряду с другими алгоритмами уменьшения задержки. Сжатие заголовков особенно актуально для голосового трафика.

---

#### Потеря пакетов

Обычно, потеря пакетов происходит при условии переполнения буфера маршрутизатора. Например, пакеты находятся в исходящей на интерфейсе очереди. В какой-то момент размер очереди достигает своего максимума, и, новые приходящие пакеты просто отбрасываются. В целом, потеря пакетов происходит по следующим причинам:

- **Потеря на входящей очереди:** если не хватает мощности CPU (Central Processing Unit) маршрутизатора, пакеты могут быть потеряны еще на входящем интерфейсе;
- **Игнорирование пакетов:** Буфер маршрутизатора переполнен, следовательно, приходящие пакеты просто игнорируются;
- **Ошибка во фреймах:** Аппаратное обнаружение ошибок во фреймах, например, Cyclic Redundancy Check (CRC).

Как правило, потеря пакетов является результатом чрезмерной загрузки интерфейса.

Используются следующие методы и алгоритмы для [предотвращения потерь пакетов](https://merionet.ru/solutions/telephony/set-qos/):

1. **Увеличение пропускной способности** чтобы предотвратить перегрузку на интерфейсе;
2. **Обеспечение достаточной пропускной способности** и увеличение буферного пространства для гарантированного перемещения чувствительного к задержкам трафика в начало очереди;
3. **Ограничить перегрузку путем отбрасывания пакетов** с низким приоритетом до того, как произойдет переполнение интерфейса. Для обеспечения данной цели, инженер может использовать алгоритм Weighted Random Early Detection (WRED), который будет случайно отбрасывать нечувствительный к потерям и трафик и пакеты, с заранее настроенными низкими приоритетами.