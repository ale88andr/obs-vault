
Для установки КриптоПРО CSP выполнить следующие действия:

1. Загрузить архив с сертифицированной версией ПО «КриптоПро». Название полученного файла: «linux-amd64_deb.tgz».
2. Открыть терминал (горячая клавиша Alt+T).
3. Разархивировать полученный архив в терминале командой:

```shell
tar -zxf linux-amd64_deb.tgz
```

При разархивировании будет создан каталог `linux-amd64_deb`.

4. Перейти в созданный каталог `linux-amd64_deb`: 

```shell
cd linux-amd64_deb
```

5. Установить ПО:

Для работы с графическим пользовательским интерфейсом:
- запустить сценарий `install_gui.sh` командой:

```shell
sudo ./install_gui.sh
```

- В процессе установи выбрать необходимые компоненты:

![[Pasted image 20250218151953.png]]

 - Для работы без графического пользовательского интерфейса запустить сценарий `instal.sh` командой:

```shell
sudo ./install.sh
```

## Описание пакетов КриптоПро

|Пакет|Описание|
|---|---|
|**Базовые пакеты:**|   |
|cprocsp-curl|Библиотека libcurl с реализацией шифрования по ГОСТ|
|lsb-cprocsp-base|Основной пакет КриптоПро CSP|
|lsb-cprocsp-capilite|Интерфейс CAPILite и утилиты|
|lsb-cprocsp-kc1|Провайдер криптографической службы KC1|
|lsb-cprocsp-rdr|Поддержка ридеров и RNG|
|**Дополнительные пакеты:**|   |
|cprocsp-rdr-gui-gtk|Графический интерфейс для диалоговых операций|
|cprocsp-rdr-rutoken|Поддержка карт Рутокен|
|cprocsp-rdr-jacarta|Поддержка карт JaCarta|
|cprocsp-rdr-pcsc|Компоненты PC/SC для ридеров КриптоПро CSP|
|lsb-cprocsp-pkcs11|Поддержка PKCS11|

Для просмотра всех установленных пакетов КриптоПро CSP можно использовать команду:  

```shell
dpkg -l | grep cprocsp
```

## Установка дополнительных пакетов для поддержки ключевых носителей

Для корректной работы с ключевыми носителями (токенами и смарт-картами) установить дополнительные пакеты:

- дополнительные пакеты из состава ОС:
    - libccid;
    - libgost-astra;
    - pcscd;
- пакеты с модулями поддержки, предоставляемые производителями оборудования:
    - для токенов Рутокен: [https://www.rutoken.ru/support/download/nix/](https://www.rutoken.ru/support/download/nix/);
    - для токенов Аладдин: [https://www.aladdin-rd.ru/support/downloads/jacarta](https://www.aladdin-rd.ru/support/downloads/jacarta);

Команда для установки пакетов из состава ОС:

```shell
sudo apt install libccid pcscd libgost-astra
```

# Установка ПО

Для выполнения действий данной инструкции необходимо установить следующее программное обеспечение:

- Программное обеспечение из репозиториев Astra Linux:
    - пакет libccid;
    - пакет pcscd;
    - пакет libpcsclite1;
    - пакет pcsc-tools;
    - пакет opensc;
    - пакет libengine-pkcs11-openssl1.1;
- Программное обеспечение, предоставляемое разработчиком оборудования:
    - для работы с Рутокен ЭЦП — пакет librtpkcs11ecp (аналог библиотеки libengine-pkcs11-openssl1.1 входящей в состав Astra Linux);
    - для работы с Рутокен S — пакет ifd-rutokens (драйвер токена, предоставляемый производителем).

Установка пакетов может быть выполнена с помощью [Графический менеджер пакетов synaptic](https://wiki.astralinux.ru/pages/viewpage.action?pageId=27362363) или из командной строки командой:

```shell
sudo apt install libccid pcscd libpcsclite1 pcsc-tools opensc libengine-pkcs11-openssl1.1
```

Для установки пакета `librtpkcs11ecp` загрузить актуальную версию по ссылке: [https://www.rutoken.ru/support/download/pkcs/](https://www.rutoken.ru/support/download/pkcs/) и выполнить установку из загруженного файла:

```shell
sudo apt install ./librtpkcs11ecp_*_amd64.deb
```

При установке пакета устанавливается библиотека `librtpkcs11ecp.so` В разных обновлениях эта библиотека может размещаться в различных каталогах. Далее в примерах предполагается, что библиотека расположена в файле `/usr/lib/librtpkcs11ecp.so`. Для того, чтобы определить реальное расположение библиотеки можно использовать команду:

```shell
find /usr/*(lib|lib64) -name librtpkcs11ecp.so
```

Для установки пакета ifd-rutokens загрузить актуальную версию по ссылке: [https://www.rutoken.ru/support/download/get/rtDrivers-x64-deb.html](https://www.rutoken.ru/support/download/get/rtDrivers-x64-deb.html) и выполнить установку из загруженного файла:

```shell
sudo apt install ./ifd-rutokens_*_amd64.deb
```

# Проверка работы токенов в системе

Для проверки работы токена необходимо подключить токен к компьютеру.

## Инструмент pcsc_scan

Инструмент `pscsc_scan` входит в пакет `pcsc-tools`. Для его работы требуется установка пакета `pcscd`. Команда для вывода информации о подключенном токене:

```shell
pcsc_scan
```

После запуска  `pscsc_scan` проверяет наличие подключенного токена. Если токен обнаружен - выводит информацию о нем. Программа не завершает работу сама, ожидая подключение следующего токена. Для завершения работы программы нажать `Ctrl+C`.

> если  не удается найти токен можно попробовать перезапустить службу `pcscd`


# Удаление КриптоПро CSP

---

Для того, чтобы удалить ПО КриптоПро CSP,  в терминале FLY следует ввести последовательно 3 команды:

```shell
sudo rm -rf /opt/cprocsp  
sudo rm -rf /var/opt/cprocsp/  
sudo rm -rf /etc/opt/cprocsp/
```

