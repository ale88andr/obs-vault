
Проверяем прослушиваемые порты:

```Shell
netstat -anltpu | grep LISTEN
```

если в списке прослушиваемых портов нет порта `22`, значит служба `ssh` не запущена

Проверяем статус службы `ssh`

```Shell
systemctl status ssh
```

Если требуется, запускаем её

```Shell
sudo systemctl start ssh
```

и добавляем её в автозагрузку

```Shell
sudo systemctl enable ssh
```

Смотрим появился ли 22 порт в прослушиваемых:

```Shell
netstat -anltpu | grep LISTEN
```

или

```Shell
ss -tl
```

```Shell
tcp        0      0 0.0.0.0:22              0.0.0.0:*               LISTEN
tcp        0      0 127.0.0.1:2947          0.0.0.0:*               LISTEN
tcp6       0      0 :::22                   :::*                    LISTEN
```

Конфигурационный файл `ssh`: `/etc/ssh/sshd_config`.

По умолчанию, демон `SSHD` не нуждается в каких-либо настройках и работает нормально. Мы внесём лишь пару небольших изменений с целью ограничить доступ нежелательных лиц к серверу.

> Все изменения вносятся в `/etc/ssh/sshd_config`. Чтобы изменения вступили в силу, необходимо перезагрузить SSH

### Сменить порт

`Port 9724`

Теперь при авторизации вам нужно вместо стандартного `22` порта указывать `9724`.  
Способ очень простой и действенный против большинства простых ботов хакеров, которые стучатся в стандартные порты. Тут главное не создать конфликт с другими службами и подобрать заведомо неиспользуемое число.

### Запретить связь по старому протоколу

Здесь мы определяем, что связь возможна только по протоколу v2

`Protocol 2`

### Запретить авторизацию под root

`PermitRootLogin no`

По умолчанию `no`. Если `yes`, можно авторизовываться под рутом. Под root работать небезопасно, лучше создать своего пользователя и работать под ним.

> Если вы авторизованы не под **root**, перед всеми консольными командами нужно добавлять `sudo` — расшифровывается как **Substitute User and DO** — `подмени юзера и делай` (под ним)

### Уменьшить число попыток авторизации

`MaxAuthTries 2`

Количество попыток ввода пароля. По умолчанию 6. При неудачном переборе сеанс связи обрывается.

### Уменьшить время ожидания авторизации

`LoginGraceTime 30s`

По умолчанию, `120` секунд может длиться сеанс авторизации. По истечению этого времени он обрывается. 2 минуты на авторизацию — это перебор, всё это время сервер держит связь открытой, что очень нерационально. Полминуты за глаза хватит.

### Закрыть доступ по IP

> Прежде чем настраивать ограничения по IP, убедитесь, что в случае ошибки в настройке и последующего бана собственного IP у вас останется альтернативный способ вернуть доступ к серверу

Если доступ нужен только вам, самым простым и надёжным будет закрыть доступ отовсюду, кроме вашего IP или, если он динамический, то диапазона IP.

1. Открываем `/etc/hosts.allow` и добавляем туда
`SSHD: 192.168.1.1`
    где `192.168.1.1` — ваш IP. 

2. Открываем `/etc/hosts.deny` и добавляем туда:
`SSHD: ALL`

Теперь никто, кроме вас, не сможет авторизоваться на сервере по SSH.

Можно воспользоваться следующей директивой:

`AllowUsers = *@1.2.3.4`

Здесь мы разрешаем доступ только для IP `1.2.3.4`

