#### 1.1 Особенности MBR и UEFI

На материнской плате компьютера имеется чип памяти, в котором находится «прошивка» (firmware) - специальная программа, которая выполняет тестирование аппаратных компонентов компьютера и запуск загрузчика операционной системы. На старых компьютерах эта прошивка называлась `BIOS` (Basic lnput Output System, базовая система ввода/вывода), а на новых называется `UEFI` (Unified Extensible Firmware Interface, унифицированный расширяемый интерфейс микропрограммного
обеспечения).

Прошивка выполняет процедуру `POST` (Power-On Selft Test) - это процедура
самотестирования, определяющая «здоровье» аппаратных компонентов. Если все здоровы, прошивка берет первое устройство из списка `Boot Order` и пытается на нем найти загрузчик операционной системы.

Если на вашем компьютере до сих пор используется старая схема разметки `MBR` (Master Boot Record, главной загрузочной записи), которая была характерна на компьютерах с `BIOS`, то первые 512 байтов на жестком диске как раз и занимает `MBR`. То есть `MBR` - это область на жестком диске, содержащая загрузчик операционной системы и таблицу разделов.

```shell
fdisk -l
```

![[Pasted image 20250822121520.png]]

Начиная с 2010 года на новых компьютерах вместо `BIOS` стали прошивать `UEFI`. Прошивка `UEFI` принесла другую схему разметки диска - `GPT`
(GUID Partition Таblе). В начале накопителя, использующего схему разметки `GPT`, создается загрузочный раздел небольшого размера, в который и помещается код загрузчика.

```shell
fdisk -l
```

![[Pasted image 20250822121536.png]]

#### 1.2 Настройка загрузчика GRUB2

Главное назначение загрузчика - запуск выбранной пользователем операционной системы.

##### 1.2.1. Конфигурационный файл GRUB2

Основным конфигурационным файлом загрузчика `GRUB2` является файл `/boot/grub/grub.cfg`.

Конфигурационный файл `/boot/gruЬ/grub.cfg`, как правило, не редактируют вручную - для его создания используется утилита `/usr/sbin/grub-mkconfig`, которая генерирует этот файл на основе шаблонов, хранящихся в каталоге `/etc/grub.d`, и настроек из файла `/etc/default/grub`.

В конфигурационном файле содержится описание поведения `GRUB2`, а также элементов загрузочного меню. Собственно, ради элементов загрузочного меню часто и возникает необходимость отредактировать этот файл.

После изменения файла `/etc/default/grub` не забудьте выполнить команду `update-grub` для обновления вашего файла `/boot/gruЬ/grub.cfg`. Команда `update-grub` - это просто сценарий, вызывающий утилиту `grub-mkconfig/grub2-mkconfig` и передающий ей параметр - имя выходного файла (по умолчанию `/boot/grub/grub.cfg`).

##### 1.2.2. Установка пароля загрузчика

По умолчанию любой желающий может изменить параметры ядра. 

1. Сгенерировать хеш пароля командой `grub-mkpasswd-pbkdf2`.

```shell

```

2. Полученный хеш скопировать в буфер обмена
3. Создать файл `/etc/grub.d/07_password` или открыть его, если он существует.
4. Вставить в файл инструкции:
```shell
set superusers="username"
password_pbkdf2 username gruЬ.pbkdf2.sha512.10000.9C319610666 ..........
```
2. Установить права 700 для этого файла:
sudo chmod 700 /etc/grub.d/07_password
3. Обновить загрузчик командой update-grub.

#### 2.1 Система инициализации system d

Загрузчик `GRUB2` загружает ядро `Linux` и передает ему управление. Ядро, в свою очередь, должно запустить систему инициализации. Раньше в качестве системы инициализации использовалась `SysVinit`, но на сегодняшний день она безнадежно устарела и больше не соответствует требованиям современных дистрибутивов. Во всех современных дистрибутивах сейчас используется система инициализации `systemd`.

##### 2.1.1 Сервисы, службы, демоны

Служба (англ. service - сервис) - это программа, выполняющаяся в фоновом режиме и предоставляющая определенный сервис. Например, служба `apache2` предоставляет сервис веб-сервера. Она в фоновом режиме прослушивает заданный в настройках порт (чаще всего `80` или `443`) и обслуживает поступающие на него запросы, отправляя в ответ на запрос НТМL-код веб-страницы.

> Ранее сервисы также назывались демонами (`daemon`). Именно поэтому в названии некоторых служб присутствует буква `d` - например, демон, обслуживающий снапы, называется `snapd`.

Для управления сервисами (автоматический запуск, перезапуск, остановка) как раз и служит система инициализации. Как уже отмечено ранее, в древних дистрибутивах Linux использовалась система инициализации `init`.

Программа `init` - это процесс с `UID 1`, он первым запускается ядром и выступает родителем для всех процессов, у которых нет собственного родителя. Основная задача такого процесса (помимо всех остальных задач)- инициализация системы. А значит, он должен это сделать быстро. Чтобы запустить систему быстро необходимо:
- запускать не все, что можно, а только самое необходимое; 
- запускать сервисы параллельно;

##### 2.1.2 Терминология `systemd`

Система инициализации `systemd` контролирует всю систему. Система `systemd` построена на концепции модулей (`units`). У каждого модуля есть
свое имя и тип. Например, модуль типа `nscd.service` управляет сервисом (демоном) `nscd`.

Основными типами модулей являются:
- `service` (сервис) - демоны, которые можно запустить, перезапустить, остановить;
- `socket` (сокет)- реализует сокет, расположенный в файловой системе или в Интернете. Поддерживаются сокеты `AF_INET`, `AF_INET6`, `AF_UNIX`. У каждого сокета есть связанный с ним сервис. Например, при попытке установки соединения с сокетом `nscd.socket` будет запущен сервис `nscd.service`.
- `device` (устройство) - реализует устройство в дереве устройств. Если устройство описано через правила `udev` ( системы управления устройствами для новых версий ядра Linux), то его можно представить в `systemd` как модуль типа `device`;
- `mount` (точка монтирования) - реализует точку монтирования в файловой системе. Демон `systemd` контролирует все точки монтирования, . их подключение и отключение. Теперь файл `/etc/fstab` не главный, а служит дополнительным источником информации о точках монтирования, хотя вы по-прежнему можете описывать в нем свои точки монтирования;
- `automount` (автоматическая точка монтирования)- реализует автоматическое монтирование файловой системы. Такой модуль имеет соответствующий ему модуль типа `mount`, который будет запущен, как только файловая система станет доступной;
- `target` (цель)- служит для логической группировки модулей других типов. Этот тип модуля очень важен, но в то же время он ничего не делает, а просто группирует другие модули. В `systemd` больше нет уровней запуска (которые были в `init`), вместо них используются цели. Например, цель `multi-user.target` описывает, какие сервисы (точнее модули, а не только сервисы) должны быть запущены в многопользовательском режиме.
- `snapshot` ( снимок) - также ничего не делает, а только ссылается на другие модули. Снимки используются в двух случаях: первый случай - временный перевод системы в какое-то состояние (например, в однопользовательский режим) и последующий возврат из этого состояния, второй - поддержка режима `suspend`.

**Основные особенности `systemd`:**

- позволяет контролировать для каждого процесса: среду исполнения, ограничение ресурсов, рабочий каталог, корневой каталог, `umask`, параметр `nice`, `ID` пользователя и группы и многое другое;

##### 2.1.3 Управление службами

Для управления сервисами из консоли используется утилита `systemctl`. Например, вот как можно запустить, остановить и перезапустить сервис:

- `systemctl start <название>`
- `systemctl stop <название>`
- `systemctl restart <название>`
- `systemctl enable <название>`
- `systemctl disable <название>`

Команда `еnаblе` включает автоматическую загрузку сервиса, а `disable` - отключает ее.

**Astra Linux** содержит очень удобный графический конфигуратор, позволяющий управлять сервисами более просто:
1. Откройте панель управления.
2. Перейдите в раздел Система.
3. Откройте конфигуратор Инициализация системы.
4. Для управления службой щелкните правой кнопкой мыши - в появившемся меню вы увидите следующие команды:
	• Запустить юнит - запускает службу;
	• Остановить юнит - останавливает службу.
	• Перезапустить юнит - перезапускает службу;
	• Перечитать конфигурацию юнита - заставляет службу перечитать свой
	файл конфигурации. Полезно, если вы внесли незначительные изменения 	в файл конфигурации и теперь хотите, чтобы они вступили в силу, но при 	этом перезагружать весь сервис нежелательно, чтобы не прерывать обслуживание пользователей;
	• Включить юнит - включает автоматическую загрузку службы;


