
### 1. Файлы конфигурации сети в Linux

1. `/etc/hosts.conf` - Содержит параметры разрешения доменных имен. Например, директива `order hosts, bind` означает, что сначала поиск IР-адреса по доменному имени будет произведен в файле `/etc/hosts`, а затем лишь будет произведено обращение к DNS-cepвepy, заданному в файле `/etc/resolv.conf`. Директива `multi on` означает, что одному доменному имени могут соответствовать несколько IР-адресов.
2. `/etc/hosts` - В этом файле можно прописать IР-адреса и имена узлов локальной сети, но обычно здесь указывается только IР-адрес узла `localhost (127.0.0.1)`, потому что сейчас даже в небольшой локальной сети устанавливается собственный DNS-cepвep.
3. `/etc/hosts.allow` - Содержит IР-адреса узлов, которым разрешен доступ к сервисам этого узла
4. `/etc/hosts.deny` - Содержит IР-адреса узлов, которым запрещен доступ к сервисам этого узла
5. `/etc/hostname` - Содержит имя узла
6. `/etc/network/interfaces` - Используется для ручной настройки сетевых интерфейсов (не с помощью NetworkManager)
7. `/etc/resolv.conf` - Задает IР-адреса серверов `DNS`. Формат файла прост: nameserver IР-адрес Всего можно указать четыре DNS-cepвepa. При использовании NetworkManager этот файл не используется, и настройки DNS хранятся файле соединения в каталоге `/etc/NetworkManager/system-connections`
8. `/etc/NetworkManager/system-connections/` - В дистрибутивах, использующих NetworkManager, в этом каталоге хранятся настройки соединений - в отдельных файлах по одному для каждого соединения. При этом название файла соответствует названию соединения, введенному при настройке

> где хранится пароль от сети Wi-Fi? Перейдите в каталог `/etc/NetworkManager/system-connections`. В нем хранятся файлы конфигурации для каждого из ваших соединений. Имя файла соответствует имени соединения, а в случае с Wi-Fi - имени сети. Откройте файл соединения и найдите параметр `psk` - это и будет пароль от Wi-Fi в незашифрованном виде.

### 2. Имена сетевых интерфейсов

Все (или практически все) современные дистрибутивы перешли на единый сервис настройки сети **NetworkManager** конфигуратор сети у всех стал один - `nm-connection-editor`. Классическое название интерфейса Ethernet - `ethX`, где `Х` - это число от `0`. Первому Еthеrnеt-интерфейсу соответствует имя `eth0`, второму - `eth1` и т. д. Но у некоторых дистрибутивов имена интерфейсов могут отличаться от классических - например, вместо `eth0` может использоваться имя `ens33` или `enp3s0`. Такие имена появились в связи с переходом современных дистрибутивов на `udev` (систему
управления устройствами для новых версий ядра Linux).

Впрочем, определенная система в назначении новых имен также имеется, только она не столь очевидная. Сетевые адаптеры, встроенные в материнскую плату, носят теперь название типа `eno1`. Если же сетевая карта подключена к PCI Express, то она будет нести название типа `ens33`. Имена устройств, содержащие физическое/географическое расположение коннектора, будут выглядеть как `enp2s0`. А самые сложные и «страшные» имена у сетевых адаптеров, определяемых через МАС-адрес
### 3. Статические маршруты

В ТСР/IР-сетях информация о маршрутах имеет вид правил - например, чтобы добраться до сети `А`, нужно отправить пакеты через компьютер `Д`.

Примерно так же выглядит и информация о маршрутах на дороге: чтобы доехать до города `А`, нужно проехать через город `Д`. Кроме набора маршрутов, есть также и стандартный маршрут - по нему отправляют пакеты, предназначенные для отправки в сеть, маршрут к которой явно не указан. Компьютер, на который отправляются такие пакеты, называется шлюзом по умолчанию (`default gateway`). Получив пакет, шлюз решает, что с ним сделать: или отправить дальше, если ему известен маршрут в сеть получателя пакета, или же уничтожить пакет, как будто бы его никогда и не было.

Данные о маршрутах хранятся в таблице маршрутизации ядра Linux. Каждая запись этой таблицы содержит несколько параметров: адрес сети назначения, сетевую маску и т. д. Если пакет не удалось отправить ни по одному маршруту (в том числе и по стандартному), отправителю пакета передается `IСМР-сообщение` «сеть недоступна» (network unreachaЬle).

**Команды `netstat` и `route`**

Для просмотра таблицы маршрутизации служат команды `netstat -r` и `netstat -rn`. Можно также по старинке воспользоваться командой `route` без параметров . Разница между командами `netstat -r` и `netstat -rn` заключается в том, что параметр `-rn` запрещает поиск доменных имен в DNS, поэтому все адреса будут представлены в числовом виде

![[Pasted image 20250825131159.png]]

Поля таблицы маршрутизации:

| Поле            | Описание                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  |
| --------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Destination** | Адрес сети назначения                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **Gateway**     | Шлюз по умолчанию                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                         |
| **Genmask**     | Маска сети назначения                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                     |
| **Flags**       | Поле Flags содержит флаги маршрута                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        |
| **MSS**         | Максимальный размер сегмента (Maximum Segment Size)<br>для ТСР-соединений по этому маршруту                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                               |
| **Wlndow**      | Размер окна по умолчанию для ТСР-соединений по этому маршруту                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             |
| **lrtt**        | Протокол ТСР гарантирует надежную доставку данных между комnьютерами. Такая гарантия обеспечивается повторной отправкой пакетов, если они были потеряны. При этом ведется счетчик времени: сколько нужно ждать, пока пакет дойдет до назначения и придет подтверждение о получении пакета. Если время вышло, а подтверждение-таки не было nолучено, то пакет отправляется еще раз. Это время и называется round-trip time (время «путешествия туда-обратно»). Параметр lrtt - это начальное аремя rtt. В большинстве случаев подходит значение по умолчанию, но для некоторых медленных сетей, - например, для сетей пакетного радио, значение по умолчанию слишком короткое, что вызывает ненужные повторы. Параметр lrtt можно увеличить командой route. По умолчанию его<br>значение 0 |
Добавить маршрут в таблицу маршрутизации можно статически ( с помощью команды `route`), динамически или комбинированно (так, статические маршруты добавляются при запуске системы, а динамические - по мере работы системы). Статические маршруты добавляются, как правило, командой route, запущенной из сценария инициализации системы. Например, следующая команда задает шлюз по умолчанию для интерфейса `eth0`:

```shell
route add default gw 192.168.181.2 ethO
```

После перезагрузки системы добавленная нами запись исчезнет из таблицы маршрутизации.

Маршрутизация осуществляется на сетевом уровне модели `OSI`. Когда маршрутизатор получает пакет, предназначенный для другого узла, IР-адрес получателя пакета сравнивается с записями в таблице маршрутизации. Если есть хотя бы частичное совпадение с каким-то маршрутом из таблицы, пакет отправляется по IР-адресу шлюза. связанного с этим маршрутом. Если совпадений не найдено (т. е. вообще нет маршрута, по которому можно было бы отправить пакет), пакет отправляется на шлюз по умолчанию, если таковой задан в таблице маршрутизации.

Формат вызова route следующий:

```shell
route [add|del] [тип] адресат gw шлюз [метрика] [dev интерфейс]
```

- параметр `тип` необязательный - он задает тип маршрута: `-net` (маршрут к сети), `-host` (маршрут к узлу) или `default` (маршрут по умолчанию);
- параметр `адресат` содержит адрес сети (если задается маршрут к сети), адрес узла (при добавлении маршрута к сети) или вообще не указывается (если задается маршрут по умолчанию);
- параметр `шлюз` задает IР-адрес (или доменное имя) шлюза;
- последние два параметра: `метрика` и `dev` необязательны

Примеры использования команды `route`:

Добавляет маршрут к сети `192.76.16.0` ( сеть класса `С`, о чем свидетельствует сетевая маска, заданная параметром `netmask`) через устройство `eth0`. Шлюз не указан, просто все пакеты, адресованные сети `192.76.16.0`, будут отправлены на интерфейс `eth0`.

```shell
route add -net 192.76.16.0 netmask 255.255.255.0 dev eth0
```

Добавляет маршрут к сети `192.76.16.0` через маршрутизатор `192.76.16.1`. Сетевой интерфейс указывать не обязательно, но можно и указать при особом желании.

```shell
route add -net 192.16.16.0 netmask 255.255.255.0 gw 192.76.16.1
```

Добавляет запрещающий маршрут. Отправка пакетов по этому маршруту (в сеть `10.1.0.0`) запрещена.

```shell
route add -net 10.1.0.0 netmask 255.0.0.0 reject
```

**Сохранение статических маршрутов**

Перейдите в каталог `/etc/network/if-up.d` и создайте файл `routes`:

```shell
sudo nano /etc/network/if-up.d/routes

#!/bin/bash
# Проверка имени интерфейса
[ "$IFACE" != "eth0" ] 11 exit О
# Дополнительные маршруты
route add -net 192.168.32.0/24 gw 192.168.1.1 dev eth0
```

Теперь нужно сделать этот файл исполняемым:

```shell
sudo chmod +х /etc/network/if-up.d/routes
```

**Включение IРv4-переадресации**

Основное предназначение шлюза (маршрутизатора) - это пересылка (forwarding) пакетов. Чтобы включить пересылку пакетов протокола IPv4 (IPv4 forwarding), нужно записать значение `1` в файл `/proc/sys/net/ipv4/ip_forward`:

```shell
echo 1 > /proc/sys/net/ipv4/ip_forward
```

Но включить пересылку мало - нужно еще сохранить это значение, иначе при перезагрузке будет восстановлено значение по умолчанию (`0`). Для этого следует в файл `/etc/sysctl.conf` добавить строку:

```shell
net.ipv4.ip_forward=0
```



